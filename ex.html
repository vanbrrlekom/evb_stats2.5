<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Elli van Berlekom">

<title>exercises2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ex_files/libs/clipboard/clipboard.min.js"></script>
<script src="ex_files/libs/quarto-html/quarto.js"></script>
<script src="ex_files/libs/quarto-html/popper.min.js"></script>
<script src="ex_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ex_files/libs/quarto-html/anchor.min.js"></script>
<link href="ex_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ex_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ex_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ex_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ex_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script async="" src="https://hypothes.is/embed.js"></script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#br-15" id="toc-br-15" class="nav-link active" data-scroll-target="#br-15">BR 15</a></li>
  <li><a href="#mn1" id="toc-mn1" class="nav-link" data-scroll-target="#mn1">MN1</a></li>
  <li><a href="#sr-13" id="toc-sr-13" class="nav-link" data-scroll-target="#sr-13">SR 13</a></li>
  <li><a href="#mn2" id="toc-mn2" class="nav-link" data-scroll-target="#mn2">MN2</a></li>
  <li><a href="#sr-14" id="toc-sr-14" class="nav-link" data-scroll-target="#sr-14">SR 14</a></li>
  <li><a href="#mn3" id="toc-mn3" class="nav-link" data-scroll-target="#mn3">MN3</a></li>
  <li><a href="#mn4" id="toc-mn4" class="nav-link" data-scroll-target="#mn4">MN4:</a></li>
  <li><a href="#stv" id="toc-stv" class="nav-link" data-scroll-target="#stv">STV</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#model-1-fixed-effects-only" id="toc-model-1-fixed-effects-only" class="nav-link" data-scroll-target="#model-1-fixed-effects-only">Model 1: Fixed effects only</a></li>
  <li><a href="#model-2-random-intercepts-for-subjects" id="toc-model-2-random-intercepts-for-subjects" class="nav-link" data-scroll-target="#model-2-random-intercepts-for-subjects">Model 2, random intercepts for subjects:</a></li>
  <li><a href="#model-3-varying-intercepts-varying-slopes-no-covariation" id="toc-model-3-varying-intercepts-varying-slopes-no-covariation" class="nav-link" data-scroll-target="#model-3-varying-intercepts-varying-slopes-no-covariation">Model 3: Varying intercepts &amp; varying slopes, no covariation</a></li>
  <li><a href="#model-4-covarying-slopese-and-intercepts" id="toc-model-4-covarying-slopese-and-intercepts" class="nav-link" data-scroll-target="#model-4-covarying-slopese-and-intercepts">Model 4: Covarying slopese and intercepts</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">exercises2</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Elli van Berlekom </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesrules)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="br-15" class="level2">
<h2 class="anchored" data-anchor-id="br-15">BR 15</h2>
<p>Here are my answers to the chapter 15 exercises, and in class. I’m trying to use this exercise as a reason to get more familiar with quarto. One thing I can do with quarto is to include a comment option. To add a comment, just highlight the relevant section of the text. It will prompt you to create an account, which turns out to be a simple process and it hasn’t sent me any spam yet at least.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">15.4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">15.6</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<blockquote class="blockquote">
<ol type="a">
<li>To explore the complete pooled behavior of the data points, construct and discuss a plot of <code>reaction</code> by <code>Days</code>. In doing so, ignore the subjects and include the observed trend in the relationship.</li>
</ol>
</blockquote>
<p>First, I load the data and fit a simple model.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> sleepstudy <span class="co"># first, import the data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">subset</span>(sleepstudy, Days <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="co">#remove first two days</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(Reaction <span class="sc">~</span> Days, <span class="at">data =</span> s) <span class="co">#fit the data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then I sample from the posterior and make a very simple plot, reflecting the effect of days on reaction time. Because ggplot has glm built in, I’m able to call it when creating this plot.Nice!</p>
<p>This plot is completely pooled, and it ignores the fact that the data points are not independent, but come from multiple trials within the same person. This is not good, because it is overconfident about the effect of days on reaction time!</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(s, <span class="fu">aes</span>(<span class="at">y =</span>Reaction, <span class="at">x =</span>  Days))<span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> glm, <span class="at">level =</span> <span class="fl">0.90</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tidybayes</span>() <span class="do">## I'll b trying out various themes as well. Why? For fun!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/15.4.2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<blockquote class="blockquote">
<p>using careful notation, write out the model</p>
</blockquote>
<p>I might write the model like this:</p>
<p><span class="math display">
\begin{aligned}
\text{Reaction}_{i} &amp; \sim \mathrm{Normal}(\mu, \sigma) \\
\mu_i &amp; = \alpha + \beta \times\text{Days}_i\\
\alpha &amp; \sim \mathrm{Normal}(245. 50)\\
b_1 &amp; \sim \mathrm{Normal}(20,50)\\
\sigma &amp;\sim \mathrm{Normal}(20,50)\\
\end{aligned}
</span></p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<blockquote class="blockquote">
<p>A. Suppose instead that we (incorrectly) took a no pooling approach in our sleep study analysis.To explore the no pooled behavior of the data points, construct and discuss separate scatterplots of Reaction by Days for each Subject, including subject-specific trend lines.</p>
</blockquote>
<p>Again, I’m able to do all that the question asks within ggplot by calling stan_glm and using <code>facet_wrap()</code> to the same operation for each subjct separately. This works fine, but we might be a little skeptical of for example subject 335, who got faster as the days go by. A partial pooling approach would probably adjust their scores a little.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(s, <span class="fu">aes</span>(<span class="at">x =</span> Days, <span class="at">y =</span> Reaction, <span class="at">color =</span>Subject)) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Subject))<span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> glm, <span class="at">level =</span> <span class="fl">0.90</span>, <span class="fu">aes</span>(<span class="at">fill =</span> Subject)) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/15.6.1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<blockquote class="blockquote">
<p>C. I think the question was to write the model out in notation.</p>
</blockquote>
<p>If we write this out into a nice model notation, what does it look like? Something like this.</p>
<p><span class="math display">
\begin{aligned}
\text{Reaction}_{i} &amp; \sim \mathrm{Normal}(\mu, \sigma) \\
\mu_i &amp; = \alpha + \alpha_\text{subject} + \beta\text{Days}_i\\
\alpha &amp; \sim \mathrm{Normal}(245. 50)\\
\alpha_\text{subject} &amp; \sim \mathrm{Normal}(0, 30)  &amp; \text{for j = 1, 2, 3...18}\\
\beta &amp; \sim \mathrm{Normal}(20,50)\\
\sigma &amp;\sim \mathrm{Normal}(20,50)\\
\end{aligned}
</span></p>
</div>
</div>
</div>
</section>
<section id="mn1" class="level2">
<h2 class="anchored" data-anchor-id="mn1">MN1</h2>
<blockquote class="blockquote">
<p>MN1: Do the tadpole simulation from the book (section 13.2), but for another scenario (other true parameters of your choice),and display result as Fig.13.1 andFig 13.3. Briefly compare results if your McElreath’s simulation.</p>
</blockquote>
<p>I’m going to start in the same order as MN, and repeat McElreath’s model</p>
<p><span class="math display">
\begin{aligned}
S_i &amp;\sim \mathrm{Binomial}(N_i, p_i)\\
logit_p &amp;= \alpha_{\text{POND[i]}}\\
\alpha_j &amp;\sim \mathrm{Normal(\bar{\alpha}, \sigma)}\\
\bar{\alpha} &amp;\sim \mathrm{Normal}(0,1.5)\\
\sigma &amp;\sim \mathrm{Exponential}(1)
\end{aligned}
</span></p>
<p>I’ll be using McElreath’s code to make the simulations, but turning it into a function to be able to carry it out many times and compare the effects of using many different parameters. The code chunk below</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sim_tads <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">a_bar =</span><span class="dv">2</span>, <span class="at">sigma =</span> <span class="fl">0.1</span>, <span class="at">nponds =</span> <span class="dv">60</span>, <span class="at">nclusters =</span> <span class="dv">60</span>, <span class="at">title =</span> <span class="st">"opps, forgot to add a title"</span>){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  a_bar <span class="ot">&lt;-</span> a_bar</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> sigma</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>nclusters <span class="ot">&lt;-</span> nclusters</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>ni <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">35</span>), <span class="at">each =</span> <span class="dv">15</span>))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5005</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#true params</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>true_a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(nponds, <span class="at">mean =</span> a_bar, <span class="at">sd =</span> sigma)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>dsim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pond =</span> <span class="dv">1</span><span class="sc">:</span>nponds, <span class="at">ni =</span> ni, <span class="at">true_a =</span> true_a)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>dsim<span class="sc">$</span>true_p <span class="ot">&lt;-</span> <span class="fu">plogis</span>(dsim<span class="sc">$</span>true_a)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>dsim<span class="sc">$</span>si <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(nponds, <span class="at">size =</span> dsim<span class="sc">$</span>ni, <span class="at">prob =</span> dsim<span class="sc">$</span>true_p)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">#make a dataframe</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">si =</span> dsim<span class="sc">$</span>si, <span class="at">ni =</span> dsim<span class="sc">$</span>ni, <span class="at">pond =</span> dsim<span class="sc">$</span>pond)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#fit a model, do the pooling</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    si <span class="sc">~</span> <span class="fu">dbinom</span>(ni, p),</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a_pond[pond],</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    a_pond[pond] <span class="sc">~</span> <span class="fu">dnorm</span>(a_bar, sigma),</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>dsim<span class="sc">$</span>p_nopol <span class="ot">&lt;-</span> dsim<span class="sc">$</span>si<span class="sc">/</span>dsim<span class="sc">$</span>ni</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(fit)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>dsim<span class="sc">$</span>p_partpool <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">plogis</span>(post<span class="sc">$</span>a_pond), <span class="dv">2</span>, median)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate errors</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>nopool_error <span class="ot">&lt;-</span> <span class="fu">abs</span>(dsim<span class="sc">$</span>p_nopol<span class="sc">-</span>dsim<span class="sc">$</span>true_p)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>partpool_error <span class="ot">&lt;-</span> <span class="fu">abs</span>(dsim<span class="sc">$</span>p_partpool<span class="sc">-</span>dsim<span class="sc">$</span>true_p)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dsim<span class="sc">$</span>pond, dsim<span class="sc">$</span>p_nopol, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"blue"</span>, <span class="at">xlab =</span> <span class="st">"Pond ID"</span>, </span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Estimated Survival Probability"</span>, <span class="at">main =</span> title)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dsim<span class="sc">$</span>pond, dsim<span class="sc">$</span>p_partpool, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="co"># points(dsim$pond, dsim$true_p, pch = "X")</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>pbar <span class="ot">&lt;-</span> <span class="fu">plogis</span>(<span class="fu">median</span>(post<span class="sc">$</span>a_bar))</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">61</span>), <span class="fu">c</span>(pbar, pbar), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">15.5</span>, <span class="fl">15.5</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">30.5</span>, <span class="fl">30.5</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">45.5</span>, <span class="fl">45.5</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Average error per pond-size</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>error_avg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">list</span>(<span class="at">nopool_error =</span> nopool_error), </span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">list</span>(<span class="at">pondsize =</span> dsim<span class="sc">$</span>ni), mean)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>error_avg<span class="sc">$</span>partpool_error <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(partpool_error, <span class="fu">list</span>(dsim<span class="sc">$</span>ni), mean)[, <span class="dv">2</span>]</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(error_avg, <span class="dv">2</span>)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dsim<span class="sc">$</span>pond, nopool_error, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"blue"</span>, <span class="at">xlab =</span> <span class="st">"Pond ID"</span>, </span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Absolute error"</span>, <span class="at">main =</span> title)</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dsim<span class="sc">$</span>pond, partpool_error, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">61</span>), <span class="fu">c</span>(pbar, pbar), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">15.5</span>, <span class="fl">15.5</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">30.5</span>, <span class="fl">30.5</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">45.5</span>, <span class="fl">45.5</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines for average error</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">15</span><span class="sc">*</span>j, <span class="dv">14</span> <span class="sc">+</span> <span class="dv">15</span><span class="sc">*</span>j), <span class="fu">c</span>(error_avg[j<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2</span>], error_avg[j<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2</span>]), <span class="at">col =</span> <span class="st">"blue"</span> )</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">15</span><span class="sc">*</span>j, <span class="dv">14</span> <span class="sc">+</span> <span class="dv">15</span><span class="sc">*</span>j), <span class="fu">c</span>(error_avg[j<span class="sc">+</span><span class="dv">1</span>, <span class="dv">3</span>], error_avg[j<span class="sc">+</span><span class="dv">1</span>, <span class="dv">3</span>]), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And now let’s put that function to use and try out some variations of different parameters</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_tads</span>(<span class="at">title =</span> <span class="st">"A bar = 2, Sigma = 0.1"</span>) <span class="do">## McElreaths' baseline</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MMN1.2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MMN1.2-2.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_tads</span>(<span class="at">a_bar =</span> <span class="fl">0.8</span>, <span class="at">title =</span> <span class="st">"A_bar = 0.8, Sigma = 0.1"</span>) <span class="co"># low a bar</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MMN1.2-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MMN1.2-4.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_tads</span>(<span class="at">sigma =</span> <span class="fl">0.5</span>, <span class="at">title =</span> <span class="st">"A bar = 10, Sigma = 5"</span>) <span class="co">#Large sigma</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MMN1.2-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MMN1.2-6.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_tads</span>(<span class="at">a_bar =</span> <span class="dv">10</span>, <span class="at">title =</span> <span class="st">"A bar = 10, Sigma = 0.1"</span>) <span class="co">#High a bar</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MMN1.2-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MMN1.2-8.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Seenms like a few things happend here. First, when the survival rate was esentially, 100%, increasing clusters did not have any effect on the error rate. In all cases, there was more pooling with fewer smaller clusters, as we would expect.</p>
</section>
<section id="sr-13" class="level1">
<h1>SR 13</h1>
<p>My answers to the medium questions in chapter 13.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">M1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">M2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">M3</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false" href="">M4</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>The question says:</p>
<blockquote class="blockquote">
<p>“Revisit the Reed frog survival data, data(reedfrogs), and add the predation and size treatment variables to the varying intercepts model. Consider models with either main effect alone, both main effects, as well as a model including both and their interaction. Instead of focusing on inferences about these two predictor variables, focus on the inferred variation across tanks. Explain why it changes as it does across models.”</p>
</blockquote>
<p>We’ll start with a null model (M<sub>0</sub>), that includes unique intercepts for tank.</p>
<p><span class="math display">
\begin{aligned}
S_i &amp;\sim \mathrm{Binomial}(N_i, p_i)\\
logit_p &amp;= \alpha_{\text{TANK[i]}}\\
\alpha_j &amp;\sim \mathrm{Normal(\bar{\alpha}, \sigma)}\\
\bar{\alpha} &amp;\sim \mathrm{Normal}(0,1.5)\\
\sigma &amp;\sim \mathrm{Exponential}(1)
\end{aligned}
</span></p>
<p>And of course, specify it using rethinking code.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(reedfrogs)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> reedfrogs <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tank =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">48</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">S =</span> d<span class="sc">$</span>surv,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> d<span class="sc">$</span>density,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> d<span class="sc">$</span>size,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred =</span> d<span class="sc">$</span>pred,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tank =</span> d<span class="sc">$</span>tank,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank],</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(a_bar, sigma),</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, we do a more complicated model with main effects of both size and predation.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>m_size <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank] <span class="sc">+</span> size,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(a_bar, sigma),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    size <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>post_size <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_size)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>sigma_size <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">median</span>(post_size<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_size<span class="sc">$</span>sigma))</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>m_pred <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank] <span class="sc">+</span> bpred<span class="sc">*</span>pred,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(a_bar, sigma),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ),</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    bpred <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>post_pred <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_pred)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>sigma_pred <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">median</span>(post_pred<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_pred<span class="sc">$</span>sigma))</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>m_mfx <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank] <span class="sc">+</span> bsize<span class="sc">*</span>size <span class="sc">+</span> bpred<span class="sc">*</span>pred,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(a_bar, sigma),</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ),</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    bsize <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    bpred <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>post_mfx <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_mfx)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>sigma_mfx <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">median</span>(post_mfx<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_mfx<span class="sc">$</span>sigma))</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>m_int <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank] <span class="sc">+</span> apred[pred] <span class="sc">+</span> bsize[pred] <span class="sc">*</span> size ,</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(a_bar, sigma),</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ),</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    apred[pred] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    bsize[pred] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample from the posterior and calculate highest posterior density intercals</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>post_int <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_int)</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>sigma_int <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">median</span>(post_int<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_int<span class="sc">$</span>sigma))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We did this in class, so I’m going to highlight the important part, that we saw changes in sigma, but nothing else</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(sigma_size, sigma_pred, sigma_mfx, sigma_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                        |0.89    0.89|
sigma_size 1.6022450 1.260830 1.940020
sigma_pred 0.8282230 0.606508 1.072970
sigma_mfx  0.7807715 0.532715 1.004420
sigma_int  0.7352635 0.505847 0.958208</code></pre>
</div>
</div>
<p>Seems like including predator reduces sigma, but that’s it!</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<blockquote class="blockquote">
<p>“Compare the models you fit just above, using WAIC. Can you reconcile the differences in WAIC with the posterior distributions of the models?”</p>
</blockquote>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(m_mfx, m_size, m_int, m_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           WAIC       SE    dWAIC      dSE    pWAIC    weight
m_pred 198.8102 8.558102 0.000000       NA 19.07236 0.4800545
m_size 200.3282 6.985034 1.518007 5.522176 20.95642 0.2247292
m_int  200.7218 9.417068 1.911592 3.467001 19.55025 0.1845838
m_mfx  201.7456 8.556314 2.935372 3.312773 19.82517 0.1106325</code></pre>
</div>
</div>
<p>The waic values are pretty similar. Maybe that’s because our ability to predict the data didn’t change much.</p>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<blockquote class="blockquote">
<p>Re-estimate the basic Reed frog varying intercept model, but now using a Cauchy distribution in place of the Gaussian distribution for the varying intercepts.”</p>
</blockquote>
<blockquote class="blockquote">
<p>Compare the posterior means of the intercepts, tank, to the posterior means produced in the chapter, using the customary Gaussian prior. Can you explain the pattern of differences? Take note of any change in the mean α as well.”</p>
</blockquote>
<p>I start by fitting Gaussian and Cauchy models, like the question asks.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>m_cauchy <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank],</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dcauchy</span>(a_bar, sigma),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>m_gaussian <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank],</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">normal</span>(a_bar, sigma),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Okay, first, we are going to sample from the posterior distrbutions</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>post_cauchy <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_cauchy) </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>post_gaussian <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_gaussian)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And then compare the values that we get from that</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Yes, using this unweieldy code</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>cauchy_abar <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">median</span>(post_cauchy<span class="sc">$</span>a_bar), <span class="fu">HPDI</span>(post_cauchy<span class="sc">$</span>a_bar))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>cauchy_sigma <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">median</span>(post_cauchy<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_cauchy<span class="sc">$</span>sigma))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>gaussian_abar <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">median</span>(post_gaussian<span class="sc">$</span>a_bar), <span class="fu">HPDI</span>(post_gaussian<span class="sc">$</span>a_bar))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>gaussian_sigma <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">median</span>(post_gaussian<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_gaussian<span class="sc">$</span>sigma))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(cauchy_abar, gaussian_abar, cauchy_sigma, gaussian_sigma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                           |0.89   0.89|
cauchy_abar    1.486720 1.025860 1.97314
gaussian_abar  1.347780 0.930674 1.74534
cauchy_sigma   0.999007 0.665019 1.41823
gaussian_sigma 1.598365 1.291630 1.92991</code></pre>
</div>
</div>
<p>And doing this, it seems that cauchy leads to wider posteriors for abar and lower estimates of sigma.</p>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<blockquote class="blockquote">
<p>“Now use a Student-t distribution with ν=2 for the intercepts: αTANK~Student(2,α,σ) Refer back to the Student-t example in Chapter 7 (page 234), if necessary. Compare the resulting posterior to both the original model and the Cauchy model in 13M3. Can you explain the differences and similarities in shrinkage in terms of the properties of these distributions?”</p>
</blockquote>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>m_student <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank],</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="at">nu =</span> <span class="dv">2</span>, a_bar, sigma),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="at">nu =</span> <span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Doing the same as in m3:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>post_student <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_student)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>student_abar <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">median</span>(post_student<span class="sc">$</span>a_bar), <span class="fu">HPDI</span>(post_student<span class="sc">$</span>a_bar))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>student_sigma <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">median</span>(post_student<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_student<span class="sc">$</span>sigma))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And then putting it all together again</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(cauchy_abar, gaussian_abar, student_abar, cauchy_sigma, gaussian_sigma, student_sigma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                           |0.89   0.89|
cauchy_abar    1.486720 1.025860 1.97314
gaussian_abar  1.347780 0.930674 1.74534
student_abar   1.407340 0.920477 1.81295
cauchy_sigma   0.999007 0.665019 1.41823
gaussian_sigma 1.598365 1.291630 1.92991
student_sigma  1.250430 0.945971 1.61692</code></pre>
</div>
</div>
<p>It seems like student’s distribution is somewhere between gaussian and cauchy</p>
</div>
</div>
</div>
</section>
<section id="mn2" class="level1">
<h1>MN2</h1>
<blockquote class="blockquote">
<p>MN2: (a) Fit a varying intercept model to the running data, using rethinking::ulam or rstanarm::stan_glmer (or both). Visualize the results. (b) Do the same for the sleepstudy data.</p>
</blockquote>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">a</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">b</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>First, load the data and wrangle it lightly. The running data shows the effect of aging on running speeds.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"cherry_blossom_sample"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> cherry_blossom_sample <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_c =</span> age <span class="sc">-</span> <span class="dv">55</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Fit a simple varying intercepts model</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>m_runner <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    net <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    mu<span class="ot">&lt;-</span> a[runner] <span class="sc">+</span> bage<span class="sc">*</span>age_c,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    a[runner] <span class="sc">~</span> <span class="fu">normal</span>( a_bar, sigma_a),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    bage <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    sigma_a <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.11</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>How to visualize this? Maybe an overall plot with all the data and then a few plots for the individual runners to show that this is not good enough. The first plot shows the overall relationship between age and time. This is the unpooled data. Next, the data for individual runners is shown. The black line represents the complete pooling and the blue line shows partial pooling using the intercepts only model.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_runner)<span class="sc">$</span>a <span class="sc">%&gt;%</span> <span class="co"># get the intercepts for each runner in a dataframe</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"runner"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(runner) <span class="sc">%&gt;%</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">intercept =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">runner =</span> <span class="fu">gsub</span>(<span class="st">"V"</span>, <span class="st">""</span>, runner) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(runner)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>dat_combined <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="co">#add the intercepts to our original runner dataset</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post, <span class="at">by =</span> <span class="st">"runner"</span>) </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_c, <span class="at">y =</span> net)) <span class="sc">+</span> <span class="co">#plot the complete pooling data</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">90.70</span>, <span class="at">slope =</span>  <span class="fl">1.23</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MMN2.3-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dat_combined <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_c, <span class="at">y =</span> net)) <span class="sc">+</span> <span class="co"># again, fill in with numbers from m_runner</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="st">"runner"</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span>  <span class="fl">1.23</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fl">90.70</span>, <span class="at">slope =</span>  <span class="fl">1.23</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MMN2.3-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>For this model, we want to predict Reaction time as a function of days and subject.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> sleepstudy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Days<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Days_bl =</span> Days<span class="dv">-2</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>m_sleep <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    Reaction <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    mu<span class="ot">&lt;-</span> a[Subject] <span class="sc">+</span> b_days<span class="sc">*</span>Days_bl,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    a[Subject] <span class="sc">~</span> <span class="fu">normal</span>( a_bar, sigma_a),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">250</span>, <span class="dv">200</span>),</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    b_days <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">100</span>),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>),</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    sigma_a <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> d , <span class="at">chains =</span> <span class="dv">4</span> ,  <span class="at">refresh =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains, with 1 thread(s) per chain...

Chain 1 finished in 0.2 seconds.
Chain 2 finished in 0.2 seconds.
Chain 3 finished in 0.2 seconds.
Chain 4 finished in 0.2 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.2 seconds.
Total execution time: 1.2 seconds.</code></pre>
</div>
</div>
<p>I’m going to come back to this, but here is the code to visualize the data. The first plot shows the overall relationship between age and time. This is the unpooled data. Next, the data for individual runners is shown. The black line represents the complete pooling.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_sleep)<span class="sc">$</span>a <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Subject"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Subject) <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">intercept =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject =</span> <span class="fu">gsub</span>(<span class="st">"V"</span>, <span class="st">""</span>, Subject) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Subject)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `as.tibble()` was deprecated in tibble 2.0.0.
ℹ Please use `as_tibble()` instead.
ℹ The signature and semantics have changed, see `?as_tibble`.</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>d_combined <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="co"># add each person's intercept, useful for making the figure</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(Subject))) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post, <span class="at">by =</span> <span class="st">"Subject"</span>) </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>d_combined <span class="ot">&lt;-</span> d_combined <span class="sc">%&gt;%</span> <span class="co">#calculate the unpooled median for each subject</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Subject) <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unpooled =</span> <span class="fu">median</span>(Reaction)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Days_bl, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">267.72</span>, <span class="at">slope =</span>  <span class="fl">11.47</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="co"># fill in with numbers from m_sleep</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>d_combined <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Days_bl, <span class="at">y =</span> Reaction)) <span class="sc">+</span> <span class="co"># again, fill in with numbers from m_sleep</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="st">"Subject"</span>) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span>  <span class="fl">11.47</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fl">267.72</span>, <span class="at">slope =</span>  <span class="fl">11.47</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sr-14" class="level1">
<h1>SR 14</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">M1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">M2</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<blockquote class="blockquote">
<p>“Repeat the café robot simulation from the beginning of the chapter. This time, set rho to zero, so that there is no correlation between intercepts and slopes. How does the posterior distribution of the correlation reflect this change in the underlying simulation?”</p>
</blockquote>
<p>To answer this questions, I’ve made a function using McElreath’s code - <code>sim_mvn()</code>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS) <span class="co"># had to load this, seems some other package was overwriting the mvrnorm function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>sim_mvn <span class="ot">&lt;-</span> <span class="cf">function</span>(rho){</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fl">3.5</span> <span class="co"># average morning wait time</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span>) <span class="co"># average differene afternon wait time</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  sigma_a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#std dev in intercepts</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  sigma_b <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co">#sd in slopes</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  rho <span class="ot">&lt;-</span> rho <span class="co"># no correlation</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma_a, sigma_b) <span class="co">#standard deviations</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  Rho <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>) <span class="co">#correlation matrix</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigmas) <span class="sc">%*%</span> Rho <span class="sc">%*%</span> <span class="fu">diag</span>(sigmas)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  n_cafes <span class="ot">=</span> <span class="dv">20</span> <span class="co">#the number of cafes</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mvrnorm</span>(n_cafes, mu, sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">"Intercepts"</span> <span class="ot">=</span> V1,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Slopes"</span> <span class="ot">=</span> V2) <span class="sc">%&gt;%</span> </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Intercepts, <span class="at">y =</span> Slopes))<span class="sc">+</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="dv">4</span>) <span class="sc">+</span>  <span class="co">#This code feels a little sloppy, but I couldn't figure out a better way</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.1</span>, <span class="at">color =</span> <span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And now I carry out this function over <code>rho</code> of 0.1, 0.5, and 0.7.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_mvn</span>(<span class="at">rho =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/SR14-M1.2-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_mvn</span>(<span class="at">rho =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/SR14-M1.2-2.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_mvn</span>(<span class="at">rho =</span> <span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/SR14-M1.2-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The question was, how does the posterior distribution refelct this change. And it seems like, well, the two values are not as correlated. Also the ellipses are way less round. Seems like this doesn’t actually answer the question, but the graphs look neat, so I’m going to keep them!</p>
<p>Instead, I’m going to keep going and carry out the cafe simulations using McElreath’s code.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">3.5</span> <span class="co"># average morning wait time</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span>) <span class="co"># average differene afternon wait time</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>sigma_a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#std dev in intercepts</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>sigma_b <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co">#sd in slopes</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># no correlation</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma_a, sigma_b) <span class="co">#standard deviations</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>Rho <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>) <span class="co">#correlation matrix</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigmas) <span class="sc">%*%</span> Rho <span class="sc">%*%</span> <span class="fu">diag</span>(sigmas)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>n_cafes <span class="ot">=</span> <span class="dv">20</span> <span class="co">#the number of cafes</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>vary_effects <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_cafes, mu, sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Intercepts"</span> <span class="ot">=</span> V1,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Slopes"</span> <span class="ot">=</span> V2)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>a_cafe <span class="ot">=</span>vary_effects<span class="sc">$</span>Intercepts</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>b_cafe <span class="ot">=</span> vary_effects<span class="sc">$</span>Slopes</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>n_visits <span class="ot">=</span> <span class="dv">20</span> <span class="co"># how many visits?</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>afternoon <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, n_visits <span class="sc">*</span> n_cafes<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>cafe_id <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span> n_cafes, <span class="at">each =</span> n_visits)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">=</span> a_cafe[cafe_id]<span class="sc">*</span>b_cafe[cafe_id]<span class="sc">*</span>afternoon</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>wait <span class="ot">=</span> <span class="fu">rnorm</span>(n_visits<span class="sc">*</span>n_cafes, mu, sigma)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">cafe =</span> cafe_id, <span class="at">afternoon =</span> afternoon, <span class="at">wait =</span> wait)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Having simulated data, let’s fit a model. The question is, when rho is zero how do our posteriors differ from our priors?</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>m_cafesim <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>( </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    wait <span class="sc">~</span> <span class="fu">normal</span>(mu, sigma),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span>  a_cafe[cafe] <span class="sc">+</span> b_cafe[cafe]<span class="sc">*</span>afternoon,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(a_cafe, b_cafe)[cafe] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(a,b), rho, sigma_cafe),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">5</span>,<span class="dv">2</span>),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    sigma_cafe <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>)),</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Having fit the model, let’s plot the posterior against the prior. What do we get?</p>
<div class="cell" data-ouput="false">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">=</span> <span class="fu">extract.samples</span>(m_cafesim)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>( post<span class="sc">$</span>rho[,<span class="dv">1</span>,<span class="dv">2</span>] , <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) )</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">rlkjcorr</span>( <span class="fl">1e4</span> , <span class="at">K=</span><span class="dv">2</span> , <span class="at">eta=</span><span class="dv">2</span> )<span class="co"># prior</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>( R[,<span class="dv">1</span>,<span class="dv">2</span>] , <span class="at">add=</span><span class="cn">TRUE</span> , <span class="at">lty=</span><span class="dv">2</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/SR14-M1.5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ah. It seems the takeaway is that the posterior is almost exactly the same as the prior.</p>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<blockquote class="blockquote">
<p>“Fit this multilevel model to the simulated café data:</p>
</blockquote>
<p><span class="math display">
\begin{aligned}
\text{Wait}_{i} &amp; \sim \mathrm{Normal}(\mu_{i}, \sigma) \\
\mu_i &amp; = \alpha_{\text{CAFE}[i]} +\beta_{\text{CAFE}[i]}\text{A}_i\\
\alpha_{\text{CAFE}[i]} &amp; \sim \mathrm{Normal}(\alpha, \sigma_{\alpha})\\
\beta_{\text{CAFE}[i]} &amp; \sim \mathrm{Normal}(\beta,  \sigma_{\beta})\\
\alpha &amp; \sim \mathrm{Normal}(0,10)\\
\beta &amp; \sim \mathrm{Normal}(0,3)\\
\sigma, \sigma_{\alpha}, \sigma_{\beta} &amp;\sim \mathrm{Exponential}(1)\\
\end{aligned}
</span> I think McElreath forgot to add something here, maybe an extra <span class="math inline">\beta</span> somewhere. So I stuck one in there, with what seemed like a vaguely reasonable prior.</p>
<blockquote class="blockquote">
<p>Use WAIC to compare this model to the model from the chapter, the one that uses a multi-variate Gaussian prior. Explain the result.”</p>
</blockquote>
<p>McElreath is a little bit unclear here, but I assume he means that we should use his original simulation, not the one we did just now, so that’s what I’m going to do.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">3.5</span> <span class="co"># average morning wait time</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span>) <span class="co"># average differene afternon wait time</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>sigma_a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#std dev in intercepts</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>sigma_b <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co">#sd in slopes</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.7</span> <span class="co"># no correlation</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma_a, sigma_b) <span class="co">#standard deviations</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>Rho <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>) <span class="co">#correlation matrix</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigmas) <span class="sc">%*%</span> Rho <span class="sc">%*%</span> <span class="fu">diag</span>(sigmas)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>n_cafes <span class="ot">=</span> <span class="dv">20</span> <span class="co">#the number of cafes</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>vary_effects <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_cafes, mu, sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Intercepts"</span> <span class="ot">=</span> V1,</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Slopes"</span> <span class="ot">=</span> V2)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>a_cafe <span class="ot">=</span>vary_effects<span class="sc">$</span>Intercepts</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>b_cafe <span class="ot">=</span> vary_effects<span class="sc">$</span>Slopes</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>n_visits <span class="ot">=</span> <span class="dv">20</span> <span class="co"># how many visits?</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>afternoon <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, n_visits <span class="sc">*</span> n_cafes<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>cafe_id <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span> n_cafes, <span class="at">each =</span> n_visits)</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">=</span> a_cafe[cafe_id]<span class="sc">+</span>b_cafe[cafe_id]<span class="sc">*</span>afternoon</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>wait <span class="ot">=</span> <span class="fu">rnorm</span>(n_visits<span class="sc">*</span>n_cafes, mu, sigma)</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">cafe =</span> cafe_id, <span class="at">afternoon =</span> afternoon, <span class="at">wait =</span> wait)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>having simulated the data, let’s fit two models, one with covarying slopes and intercepts and one just varying slopes &amp; intercepts.</p>
<div class="cell" data-ouput="false">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#no covariation</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>m_novariation <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>( </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    wait <span class="sc">~</span> <span class="fu">normal</span>(mu, sigma),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span>  a[cafe] <span class="sc">+</span> b[cafe]<span class="sc">*</span>afternoon,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    a[cafe] <span class="sc">~</span> <span class="fu">normal</span>(a, sigma_a),</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    b[cafe] <span class="sc">~</span> <span class="fu">normal</span>(b, sigma_b),</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>),</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">3</span>),</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    sigma_a <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    sigma_b <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>)),</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains, with 1 thread(s) per chain...

Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 23, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 2 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 2 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 2 Iteration: 200 / 1000 [ 20%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 27, column 4 to column 32)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 3 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 3 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 3 Iteration: 200 / 1000 [ 20%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 27, column 4 to column 32)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 4 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 4 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f1b4dbe2d.stan', line 22, column 4 to column 30)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 2 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 2 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 2 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 2 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 3 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 4 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 4 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 2 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 2 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 2 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 4 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 4 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 4 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 2 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 2 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 3 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 3 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 3 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 3 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 4 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 4 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 4 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 2 finished in 0.4 seconds.
Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 3 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 3 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 4 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 4 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 4 finished in 0.5 seconds.
Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 3 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 3 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 1 finished in 0.6 seconds.
Chain 3 finished in 0.7 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.5 seconds.
Total execution time: 0.7 seconds.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 2000 of 2000 (100.0%) transitions ended with a divergence.
See https://mc-stan.org/misc/warnings for details.</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co">#covarying slopes &amp; intercepts</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>m_covarying <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>( </span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>    wait <span class="sc">~</span> <span class="fu">normal</span>(mu, sigma),</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span>  a_cafe[cafe] <span class="sc">+</span> b_cafe[cafe]<span class="sc">*</span>afternoon,</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(a_cafe, b_cafe)[cafe] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(a,b), rho, sigma_cafe),</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">5</span>,<span class="dv">2</span>),</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>    sigma_cafe <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>    rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>)),</span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains, with 1 thread(s) per chain...

Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 2 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 2 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 3 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 3 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 4 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 4 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f22f04c52.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 2 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 2 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 3 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 3 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 4 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 4 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 2 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 2 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 2 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 3 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 3 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 3 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 4 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 4 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 4 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 2 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 2 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 3 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 3 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 4 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 4 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 2 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 2 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 3 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 3 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 4 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 4 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 2 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 3 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 4 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 1 finished in 0.6 seconds.
Chain 2 finished in 0.6 seconds.
Chain 3 finished in 0.6 seconds.
Chain 4 finished in 0.6 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.6 seconds.
Total execution time: 0.7 seconds.</code></pre>
</div>
</div>
<p>When we compare them, they look pretty similar? I wonder if I did something wrong or if there is a deeper point here…</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(m_covarying, m_novariation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  WAIC       SE    dWAIC      dSE    pWAIC    weight
m_novariation 609.3639 26.19277 0.000000       NA 29.61637 0.6510215
m_covarying   610.6110 26.12523 1.247064 9.334569 34.24657 0.3489785</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="mn3" class="level1">
<h1>MN3</h1>
<blockquote class="blockquote">
<p>Repeat the café simulation from the book (section 14.1), but for scenarios with less and more visits to each café (N_visits = 10 in the book), display result for each simulation in way that visualizes the difference (shrinking) in MLM compared to a no-pooling model. At what sample size (N_visits) do partial and no pooling lead to the same results?</p>
</blockquote>
<p>Here’s how I feel about the café data.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/UPw-3e_pzqU" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Anyway, since the question involves carrying out the same operation multiple times with different parameters, I’m going to start by making a function of the whole thing, again, basically taking a version o McElreath’s code.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>simulate_cafe <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">visits =</span> visits){</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fl">3.5</span> <span class="co"># average morning wait time</span></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span>) <span class="co"># average differene afternon wait time</span></span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a>  sigma_a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#std dev in intercepts</span></span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a>  sigma_b <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co">#sd in slopes</span></span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a>  rho <span class="ot">&lt;-</span> <span class="fl">0.7</span> <span class="co"># no correlation</span></span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-8"><a href="#cb270-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-9"><a href="#cb270-9" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)</span>
<span id="cb270-10"><a href="#cb270-10" aria-hidden="true" tabindex="-1"></a>  sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma_a, sigma_b) <span class="co">#standard deviations</span></span>
<span id="cb270-11"><a href="#cb270-11" aria-hidden="true" tabindex="-1"></a>  Rho <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>) <span class="co">#correlation matrix</span></span>
<span id="cb270-12"><a href="#cb270-12" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigmas) <span class="sc">%*%</span> Rho <span class="sc">%*%</span> <span class="fu">diag</span>(sigmas)</span>
<span id="cb270-13"><a href="#cb270-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-14"><a href="#cb270-14" aria-hidden="true" tabindex="-1"></a>  n_cafes <span class="ot">=</span> <span class="dv">20</span> <span class="co">#the number of cafes</span></span>
<span id="cb270-15"><a href="#cb270-15" aria-hidden="true" tabindex="-1"></a>  vary_effects <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_cafes, mu, sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb270-16"><a href="#cb270-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb270-17"><a href="#cb270-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">"Intercepts"</span> <span class="ot">=</span> V1,</span>
<span id="cb270-18"><a href="#cb270-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Slopes"</span> <span class="ot">=</span> V2)</span>
<span id="cb270-19"><a href="#cb270-19" aria-hidden="true" tabindex="-1"></a>  a_cafe <span class="ot">=</span>vary_effects<span class="sc">$</span>Intercepts</span>
<span id="cb270-20"><a href="#cb270-20" aria-hidden="true" tabindex="-1"></a>  b_cafe <span class="ot">=</span> vary_effects<span class="sc">$</span>Slopes</span>
<span id="cb270-21"><a href="#cb270-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-22"><a href="#cb270-22" aria-hidden="true" tabindex="-1"></a>   <span class="co"># how many visits?</span></span>
<span id="cb270-23"><a href="#cb270-23" aria-hidden="true" tabindex="-1"></a>  afternoon <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, visits <span class="sc">*</span> n_cafes<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb270-24"><a href="#cb270-24" aria-hidden="true" tabindex="-1"></a>  cafe_id <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span> n_cafes, <span class="at">each =</span> visits)</span>
<span id="cb270-25"><a href="#cb270-25" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">=</span> a_cafe[cafe_id]<span class="sc">+</span>b_cafe[cafe_id]<span class="sc">*</span>afternoon</span>
<span id="cb270-26"><a href="#cb270-26" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb270-27"><a href="#cb270-27" aria-hidden="true" tabindex="-1"></a>  wait <span class="ot">=</span> <span class="fu">rnorm</span>(visits<span class="sc">*</span>n_cafes, mu, sigma)</span>
<span id="cb270-28"><a href="#cb270-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">cafe =</span> cafe_id, <span class="at">afternoon =</span> afternoon, <span class="at">wait =</span> wait))</span>
<span id="cb270-29"><a href="#cb270-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And then I run the simulations with varying numbers of visits.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">simulate_cafe</span>(<span class="at">visits =</span> <span class="dv">2</span>)</span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>d5 <span class="ot">&lt;-</span> <span class="fu">simulate_cafe</span>(<span class="at">visits =</span> <span class="dv">5</span>)</span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>d10 <span class="ot">&lt;-</span> <span class="fu">simulate_cafe</span>(<span class="at">visits =</span> <span class="dv">10</span>)</span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a>d20 <span class="ot">&lt;-</span> <span class="fu">simulate_cafe</span>(<span class="at">visits =</span> <span class="dv">20</span>)</span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>d50 <span class="ot">&lt;-</span> <span class="fu">simulate_cafe</span>(<span class="at">visits =</span> <span class="dv">50</span>)</span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a>d100 <span class="ot">&lt;-</span> <span class="fu">simulate_cafe</span>(<span class="at">visits =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I thought about being fancy and doing the comparisons of pooling and no pooling with some tidyverse style, but it’s too much work, so I’m just going to hack into McElerath’s code again.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>fit_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> d2){</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>( </span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>    wait <span class="sc">~</span> <span class="fu">normal</span>(mu, sigma),</span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span>  a_cafe[cafe] <span class="sc">+</span> b_cafe[cafe]<span class="sc">*</span>afternoon,</span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(a_cafe, b_cafe)[cafe] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(a,b), rho, sigma_cafe),</span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">5</span>,<span class="dv">2</span>),</span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a>    sigma_cafe <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb272-11"><a href="#cb272-11" aria-hidden="true" tabindex="-1"></a>    rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>)),</span>
<span id="cb272-12"><a href="#cb272-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb272-13"><a href="#cb272-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb272-14"><a href="#cb272-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb272-15"><a href="#cb272-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb272-16"><a href="#cb272-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb272-17"><a href="#cb272-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-18"><a href="#cb272-18" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data</span>
<span id="cb272-19"><a href="#cb272-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-20"><a href="#cb272-20" aria-hidden="true" tabindex="-1"></a><span class="co">#grabbbing the unpooled estimates from the data</span></span>
<span id="cb272-21"><a href="#cb272-21" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span> n_cafes, <span class="cf">function</span>(i) <span class="fu">mean</span>(dat<span class="sc">$</span>wait[dat<span class="sc">$</span>cafe <span class="sc">==</span> i <span class="sc">&amp;</span> dat<span class="sc">$</span>afternoon <span class="sc">==</span> <span class="dv">0</span>]))</span>
<span id="cb272-22"><a href="#cb272-22" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span> n_cafes, <span class="cf">function</span>(i) <span class="fu">mean</span>(dat<span class="sc">$</span>wait[dat<span class="sc">$</span>cafe <span class="sc">==</span> i <span class="sc">&amp;</span> dat<span class="sc">$</span>afternoon <span class="sc">==</span> <span class="dv">1</span>]))<span class="sc">-</span>a1</span>
<span id="cb272-23"><a href="#cb272-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-24"><a href="#cb272-24" aria-hidden="true" tabindex="-1"></a><span class="co"># extract posterior means of partially pooled estimates</span></span>
<span id="cb272-25"><a href="#cb272-25" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(fit)</span>
<span id="cb272-26"><a href="#cb272-26" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fu">apply</span>( post<span class="sc">$</span>a_cafe , <span class="dv">2</span> , mean )</span>
<span id="cb272-27"><a href="#cb272-27" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fu">apply</span>( post<span class="sc">$</span>b_cafe , <span class="dv">2</span> , mean )</span>
<span id="cb272-28"><a href="#cb272-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-29"><a href="#cb272-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-30"><a href="#cb272-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-31"><a href="#cb272-31" aria-hidden="true" tabindex="-1"></a><span class="co">#plot both and connect with lines</span></span>
<span id="cb272-32"><a href="#cb272-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a1, b1, <span class="at">xlab =</span> <span class="st">"intercept"</span>, <span class="at">ylab =</span> <span class="st">"slope"</span>, </span>
<span id="cb272-33"><a href="#cb272-33" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"blue"</span>,</span>
<span id="cb272-34"><a href="#cb272-34" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb272-35"><a href="#cb272-35" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span><span class="fu">c</span>(<span class="fu">min</span>(b1)<span class="sc">-</span> <span class="fl">0.1</span>, <span class="fu">max</span>(b1) <span class="sc">+</span> <span class="fl">0.1</span>), </span>
<span id="cb272-36"><a href="#cb272-36" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span><span class="fu">c</span>(<span class="fu">min</span>(a1)<span class="sc">-</span> <span class="fl">0.1</span>, <span class="fu">max</span>(a1) <span class="sc">+</span> <span class="fl">0.1</span>))</span>
<span id="cb272-37"><a href="#cb272-37" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(a2, b2, <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb272-38"><a href="#cb272-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_cafes) <span class="fu">lines</span>(<span class="fu">c</span>(a1[i],a2[i]) , <span class="fu">c</span>(b1[i],b2[i]))</span>
<span id="cb272-39"><a href="#cb272-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-40"><a href="#cb272-40" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(fit)</span>
<span id="cb272-41"><a href="#cb272-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-42"><a href="#cb272-42" aria-hidden="true" tabindex="-1"></a><span class="co">#compute posterior mean bivariate gaussian</span></span>
<span id="cb272-43"><a href="#cb272-43" aria-hidden="true" tabindex="-1"></a>Mu_est <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(post<span class="sc">$</span>a) , <span class="fu">mean</span>(post<span class="sc">$</span>b) )</span>
<span id="cb272-44"><a href="#cb272-44" aria-hidden="true" tabindex="-1"></a>rho_est <span class="ot">&lt;-</span> <span class="fu">mean</span>( post<span class="sc">$</span>rho[,<span class="dv">1</span>,<span class="dv">2</span>] )</span>
<span id="cb272-45"><a href="#cb272-45" aria-hidden="true" tabindex="-1"></a>sa_est <span class="ot">&lt;-</span> <span class="fu">mean</span>( post<span class="sc">$</span>sigma_cafe[,<span class="dv">1</span>] )</span>
<span id="cb272-46"><a href="#cb272-46" aria-hidden="true" tabindex="-1"></a>sb_est <span class="ot">&lt;-</span> <span class="fu">mean</span>( post<span class="sc">$</span>sigma_cafe[,<span class="dv">2</span>] )</span>
<span id="cb272-47"><a href="#cb272-47" aria-hidden="true" tabindex="-1"></a>cov_ab <span class="ot">&lt;-</span> sa_est<span class="sc">*</span>sb_est<span class="sc">*</span>rho_est</span>
<span id="cb272-48"><a href="#cb272-48" aria-hidden="true" tabindex="-1"></a>Sigma_est <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="fu">c</span>(sa_est<span class="sc">^</span><span class="dv">2</span>,cov_ab,cov_ab,sb_est<span class="sc">^</span><span class="dv">2</span>) , <span class="at">ncol=</span><span class="dv">2</span> )</span>
<span id="cb272-49"><a href="#cb272-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-50"><a href="#cb272-50" aria-hidden="true" tabindex="-1"></a><span class="co"># draw contours</span></span>
<span id="cb272-51"><a href="#cb272-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ellipse)</span>
<span id="cb272-52"><a href="#cb272-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( l <span class="cf">in</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">0.99</span>) )</span>
<span id="cb272-53"><a href="#cb272-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">ellipse</span>(Sigma_est,<span class="at">centre=</span>Mu_est,<span class="at">level=</span>l),</span>
<span id="cb272-54"><a href="#cb272-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">"black"</span>,<span class="fl">0.2</span>))</span>
<span id="cb272-55"><a href="#cb272-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-56"><a href="#cb272-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-57"><a href="#cb272-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb272-58"><a href="#cb272-58" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(d2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains, with 1 thread(s) per chain...

Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 2 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 2 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 3 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 3 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 3 Iteration: 200 / 1000 [ 20%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 4 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 4 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 4 Iteration: 200 / 1000 [ 20%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f53e9ba43.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 2 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 2 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 2 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 3 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 3 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 3 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 3 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 4 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 4 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 4 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 4 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 4 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 2 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 2 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 2 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 3 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 3 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 4 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 4 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 4 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 2 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 2 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 3 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 4 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 4 finished in 0.4 seconds.
Chain 2 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 2 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 2 finished in 0.5 seconds.
Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 3 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 3 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 3 finished in 0.7 seconds.
Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 1 finished in 1.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.7 seconds.
Total execution time: 1.1 seconds.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 12 of 2000 (1.0%) transitions ended with a divergence.
See https://mc-stan.org/misc/warnings for details.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 2 of 4 chains had an E-BFMI less than 0.2.
See https://mc-stan.org/misc/warnings for details.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ellipse'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:rethinking':

    pairs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    pairs</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MN3.4-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb369"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(d10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains, with 1 thread(s) per chain...

Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 2 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 2 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 3 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 3 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 4 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 4 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 4 Iteration: 200 / 1000 [ 20%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: multi_normal_lpdf: LDLT_Factor of covariance parameter is not positive definite.  last conditional variance is 0. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f29551a1d.stan', line 27, column 4 to column 63)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 2 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 2 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 2 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 3 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 3 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 3 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 4 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 4 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 2 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 2 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 2 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 3 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 3 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 3 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 4 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 4 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 4 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 4 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 2 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 2 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 3 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 3 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 4 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 4 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 1 finished in 0.4 seconds.
Chain 2 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 2 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 3 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 3 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 4 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 2 finished in 0.5 seconds.
Chain 3 finished in 0.5 seconds.
Chain 4 finished in 0.5 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.5 seconds.
Total execution time: 0.6 seconds.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 22 of 2000 (1.0%) transitions ended with a divergence.
See https://mc-stan.org/misc/warnings for details.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MN3.4-2.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb446"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(d20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains, with 1 thread(s) per chain...

Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: multi_normal_lpdf: Covariance matrix is not symmetric. Covariance matrix[1,2] = -1.86331e+09, but Covariance matrix[2,1] = -1.86331e+09 (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 27, column 4 to column 63)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 2 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 2 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 3 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 3 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 4 Iteration:   1 / 1000 [  0%]  (Warmup) 
Chain 4 Iteration: 100 / 1000 [ 10%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f275cc27.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 2 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 2 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 3 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 3 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 4 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 4 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 2 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 2 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 2 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 3 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 3 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 3 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 4 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 4 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 4 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 2 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 2 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 3 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 3 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 4 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 4 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 2 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 2 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 3 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 3 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 4 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 4 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 2 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 3 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 4 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 1 finished in 0.6 seconds.
Chain 2 finished in 0.6 seconds.
Chain 3 finished in 0.6 seconds.
Chain 4 finished in 0.6 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.6 seconds.
Total execution time: 0.7 seconds.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MN3.4-3.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb557"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb557-1"><a href="#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(d50)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains, with 1 thread(s) per chain...

Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 2 Iteration:   1 / 1000 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 3 Iteration:   1 / 1000 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: multi_normal_lpdf: Covariance matrix is not symmetric. Covariance matrix[1,2] = -1.82954e+28, but Covariance matrix[2,1] = -1.82954e+28 (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 27, column 4 to column 63)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 4 Iteration:   1 / 1000 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f328d69bf.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 2 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 3 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 4 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 2 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 3 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 4 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 2 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 2 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 3 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 4 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 3 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 4 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 2 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 2 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 3 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 3 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 4 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 4 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 2 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 3 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 4 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 2 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 3 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 4 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 2 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 3 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 4 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 2 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 3 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 4 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 2 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 3 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 4 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 1 finished in 1.1 seconds.
Chain 2 finished in 1.1 seconds.
Chain 3 finished in 1.1 seconds.
Chain 4 finished in 1.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 1.1 seconds.
Total execution time: 1.2 seconds.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MN3.4-4.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb698"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb698-1"><a href="#cb698-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(d100)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains, with 1 thread(s) per chain...

Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: multi_normal_lpdf: Covariance matrix is not symmetric. Covariance matrix[1,2] = -5.77051e+18, but Covariance matrix[2,1] = -5.77051e+18 (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 27, column 4 to column 63)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 2 Iteration:   1 / 1000 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 3 Iteration:   1 / 1000 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 4 Iteration:   1 / 1000 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: lkj_corr_lpdf: Correlation matrix is not positive definite. (in '/var/folders/ky/9r71kfzx25d43wn2dtb6y_080000gp/T/RtmpK912yt/model-1490f7aac2b53.stan', line 17, column 4 to column 24)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 2 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 4 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 3 Iteration: 100 / 1000 [ 10%]  (Warmup) 
Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 2 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 3 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 4 Iteration: 200 / 1000 [ 20%]  (Warmup) 
Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 4 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 2 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 3 Iteration: 300 / 1000 [ 30%]  (Warmup) 
Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 2 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 4 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 3 Iteration: 400 / 1000 [ 40%]  (Warmup) 
Chain 2 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 2 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 4 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 4 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 3 Iteration: 500 / 1000 [ 50%]  (Warmup) 
Chain 3 Iteration: 501 / 1000 [ 50%]  (Sampling) 
Chain 2 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 3 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 4 Iteration: 600 / 1000 [ 60%]  (Sampling) 
Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 2 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 3 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 4 Iteration: 700 / 1000 [ 70%]  (Sampling) 
Chain 2 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 4 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 3 Iteration: 800 / 1000 [ 80%]  (Sampling) 
Chain 2 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 3 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 4 Iteration: 900 / 1000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 2 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 1 finished in 1.8 seconds.
Chain 3 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 4 Iteration: 1000 / 1000 [100%]  (Sampling) 
Chain 2 finished in 1.9 seconds.
Chain 3 finished in 2.0 seconds.
Chain 4 finished in 2.0 seconds.

All 4 chains finished successfully.
Mean chain execution time: 1.9 seconds.
Total execution time: 2.0 seconds.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MN3.4-5.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Clearly, the larger the clusters are, the less pooling you get. Makes sense.</p>
</section>
<section id="mn4" class="level1">
<h1>MN4:</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">a</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">b</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<blockquote class="blockquote">
<p>Fit a varying intercept &amp; slope model to the running data, using rethinking::ulam or rstanarm::stan_glmer (or both).Visualize the results and briefly compare to results from MN 2.</p>
</blockquote>
<p>Start by loading the data.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb804"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb804-1"><a href="#cb804-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb804-2"><a href="#cb804-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"cherry_blossom_sample"</span>)</span>
<span id="cb804-3"><a href="#cb804-3" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> cherry_blossom_sample <span class="sc">%&gt;%</span> </span>
<span id="cb804-4"><a href="#cb804-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_c =</span> age <span class="sc">-</span> <span class="dv">55</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Fit the slopes model</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb805"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb805-1"><a href="#cb805-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> g <span class="sc">%&gt;%</span></span>
<span id="cb805-2"><a href="#cb805-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb805-3"><a href="#cb805-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb805-4"><a href="#cb805-4" aria-hidden="true" tabindex="-1"></a>m_runner_slopes <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb805-5"><a href="#cb805-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb805-6"><a href="#cb805-6" aria-hidden="true" tabindex="-1"></a>    net <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb805-7"><a href="#cb805-7" aria-hidden="true" tabindex="-1"></a>    mu<span class="ot">&lt;-</span> a_runner[runner] <span class="sc">+</span> b_runner[runner]<span class="sc">*</span>age_c,</span>
<span id="cb805-8"><a href="#cb805-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(a_runner,b_runner)[runner] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(a,b), rho, sigma_runner),</span>
<span id="cb805-9"><a href="#cb805-9" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb805-10"><a href="#cb805-10" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb805-11"><a href="#cb805-11" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="fl">0.5</span>),</span>
<span id="cb805-12"><a href="#cb805-12" aria-hidden="true" tabindex="-1"></a>    sigma_runner <span class="sc">~</span> <span class="fu">exponential</span>(<span class="fl">0.5</span>),</span>
<span id="cb805-13"><a href="#cb805-13" aria-hidden="true" tabindex="-1"></a>    rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">1</span>) ),</span>
<span id="cb805-14"><a href="#cb805-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat ,</span>
<span id="cb805-15"><a href="#cb805-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span> ,</span>
<span id="cb805-16"><a href="#cb805-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span>, </span>
<span id="cb805-17"><a href="#cb805-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains, with 1 thread(s) per chain...

Chain 1 finished in 1.0 seconds.
Chain 2 finished in 0.8 seconds.
Chain 3 finished in 1.1 seconds.
Chain 4 finished in 1.6 seconds.

All 4 chains finished successfully.
Mean chain execution time: 1.1 seconds.
Total execution time: 4.8 seconds.</code></pre>
</div>
</div>
<p>This recapitulates what we did in MN2, but now with slopes. So I’m going to build on that code.</p>
<p>First, let’s just compare the outputs of both models.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb807"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb807-1"><a href="#cb807-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m_runner)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>36 vector or matrix parameters hidden. Use depth=2 to show them.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>             mean        sd        5.5%     94.5%       n_eff    Rhat4
a_bar   90.535222 2.0028386 87.36810900 93.963952 1799.961731 1.004798
bage     1.044570 0.4467858  0.01004483  1.544718    3.996514 1.528315
sigma    7.385445 3.7616274  4.80776510 14.344067    2.027687 8.924618
sigma_a 10.033949 5.9383652  0.02880836 15.772703    2.093923 4.543091</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb810"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb810-1"><a href="#cb810-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m_runner_slopes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>78 vector or matrix parameters hidden. Use depth=2 to show them.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>           mean        sd      5.5%     94.5%     n_eff    Rhat4
a     91.108270 2.1390846 87.585127 94.132511  49.23527 1.095896
b      1.300864 0.2467777  0.897694  1.641791 147.29943 1.049925
sigma  5.011457 0.2939175  4.553756  5.488515 580.20589 1.006673</code></pre>
</div>
</div>
<p>These estimates are fairly similar. I would have expected the posteriors of the beta and alpha estimates to be wider for the slopes model and the sigma estimates to be narrower, but this seem to not exactly be the case. Interesting…</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb813"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb813-1"><a href="#cb813-1" aria-hidden="true" tabindex="-1"></a>post_a <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_runner_slopes)<span class="sc">$</span>a_runner <span class="sc">%&gt;%</span>  <span class="co"># get the individuals interceps</span></span>
<span id="cb813-2"><a href="#cb813-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb813-3"><a href="#cb813-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"runner"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb813-4"><a href="#cb813-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(runner) <span class="sc">%&gt;%</span> </span>
<span id="cb813-5"><a href="#cb813-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">intercept =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb813-6"><a href="#cb813-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">runner =</span> <span class="fu">gsub</span>(<span class="st">"V"</span>, <span class="st">""</span>, runner) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb813-7"><a href="#cb813-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(runner)</span>
<span id="cb813-8"><a href="#cb813-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb813-9"><a href="#cb813-9" aria-hidden="true" tabindex="-1"></a>post_b <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_runner_slopes)<span class="sc">$</span>b_runner <span class="sc">%&gt;%</span>  <span class="co"># get the individual slopes</span></span>
<span id="cb813-10"><a href="#cb813-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb813-11"><a href="#cb813-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"runner"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb813-12"><a href="#cb813-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(runner) <span class="sc">%&gt;%</span> </span>
<span id="cb813-13"><a href="#cb813-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">slope =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb813-14"><a href="#cb813-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">runner =</span> <span class="fu">gsub</span>(<span class="st">"V"</span>, <span class="st">""</span>, runner) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb813-15"><a href="#cb813-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(runner)</span>
<span id="cb813-16"><a href="#cb813-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb813-17"><a href="#cb813-17" aria-hidden="true" tabindex="-1"></a>dat_combined <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span>  <span class="co">#add the slopes and intercepts to the dataframe</span></span>
<span id="cb813-18"><a href="#cb813-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post_a, <span class="at">by =</span> <span class="st">"runner"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb813-19"><a href="#cb813-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post_b, <span class="at">by =</span> <span class="st">"runner"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb813-20"><a href="#cb813-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unpooled =</span> <span class="fu">mean</span>(net)) <span class="sc">%&gt;%</span> </span>
<span id="cb813-21"><a href="#cb813-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb813-22"><a href="#cb813-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb813-23"><a href="#cb813-23" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_c, <span class="at">y =</span> net)) <span class="sc">+</span></span>
<span id="cb813-24"><a href="#cb813-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb813-25"><a href="#cb813-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">90.70</span>, <span class="at">slope =</span>  <span class="fl">1.23</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb813-26"><a href="#cb813-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MN4A.4-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb814"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb814-1"><a href="#cb814-1" aria-hidden="true" tabindex="-1"></a>dat_combined <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_c, <span class="at">y =</span> net)) <span class="sc">+</span> <span class="co"># again, fill in with numbers from m_sleep</span></span>
<span id="cb814-2"><a href="#cb814-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb814-3"><a href="#cb814-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="st">"runner"</span>) <span class="sc">+</span></span>
<span id="cb814-4"><a href="#cb814-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_abline(aes(intercept = unpooled, slope =  1.23), linetype = "dashed", color = "red")+</span></span>
<span id="cb814-5"><a href="#cb814-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span>  slope), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb814-6"><a href="#cb814-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fl">90.70</span>, <span class="at">slope =</span>  <span class="fl">1.23</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb814-7"><a href="#cb814-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/MN4A.4-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Unsurprisingly, the plots suggest that the slopes models are better at capturing individual variation.</p>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<blockquote class="blockquote">
<p>Do the same for the sleepstudy data</p>
</blockquote>
<p>Once again, load the data and fit the model.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb815"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb815-1"><a href="#cb815-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> sleepstudy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Days<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Days_bl =</span> Days<span class="dv">-2</span>)</span>
<span id="cb815-2"><a href="#cb815-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-3"><a href="#cb815-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-4"><a href="#cb815-4" aria-hidden="true" tabindex="-1"></a>m_sleep_slopes <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb815-5"><a href="#cb815-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb815-6"><a href="#cb815-6" aria-hidden="true" tabindex="-1"></a>    Reaction <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb815-7"><a href="#cb815-7" aria-hidden="true" tabindex="-1"></a>    mu<span class="ot">&lt;-</span> a_subject[Subject] <span class="sc">+</span> b_subject[Subject]<span class="sc">*</span>Days_bl,</span>
<span id="cb815-8"><a href="#cb815-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(a_subject,b_subject)[Subject] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(a,b), rho, sigma_subject),</span>
<span id="cb815-9"><a href="#cb815-9" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">250</span>, <span class="dv">200</span>),</span>
<span id="cb815-10"><a href="#cb815-10" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb815-11"><a href="#cb815-11" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="fl">0.1</span>),</span>
<span id="cb815-12"><a href="#cb815-12" aria-hidden="true" tabindex="-1"></a>    sigma_subject <span class="sc">~</span> <span class="fu">exponential</span>(<span class="fl">0.1</span>),</span>
<span id="cb815-13"><a href="#cb815-13" aria-hidden="true" tabindex="-1"></a>    rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">1</span>) ),</span>
<span id="cb815-14"><a href="#cb815-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d ,</span>
<span id="cb815-15"><a href="#cb815-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span> ,</span>
<span id="cb815-16"><a href="#cb815-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span>, </span>
<span id="cb815-17"><a href="#cb815-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb816"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb816-1"><a href="#cb816-1" aria-hidden="true" tabindex="-1"></a>post_intercept <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_sleep_slopes)<span class="sc">$</span>a_subject <span class="sc">%&gt;%</span> </span>
<span id="cb816-2"><a href="#cb816-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb816-3"><a href="#cb816-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Subject"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb816-4"><a href="#cb816-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Subject) <span class="sc">%&gt;%</span> </span>
<span id="cb816-5"><a href="#cb816-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">intercept =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb816-6"><a href="#cb816-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject =</span> <span class="fu">gsub</span>(<span class="st">"V"</span>, <span class="st">""</span>, Subject) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb816-7"><a href="#cb816-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Subject)</span>
<span id="cb816-8"><a href="#cb816-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb816-9"><a href="#cb816-9" aria-hidden="true" tabindex="-1"></a>post_slopes <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_sleep_slopes)<span class="sc">$</span>b_subject <span class="sc">%&gt;%</span> </span>
<span id="cb816-10"><a href="#cb816-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb816-11"><a href="#cb816-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Subject"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb816-12"><a href="#cb816-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Subject) <span class="sc">%&gt;%</span> </span>
<span id="cb816-13"><a href="#cb816-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">slope =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb816-14"><a href="#cb816-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject =</span> <span class="fu">gsub</span>(<span class="st">"V"</span>, <span class="st">""</span>, Subject) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb816-15"><a href="#cb816-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Subject)</span>
<span id="cb816-16"><a href="#cb816-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb816-17"><a href="#cb816-17" aria-hidden="true" tabindex="-1"></a>d_combined <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="co"># add each person's intercept, useful for making the figure</span></span>
<span id="cb816-18"><a href="#cb816-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(Subject))) <span class="sc">%&gt;%</span> </span>
<span id="cb816-19"><a href="#cb816-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post_intercept, <span class="at">by =</span> <span class="st">"Subject"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb816-20"><a href="#cb816-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post_slopes, <span class="at">by =</span> <span class="st">"Subject"</span>) </span>
<span id="cb816-21"><a href="#cb816-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb816-22"><a href="#cb816-22" aria-hidden="true" tabindex="-1"></a>d_combined <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Days_bl, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb816-23"><a href="#cb816-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb816-24"><a href="#cb816-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">267.72</span>, <span class="at">slope =</span>  <span class="fl">11.47</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> <span class="co"># fill in with numbers from m_sleep</span></span>
<span id="cb816-25"><a href="#cb816-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb817"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb817-1"><a href="#cb817-1" aria-hidden="true" tabindex="-1"></a>d_combined <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Days_bl, <span class="at">y =</span> Reaction)) <span class="sc">+</span> <span class="co"># again, fill in with numbers from m_sleep</span></span>
<span id="cb817-2"><a href="#cb817-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb817-3"><a href="#cb817-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="st">"Subject"</span>) <span class="sc">+</span></span>
<span id="cb817-4"><a href="#cb817-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span>  slope), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb817-5"><a href="#cb817-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fl">267.72</span>, <span class="at">slope =</span>  <span class="fl">11.47</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb817-6"><a href="#cb817-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ex_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb818"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb818-1"><a href="#cb818-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m_sleep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>18 vector or matrix parameters hidden. Use depth=2 to show them.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>             mean        sd       5.5%     94.5%    n_eff     Rhat4
a_bar   267.97827 10.678960 250.967945 284.40863 2166.792 0.9993263
b_days   11.44668  1.069715   9.742757  13.14165 1156.530 1.0037860
sigma    30.20498  1.879720  27.341773  33.33951 3283.629 0.9982461
sigma_a  39.52059  6.795701  29.963804  50.89121 2929.177 0.9999578</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb821"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb821-1"><a href="#cb821-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m_sleep_slopes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>42 vector or matrix parameters hidden. Use depth=2 to show them.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>           mean       sd       5.5%     94.5%    n_eff     Rhat4
a     267.53457 7.932843 254.802395 279.92827 2096.637 0.9999239
b      11.43181 1.980913   8.319615  14.54037 2305.040 1.0018570
sigma  25.71734 1.763097  22.992873  28.66041 1856.784 1.0028725</code></pre>
</div>
</div>
<p>Again, the precision of the estimates is better for the slopes model, especially for the sigmas, and the individual-level data shows that the indidivual estimates are better too.</p>
</div>
</div>
</div>
</section>
<section id="stv" class="level1">
<h1>STV</h1>
<blockquote class="blockquote">
<p>Import data used in STV and run the four models discussed in the paper using Rstan (see Stan code in the paper). Run the same models using rstanarm::stan_glmer. Discuss any differences between results from the two programs?</p>
</blockquote>
<p>Maybe this is cheating (if it is, I’ll happily do a <em>“completering”</em>) but for the STV models, I’ve basically copy-pasted what they did. I had a look in the stan-files, but I can’t really pretend that I understand them.</p>
<p>::: {tabset}</p>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<p>The following code is taken directly from Shtrivasan et al.</p>
<p>First, I read in the Gibson and Wu data and subset head noun:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb824"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb824-1"><a href="#cb824-1" aria-hidden="true" tabindex="-1"></a>rDat<span class="ot">&lt;-</span><span class="fu">read.table</span>(<span class="st">"data/gibsonwu2012data.txt"</span>,<span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb824-2"><a href="#cb824-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb824-3"><a href="#cb824-3" aria-hidden="true" tabindex="-1"></a>rDat<span class="ot">&lt;-</span><span class="fu">subset</span>(rDat,region<span class="sc">==</span><span class="st">"headnoun"</span>)</span>
<span id="cb824-4"><a href="#cb824-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb824-5"><a href="#cb824-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert subject and item to factors:</span></span>
<span id="cb824-6"><a href="#cb824-6" aria-hidden="true" tabindex="-1"></a>rDat<span class="sc">$</span>region<span class="ot">&lt;-</span><span class="fu">factor</span>(rDat<span class="sc">$</span>region)</span>
<span id="cb824-7"><a href="#cb824-7" aria-hidden="true" tabindex="-1"></a>rDat<span class="sc">$</span>subj <span class="ot">&lt;-</span> <span class="fu">factor</span>(rDat<span class="sc">$</span>subj)</span>
<span id="cb824-8"><a href="#cb824-8" aria-hidden="true" tabindex="-1"></a>rDat<span class="sc">$</span>item <span class="ot">&lt;-</span> <span class="fu">factor</span>(rDat<span class="sc">$</span>item)</span>
<span id="cb824-9"><a href="#cb824-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb824-10"><a href="#cb824-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Contrast coding</span></span>
<span id="cb824-11"><a href="#cb824-11" aria-hidden="true" tabindex="-1"></a>rDat<span class="sc">$</span>so <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(rDat<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"subj-ext"</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb824-12"><a href="#cb824-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb824-13"><a href="#cb824-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up data for Stan:</span></span>
<span id="cb824-14"><a href="#cb824-14" aria-hidden="true" tabindex="-1"></a>stanDat<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">rt =</span> rDat<span class="sc">$</span>rt,</span>
<span id="cb824-15"><a href="#cb824-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">so =</span> rDat<span class="sc">$</span>so,</span>
<span id="cb824-16"><a href="#cb824-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">N =</span> <span class="fu">nrow</span>(rDat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="model-1-fixed-effects-only" class="level3">
<h3 class="anchored" data-anchor-id="model-1-fixed-effects-only">Model 1: Fixed effects only</h3>
<p>Now we start getting the model. Their first model is just a fixed effects model. Writing it out in McElreath’s style o notation, it might look something like this:</p>
<p><span class="math display">
\begin{aligned}
\text{Log(RT)}_{i} &amp; \sim \mathrm{Normal}(\mu, \sigma) \\
\mu_i &amp; = b_0 + b_{SO}\text{SO}_i\\
b_0 &amp; \sim \mathrm{Uniform}(-\infty, \infty)\\
b_1 &amp; \sim \mathrm{Uniform}(-\infty,\infty)\\
\sigma_i &amp;\sim \mathrm{Uniform}(0,\infty)\\
\end{aligned}
</span></p>
<p>I’m basing these priors on what Sorensen et al.&nbsp;write:</p>
<blockquote class="blockquote">
<p>The prior distributions on the parameters beta and sigma e would ordinarily be declared in the model block. If we don’t declare any prior, it is assumed that they have a uniform prior distribution.</p>
</blockquote>
<p>I suppose part of this exercise is comparing the stan default priors against the stanarm default priors, so I’m not going to do much to those either.</p>
<p>With all that said, I’ll run the data pure stan style, using Sorensen’s code</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb825"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb825-1"><a href="#cb825-1" aria-hidden="true" tabindex="-1"></a>fixEf_stan <span class="ot">&lt;-</span> <span class="fu">stan</span>(<span class="at">file =</span> <span class="st">"fixEf.stan"</span>, </span>
<span id="cb825-2"><a href="#cb825-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> stanDat, </span>
<span id="cb825-3"><a href="#cb825-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now to run the same model in stanarm.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb826"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb826-1"><a href="#cb826-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fixEf_stan, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"beta"</span>,<span class="st">"sigma_e"</span>), <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: fixEf-202308031626-1-45c7d5.
4 chains, each with iter=2000; warmup=1000; thin=1; 
post-warmup draws per chain=1000, total post-warmup draws=4000.

         mean se_mean   sd  2.5%   50% 97.5% n_eff Rhat
beta[1]  6.06       0 0.02  6.01  6.06  6.11  4135    1
beta[2] -0.04       0 0.03 -0.09 -0.04  0.01  3805    1
sigma_e  0.60       0 0.02  0.56  0.60  0.64  3815    1

Samples were drawn using NUTS(diag_e) at Thu Aug 03 16:26:59 2023.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb828"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb828-1"><a href="#cb828-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(fixEf_arm) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Est.Error  Q2.5 Q97.5
(Intercept)     6.06      0.03  6.01  6.11
so             -0.04      0.02 -0.09  0.01
sigma           0.60      0.02  0.56  0.64</code></pre>
</div>
</div>
<p>It seems like for the fixed effects only model, the stan and stanarm produce identical results. This, of course, is a bad model. Let’s see how the packages do with more advanced models.</p>
</section>
<section id="model-2-random-intercepts-for-subjects" class="level3">
<h3 class="anchored" data-anchor-id="model-2-random-intercepts-for-subjects">Model 2, random intercepts for subjects:</h3>
<p>Okay, here is my take on Sorenson et al’s model 2, written out in McElreath style. Again, it’s crazy to see these uniform priors going to infinity-</p>
<p><span class="math display">
\begin{aligned}
\text{Log(RT)}_i &amp;\sim \mathrm{Normal}(\mu_i, \sigma_i)\\
\mu &amp;= \alpha + \alpha_{\text{Subjec[i]}}+\alpha_{\text{Item[i]}} + \beta_{so}\times\text{SO}\\
\alpha &amp; \sim \mathrm{Uniform(-\infty, \infty)}\\
\alpha_{\text{Subject}} &amp;\sim \mathrm{Normal}(0, \sigma_{\text{Subject}}) \\
\alpha_{\text{Item}} &amp;\sim \mathrm{Normal}(0, \sigma_{\text{Item}}) \\
\sigma_{\text{Subject}}&amp;\sim \mathrm{Uniform}(0, \infty)\\
\sigma_{\text{item}}&amp;\sim \mathrm{Uniform}(0, \infty)\\
\beta &amp; \sim \mathrm{Uniform(-\infty, \infty)}\\
\sigma &amp;\sim \mathrm{Uniform}(0, \infty)
\end{aligned}
</span></p>
<p>Now I run that model, using Sorensen et al’s code.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb830"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb830-1"><a href="#cb830-1" aria-hidden="true" tabindex="-1"></a>stanDat<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">subj =</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(rDat<span class="sc">$</span>subj)),</span>
<span id="cb830-2"><a href="#cb830-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">item =</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(rDat<span class="sc">$</span>item)),</span>
<span id="cb830-3"><a href="#cb830-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">rt =</span> rDat<span class="sc">$</span>rt,</span>
<span id="cb830-4"><a href="#cb830-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">so =</span> rDat<span class="sc">$</span>so,</span>
<span id="cb830-5"><a href="#cb830-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">N =</span> <span class="fu">nrow</span>(rDat),</span>
<span id="cb830-6"><a href="#cb830-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">J =</span> <span class="fu">length</span>(<span class="fu">unique</span>(rDat<span class="sc">$</span>subj)),</span>
<span id="cb830-7"><a href="#cb830-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">K =</span> <span class="fu">length</span>(<span class="fu">unique</span>(rDat<span class="sc">$</span>item)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb831"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb831-1"><a href="#cb831-1" aria-hidden="true" tabindex="-1"></a>ranInt_stan <span class="ot">&lt;-</span> <span class="fu">stan</span>(<span class="at">file =</span> <span class="st">"ranInt.stan"</span>, <span class="at">data =</span> stanDat, </span>
<span id="cb831-2"><a href="#cb831-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And now we do the same thing, but in stanarm. Again, i used <code>prior_summary()</code> to learn my default prior. I think you can quibble with the exponential priors for the sigmas, but overalll, these default priors actually seem pretty sensible to me.</p>
<p><span class="math display">
\begin{aligned}
\text{Log(RT)}_i &amp;\sim \mathrm{Normal}(\mu_i, \sigma_i)\\
\mu &amp;= \alpha + \alpha_{\text{Subjec[i]}}+\alpha_{\text{Item[i]}} + \beta_{so}\text{SO}\\
\alpha &amp; \sim \mathrm{Normal(6.1, 1.5)}\\
\alpha_{\text{Subject}} &amp;\sim \mathrm{Normal}(0, \sigma_{\text{Subject}}) \\
\alpha_{\text{Item}} &amp;\sim \mathrm{Normal}(0, \sigma_{\text{Item}}) \\
\sigma_{\text{Subject}}&amp;\sim \mathrm{Exponential}(1.7)\\
\sigma_{\text{item}}&amp;\sim \mathrm{Exponential}(1.7)\\
\beta_{so} &amp; \sim \mathrm{Normal(0, 1.5)}\\
\sigma &amp;\sim \mathrm{Exponential}(1.7)
\end{aligned}
</span></p>
<p>The code for running the model is also much easier to write!</p>
<p>And if we look at the outputs of the two models side by side, what does it look like?</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb832"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb832-1"><a href="#cb832-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ranInt_stan, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"beta"</span>, <span class="st">"sigma_e"</span>, <span class="st">"sigma_u"</span>, <span class="st">"sigma_w"</span>),</span>
<span id="cb832-2"><a href="#cb832-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: ranInt-202308031627-1-03b127.
4 chains, each with iter=2000; warmup=1000; thin=1; 
post-warmup draws per chain=1000, total post-warmup draws=4000.

         mean se_mean   sd  2.5%   50% 97.5% n_eff Rhat
beta[1]  6.06       0 0.07  5.92  6.06  6.20   555    1
beta[2] -0.04       0 0.02 -0.08 -0.04  0.01  4665    1
sigma_e  0.52       0 0.02  0.49  0.52  0.55  4444    1
sigma_u  0.25       0 0.04  0.18  0.25  0.34  2592    1
sigma_w  0.20       0 0.05  0.12  0.19  0.32  2483    1

Samples were drawn using NUTS(diag_e) at Thu Aug 03 16:27:05 2023.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb834"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb834-1"><a href="#cb834-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ranINT_arm, </span>
<span id="cb834-2"><a href="#cb834-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">pars =</span><span class="fu">c</span>(<span class="st">"(Intercept)"</span>,<span class="st">"so"</span>, <span class="st">"sigma"</span>, <span class="st">"Sigma[subj:(Intercept),(Intercept)]"</span>, <span class="st">"Sigma[item:(Intercept),(Intercept)]"</span> ), </span>
<span id="cb834-3"><a href="#cb834-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>), </span>
<span id="cb834-4"><a href="#cb834-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Model Info:
 function:     stan_lmer
 family:       gaussian [identity]
 formula:      log(rt) ~ 1 + (1 | subj) + (1 | item) + so
 algorithm:    sampling
 sample:       4000 (posterior sample size)
 priors:       see help('prior_summary')
 observations: 547
 groups:       subj (37), item (15)

Estimates:
                                      mean   sd    2.5%   50%   97.5%
(Intercept)                          6.06   0.07  5.92   6.06  6.20  
so                                  -0.04   0.02 -0.08  -0.04  0.01  
sigma                                0.52   0.02  0.49   0.52  0.55  
Sigma[subj:(Intercept),(Intercept)]  0.06   0.02  0.03   0.06  0.11  
Sigma[item:(Intercept),(Intercept)]  0.04   0.02  0.01   0.04  0.10  

MCMC diagnostics
                                    mcse Rhat n_eff
(Intercept)                         0.00 1.00  985 
so                                  0.00 1.00 4990 
sigma                               0.00 1.00 3447 
Sigma[subj:(Intercept),(Intercept)] 0.00 1.00 1299 
Sigma[item:(Intercept),(Intercept)] 0.00 1.00 1166 

For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
</div>
</div>
<p>Well, despite the differences, the estimates seem quite similar to me. The main thing I notice is that the estimates are higher in the stan model, unsurprising given the priors &amp; it seems like setting some sensible priors would be an easy fix.</p>
</section>
<section id="model-3-varying-intercepts-varying-slopes-no-covariation" class="level3">
<h3 class="anchored" data-anchor-id="model-3-varying-intercepts-varying-slopes-no-covariation">Model 3: Varying intercepts &amp; varying slopes, no covariation</h3>
<p>Okay, now we have this half-way thing. They actually don’t mention it in their paper, or at least the version that I have, but digging into their markdown file, I was able to get a hold of their code. This is the code they use:</p>
<p>Again, if we write that using McElreath’s style of notation, it might look something like this. Because this model isn’t in the version of the paper, I’m not 100% sure about the priors, but this is my buest guess. Also, something nice about McElreath’s notation is that makes it clear that a varying slopes model like this is just a special case of an interaction, but with hyperpriors on the slopes. Nice.</p>
<p><span class="math display">
\begin{aligned}
\text{Log(RT)}_i &amp;\sim \mathrm{Normal}(\mu_i, \sigma_i)\\
\mu &amp;= \alpha + \alpha_{\text{Subjec[i]}}+\alpha_{\text{Item[i]}} + \beta_{so}\times\text{SO} + \beta_{\text{Item[i]}}\times\text{SO} + \beta_{\text{Subject[i]}}\times\text{SO}\\
\alpha_{\text{Subject}} &amp;\sim \mathrm{Normal}(0, \sigma_{\alpha[\text{Subject}]}) \\
\alpha_{\text{Item}} &amp;\sim \mathrm{Normal}(0, \sigma_{\alpha[\text{Item}]}) \\
\sigma_{\text{Subject}}&amp;\sim \mathrm{Uniform}(0, \infty)\\
\beta_{so} &amp; \sim \mathrm{Uniform(-\infty, \infty)}\\
\beta_{\text{Subject}} &amp;\sim \mathrm{Normal}(0, \sigma_{\beta[\text{Subject}]}) \\
\beta_{\text{Item}} &amp;\sim \mathrm{Normal}(0, \sigma_{\beta[\text{Item}]}) \\
\sigma,\sigma_{\alpha[\text{Subject}[]}, \sigma_{\alpha[\text{Item}[]}, \sigma_{\beta[\text{Subject}[]}, \sigma_{\beta[\text{Item}[]}  &amp;\sim \mathrm{Uniform}(0, \infty)
\end{aligned}
</span></p>
<p>As for stanarm… I’m not entirely sure how to even write a model like that. The following solution is the closest I can come up with. I <em>think</em> it works, because so only has two levels. So, in practice, what I’m doing is calculating unique intercepts for each combination of subject and so. Well, I feel very uncertain that this is actually doing the same thing as Sorensen et al, but this illustrates that stanarm isn’t well set up to do this wrong thing. I suppose that’s good!</p>
<p>Anyway, this is how I would write it out using McElreath style notation.</p>
<p><span class="math display">
\begin{aligned}
\text{Log(RT)}_i &amp;\sim \mathrm{Normal}(\mu_i, \sigma_i)\\
\mu &amp;= \alpha + \alpha_{\text{Subject:so[i]}}+\alpha_{\text{Item:so[i]}} + \beta_{so}\text{SO}\\
\alpha &amp; \sim \mathrm{Normal(6.1, 1.5)}\\
\alpha_{\text{Subject}} &amp;\sim \mathrm{Normal}(0, \sigma_{\text{Subject}}) \\
\alpha_{\text{Item}} &amp;\sim \mathrm{Normal}(0, \sigma_{\text{Item}}) \\
\sigma_{\text{Subject:so}}&amp;\sim \mathrm{Exponential}(1.7)\\
\sigma_{\text{item:so}}&amp;\sim \mathrm{Exponential}(1.7)\\
\beta_{so} &amp; \sim \mathrm{Normal(0, 1.5)}\\
\sigma &amp;\sim \mathrm{Exponential}(1.7)
\end{aligned}
</span></p>
<p>And this is in r code.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb836"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb836-1"><a href="#cb836-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> rDat <span class="sc">%&gt;%</span> </span>
<span id="cb836-2"><a href="#cb836-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">so =</span> <span class="fu">as.factor</span>(so))</span>
<span id="cb836-3"><a href="#cb836-3" aria-hidden="true" tabindex="-1"></a>ranINT_nocor_arm <span class="ot">&lt;-</span> <span class="fu">stan_lmer</span>(<span class="fu">log</span>(rt) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span>  (<span class="dv">1</span><span class="sc">|</span>subj<span class="sc">:</span>so) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>item<span class="sc">:</span>so) <span class="sc">+</span> so, <span class="at">data =</span> tmp, <span class="at">chains =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Well, the model certainly runs at least. Let’s look at the summary outputs.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb837"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb837-1"><a href="#cb837-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ranIntSlpNoCorFit, </span>
<span id="cb837-2"><a href="#cb837-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"beta"</span>, <span class="st">"sigma_e"</span>, <span class="st">"sigma_u"</span>, <span class="st">"sigma_w"</span>),</span>
<span id="cb837-3"><a href="#cb837-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: ranIntSlpNoCor-202308031627-1-13d69d.
4 chains, each with iter=2000; warmup=1000; thin=1; 
post-warmup draws per chain=1000, total post-warmup draws=4000.

            mean se_mean   sd  2.5%   50% 97.5% n_eff Rhat
beta[1]     6.06       0 0.07  5.92  6.06  6.21   815 1.01
beta[2]    -0.04       0 0.03 -0.09 -0.04  0.02  2827 1.00
sigma_e     0.52       0 0.02  0.48  0.52  0.55  2894 1.00
sigma_u[1]  0.25       0 0.04  0.18  0.25  0.34  3109 1.00
sigma_u[2]  0.06       0 0.03  0.01  0.05  0.13    76 1.04
sigma_w[1]  0.20       0 0.05  0.12  0.19  0.32  2794 1.00
sigma_w[2]  0.04       0 0.03  0.00  0.04  0.11   141 1.02

Samples were drawn using NUTS(diag_e) at Thu Aug 03 16:27:44 2023.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb839"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb839-1"><a href="#cb839-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">summary</span>(ranINT_nocor_arm, </span>
<span id="cb839-2"><a href="#cb839-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">pars =</span><span class="fu">c</span>(<span class="st">"(Intercept)"</span>,<span class="st">"so1"</span>, <span class="st">"sigma"</span>, <span class="st">"Sigma[subj:so:(Intercept),(Intercept)]"</span>, <span class="st">"Sigma[item:so:(Intercept),(Intercept)]"</span> ), </span>
<span id="cb839-3"><a href="#cb839-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>), </span>
<span id="cb839-4"><a href="#cb839-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb839-5"><a href="#cb839-5" aria-hidden="true" tabindex="-1"></a>      )[,],<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                        mean mcse   sd  2.5%   50% 97.5% n_eff
(Intercept)                             6.10    0 0.07  5.96  6.10  6.23  1456
so1                                    -0.07    0 0.10 -0.26 -0.07  0.13  1380
sigma                                   0.52    0 0.02  0.48  0.52  0.55  3433
Sigma[subj:so:(Intercept),(Intercept)]  0.06    0 0.02  0.04  0.06  0.10  1732
Sigma[item:so:(Intercept),(Intercept)]  0.04    0 0.02  0.02  0.03  0.07  1466
                                       Rhat
(Intercept)                               1
so1                                       1
sigma                                     1
Sigma[subj:so:(Intercept),(Intercept)]    1
Sigma[item:so:(Intercept),(Intercept)]    1</code></pre>
</div>
</div>
<p>Interestingly, the effect of so is stronger in the stanarm model. Also an effect of the priors or something else? Could also be that I didn’t quite manage to specify the same models.</p>
</section>
<section id="model-4-covarying-slopese-and-intercepts" class="level3">
<h3 class="anchored" data-anchor-id="model-4-covarying-slopese-and-intercepts">Model 4: Covarying slopese and intercepts</h3>
<p>Now this is the main model, of course. This one has both varying intercepts and varying slopes and they covary. I’ve set myself up for a challenge, writing all these out in McElreath code, but here goes.</p>
<p><span class="math display">
\begin{aligned}
\text{Log(RT)}_i &amp;\sim \mathrm{Normal}(\mu_i, \sigma_i)\\
\mu &amp;= \alpha_i + \alpha_{\text{Subjec[i]}}+\alpha_{\text{Item[i]}} + \beta_{so,i}\times\text{SO} + \beta_{\text{Item[i]}}\times\text{SO} + \beta_{\text{Subject[i]}}\times\text{SO}\\
\alpha &amp;\sim \mathrm{Uniform}(-\infty, \infty)\\
\begin{bmatrix} \alpha_{subject} \\ \beta_{subject} \end{bmatrix}
&amp;\sim \mathrm{MVNormal}
\bigg( \begin{bmatrix}0\\ 0\end{bmatrix}, \Sigma_{subject}\bigg) \\
\Sigma_{subject}&amp; = \begin{bmatrix}
\sigma_ {\alpha[s]} &amp;  0\\  0 &amp;\sigma_{\beta[s]} \end{bmatrix}
\textbf{R}  \begin{bmatrix}
\sigma_ {\alpha[s] }&amp;  0\\  0 &amp;\sigma_{\beta[s]} \end{bmatrix}\\
\begin{bmatrix} \alpha_{item} \\ \beta_{item} \end{bmatrix} &amp;\sim \mathrm{MVNormal} \bigg(
\begin{bmatrix}0\\ 0\end{bmatrix},
\Sigma_{item}\bigg) \\
\Sigma_{item}&amp; =
\begin{bmatrix}\sigma_ {\alpha[it]} &amp;  0\\  0 &amp;\sigma_{\beta[it]} \end{bmatrix}
\textbf{R}  
\begin{bmatrix}\sigma_ {\alpha[it]} &amp;  0\\  0 &amp;\sigma_{\beta[it] }\end{bmatrix}\\
\beta_{so} &amp; \sim \mathrm{Uniform(-\infty, \infty)}\\
\sigma,\sigma_{\alpha[\text{s}[]}, \sigma_{\alpha[\text{it}[]}, \sigma_{\beta[\text{s}[]}, \sigma_{\beta[\text{it}[]}  &amp;\sim \mathrm{Uniform}(0, \infty)\\
\textbf{R}&amp; \sim \mathrm{LKJcorr}(?)
\end{aligned}
</span></p>
<p>Okay, that was not easy to do. Anyway, to fit this model, I once again use Sorensens code to run this model.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb841"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb841-1"><a href="#cb841-1" aria-hidden="true" tabindex="-1"></a>ranIntSlpFit <span class="ot">&lt;-</span> <span class="fu">stan</span>(<span class="at">file =</span> <span class="st">"ranIntSlp.stan"</span>, <span class="at">data =</span> stanDat, </span>
<span id="cb841-2"><a href="#cb841-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And then I do the same in stanarm. Stanarm automatically uses the following priors:</p>
<p><span class="math display">
\begin{aligned}
\text{Log(RT)}_i &amp;\sim \mathrm{Normal}(\mu_i, \sigma_i)\\
\mu &amp;= \alpha + \alpha_{\text{Subjec[i]}}+\alpha_{\text{Item[i]}} + (\beta_{so} + \beta_{\text{Item[i]}} + \beta_{\text{Subject[i]}})\times\text{SO}_i\\
\alpha &amp;\sim \mathrm{Normal}(6.1, 1.5)\\
\begin{bmatrix} \alpha_{subject} \\ \beta_{subject} \end{bmatrix}
&amp;\sim \mathrm{MVNormal}
\bigg( \begin{bmatrix}0\\ 0\end{bmatrix}, \Sigma_{subject}\bigg) \\
\Sigma_{subject}&amp; = \begin{bmatrix}
\sigma_ {\alpha[s]} &amp;  0\\  0 &amp;\sigma_{\beta[s]} \end{bmatrix}
\textbf{R}  \begin{bmatrix}
\sigma_ {\alpha[s] }&amp;  0\\  0 &amp;\sigma_{\beta[s]} \end{bmatrix}\\
\begin{bmatrix} \alpha_{item} \\ \beta_{item} \end{bmatrix} &amp;\sim \mathrm{MVNormal} \bigg(
\begin{bmatrix}0\\ 0\end{bmatrix},
\Sigma_{item}\bigg) \\
\Sigma_{item}&amp; =
\begin{bmatrix}\sigma_ {\alpha[it]} &amp;  0\\  0 &amp;\sigma_{\beta[it]} \end{bmatrix}
\textbf{R}  
\begin{bmatrix}\sigma_ {\alpha[it]} &amp;  0\\  0 &amp;\sigma_{\beta[it] }\end{bmatrix}\\
\beta_{so} &amp; \sim \mathrm{Uniform(0, 3)}\\
\sigma,\sigma_{\alpha[\text{s}[]}, \sigma_{\alpha[\text{it}[]}, \sigma_{\beta[\text{s}[]}, \sigma_{\beta[\text{it}[]}  &amp;\sim \mathrm{Exponential}(1.7)\\
\textbf{R}&amp; \sim \mathrm{LKJcorr}(1)
\end{aligned}
</span></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb842"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb842-1"><a href="#cb842-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> rDat <span class="sc">%&gt;%</span> </span>
<span id="cb842-2"><a href="#cb842-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">so =</span> <span class="fu">as.factor</span>(so))</span>
<span id="cb842-3"><a href="#cb842-3" aria-hidden="true" tabindex="-1"></a>ranINT_cor_arm <span class="ot">&lt;-</span> <span class="fu">stan_lmer</span>(<span class="fu">log</span>(rt) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span>  (<span class="dv">1</span> <span class="sc">+</span> so<span class="sc">|</span>subj) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>so<span class="sc">|</span>item) <span class="sc">+</span> so, <span class="at">data =</span> tmp, <span class="at">chains =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'continuous' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.000176 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.76 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 8.33286 seconds (Warm-up)
Chain 1:                4.18443 seconds (Sampling)
Chain 1:                12.5173 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'continuous' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.000141 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 1.41 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 8.17562 seconds (Warm-up)
Chain 2:                4.19507 seconds (Sampling)
Chain 2:                12.3707 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'continuous' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 0.00014 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 1.4 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 8.51831 seconds (Warm-up)
Chain 3:                4.1566 seconds (Sampling)
Chain 3:                12.6749 seconds (Total)
Chain 3: 

SAMPLING FOR MODEL 'continuous' NOW (CHAIN 4).
Chain 4: 
Chain 4: Gradient evaluation took 0.000141 seconds
Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 1.41 seconds.
Chain 4: Adjust your expectations accordingly!
Chain 4: 
Chain 4: 
Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 4: 
Chain 4:  Elapsed Time: 7.48333 seconds (Warm-up)
Chain 4:                4.18353 seconds (Sampling)
Chain 4:                11.6669 seconds (Total)
Chain 4: </code></pre>
</div>
</div>
<p>The first thing I notice, is that the stanarm version was the slowest to run. But let’s compare the model outputs!</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb844"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb844-1"><a href="#cb844-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ranIntSlpFit, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"beta"</span>, <span class="st">"sigma_e"</span>, <span class="st">"sigma_u"</span>, <span class="st">"sigma_w"</span>),</span>
<span id="cb844-2"><a href="#cb844-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: ranIntSlp-202308031627-1-623a0e.
4 chains, each with iter=2000; warmup=1000; thin=1; 
post-warmup draws per chain=1000, total post-warmup draws=4000.

            mean se_mean   sd  2.5%   50% 97.5% n_eff Rhat
beta[1]     6.06       0 0.07  5.92  6.06  6.20  1641    1
beta[2]    -0.04       0 0.03 -0.09 -0.04  0.02  4461    1
sigma_e     0.51       0 0.02  0.48  0.51  0.55  5020    1
sigma_u[1]  0.25       0 0.04  0.18  0.25  0.34  1552    1
sigma_u[2]  0.07       0 0.03  0.01  0.07  0.14  1358    1
sigma_w[1]  0.21       0 0.05  0.13  0.20  0.33  1553    1
sigma_w[2]  0.04       0 0.03  0.00  0.03  0.10  1849    1

Samples were drawn using NUTS(diag_e) at Thu Aug 03 16:28:05 2023.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb846"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb846-1"><a href="#cb846-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">summary</span>(ranINT_cor_arm, </span>
<span id="cb846-2"><a href="#cb846-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">pars =</span><span class="fu">c</span>(<span class="st">"(Intercept)"</span>,<span class="st">"so1"</span>, <span class="st">"sigma"</span>, <span class="st">"Sigma[subj:(Intercept),(Intercept)]"</span>, <span class="st">"Sigma[item:(Intercept),(Intercept)]"</span>, <span class="st">"Sigma[subj:so1,(Intercept)]"</span>,<span class="st">"Sigma[subj:so1,so1]"</span>, <span class="st">"Sigma[item:so1,(Intercept)]"</span>,<span class="st">"Sigma[item:so1,so1]"</span>     ), </span>
<span id="cb846-3"><a href="#cb846-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>)</span>
<span id="cb846-4"><a href="#cb846-4" aria-hidden="true" tabindex="-1"></a>      )[,],<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                     mean mcse   sd  2.5%   50% 97.5% n_eff
(Intercept)                          6.10    0 0.08  5.94  6.10  6.25  1271
so1                                 -0.07    0 0.06 -0.19 -0.07  0.04  3180
sigma                                0.51    0 0.02  0.48  0.51  0.55  4906
Sigma[subj:(Intercept),(Intercept)]  0.09    0 0.03  0.04  0.08  0.16  1791
Sigma[subj:so1,(Intercept)]         -0.03    0 0.02 -0.08 -0.03  0.00  2223
Sigma[subj:so1,so1]                  0.02    0 0.02  0.00  0.02  0.07  1921
Sigma[item:(Intercept),(Intercept)]  0.04    0 0.02  0.01  0.03  0.09  1649
Sigma[item:so1,(Intercept)]          0.00    0 0.01 -0.02  0.00  0.02  3220
Sigma[item:so1,so1]                  0.01    0 0.01  0.00  0.01  0.04  1785
                                    Rhat
(Intercept)                            1
so1                                    1
sigma                                  1
Sigma[subj:(Intercept),(Intercept)]    1
Sigma[subj:so1,(Intercept)]            1
Sigma[subj:so1,so1]                    1
Sigma[item:(Intercept),(Intercept)]    1
Sigma[item:so1,(Intercept)]            1
Sigma[item:so1,so1]                    1</code></pre>
</div>
</div>
<p>The outputs are again pretty similar. But again, Stanarm gives slightly larger estimates for the effect os so, but also slightly larger posteriors. Why this happens is a little bit beyond be, but if I were to guess, it might be differences in the underlying MCMC machinery, or in the priors, doing something where the</p>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb848" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb848-1"><a href="#cb848-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb848-2"><a href="#cb848-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "exercises2"</span></span>
<span id="cb848-3"><a href="#cb848-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Elli van Berlekom"</span></span>
<span id="cb848-4"><a href="#cb848-4" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb848-5"><a href="#cb848-5" aria-hidden="true" tabindex="-1"></a><span class="co">  results: "hide"</span></span>
<span id="cb848-6"><a href="#cb848-6" aria-hidden="true" tabindex="-1"></a><span class="co">  fig.keep: TRUE</span></span>
<span id="cb848-7"><a href="#cb848-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb848-8"><a href="#cb848-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb848-9"><a href="#cb848-9" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: simplex</span></span>
<span id="cb848-10"><a href="#cb848-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb848-11"><a href="#cb848-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb848-12"><a href="#cb848-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb848-13"><a href="#cb848-13" aria-hidden="true" tabindex="-1"></a><span class="co">    html-math-method: katex</span></span>
<span id="cb848-14"><a href="#cb848-14" aria-hidden="true" tabindex="-1"></a><span class="co">    css: styles.css</span></span>
<span id="cb848-15"><a href="#cb848-15" aria-hidden="true" tabindex="-1"></a><span class="co">    comments: </span></span>
<span id="cb848-16"><a href="#cb848-16" aria-hidden="true" tabindex="-1"></a><span class="co">      hypothesis: TRUE</span></span>
<span id="cb848-17"><a href="#cb848-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb848-18"><a href="#cb848-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-19"><a href="#cb848-19" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 0.1, Clear memory and set random seed, include = FALSE}</span></span>
<span id="cb848-20"><a href="#cb848-20" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># clear memory</span></span>
<span id="cb848-21"><a href="#cb848-21" aria-hidden="true" tabindex="-1"></a><span class="fu">graphics.off</span>()  <span class="co"># clear all plots</span></span>
<span id="cb848-22"><a href="#cb848-22" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\014</span><span class="st">"</span>)     <span class="co"># clear console (same as Ctrl-L in console)</span></span>
<span id="cb848-23"><a href="#cb848-23" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)   <span class="co"># Makes it reproducable also if random number generators are used</span></span>
<span id="cb848-24"><a href="#cb848-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-25"><a href="#cb848-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-26"><a href="#cb848-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-27"><a href="#cb848-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 0.2, output = FALSE}</span></span>
<span id="cb848-28"><a href="#cb848-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb848-29"><a href="#cb848-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb848-30"><a href="#cb848-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb848-31"><a href="#cb848-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb848-32"><a href="#cb848-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb848-33"><a href="#cb848-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb848-34"><a href="#cb848-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb848-35"><a href="#cb848-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesrules)</span>
<span id="cb848-36"><a href="#cb848-36" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb848-37"><a href="#cb848-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-38"><a href="#cb848-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-39"><a href="#cb848-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-40"><a href="#cb848-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## BR 15</span></span>
<span id="cb848-41"><a href="#cb848-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-42"><a href="#cb848-42" aria-hidden="true" tabindex="-1"></a>Here are my answers to the chapter 15 exercises, and in class. I'm trying to use this exercise as a reason to get more familiar with quarto. One thing I can do with quarto is to include a comment option. To add a comment, just highlight the relevant section of the text. It will prompt you to create an account, which turns out to be a simple process and it hasn't sent me any spam yet at least. </span>
<span id="cb848-43"><a href="#cb848-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-44"><a href="#cb848-44" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb848-45"><a href="#cb848-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-46"><a href="#cb848-46" aria-hidden="true" tabindex="-1"></a><span class="fu">### 15.4</span></span>
<span id="cb848-47"><a href="#cb848-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-48"><a href="#cb848-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-49"><a href="#cb848-49" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;a) To explore the complete pooled behavior of the data points, construct and discuss a plot of </span><span class="in">`reaction`</span><span class="at"> by </span><span class="in">`Days`</span><span class="at">. In doing so, ignore the subjects and include the observed trend in the relationship.</span></span>
<span id="cb848-50"><a href="#cb848-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-51"><a href="#cb848-51" aria-hidden="true" tabindex="-1"></a>First, I load the data and fit a simple model.</span>
<span id="cb848-52"><a href="#cb848-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-53"><a href="#cb848-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 15.4.1, output = FALSE}</span></span>
<span id="cb848-54"><a href="#cb848-54" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> sleepstudy <span class="co"># first, import the data</span></span>
<span id="cb848-55"><a href="#cb848-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-56"><a href="#cb848-56" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">subset</span>(sleepstudy, Days <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="co">#remove first two days</span></span>
<span id="cb848-57"><a href="#cb848-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-58"><a href="#cb848-58" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(Reaction <span class="sc">~</span> Days, <span class="at">data =</span> s) <span class="co">#fit the data</span></span>
<span id="cb848-59"><a href="#cb848-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-60"><a href="#cb848-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-61"><a href="#cb848-61" aria-hidden="true" tabindex="-1"></a>Then I sample from the posterior and make a very simple plot, reflecting the effect of days on reaction time. Because ggplot has glm built in, I'm able to call it when creating this plot.Nice! </span>
<span id="cb848-62"><a href="#cb848-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-63"><a href="#cb848-63" aria-hidden="true" tabindex="-1"></a>This plot is completely pooled, and it ignores the fact that the data points are not independent, but come from multiple trials within the same person. This is not good, because it is overconfident about the effect of days on reaction time!</span>
<span id="cb848-64"><a href="#cb848-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-65"><a href="#cb848-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 15.4.2, message = FALSE, warning=FALSE}</span></span>
<span id="cb848-66"><a href="#cb848-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-67"><a href="#cb848-67" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(s, <span class="fu">aes</span>(<span class="at">y =</span>Reaction, <span class="at">x =</span>  Days))<span class="sc">+</span></span>
<span id="cb848-68"><a href="#cb848-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb848-69"><a href="#cb848-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> glm, <span class="at">level =</span> <span class="fl">0.90</span>) <span class="sc">+</span></span>
<span id="cb848-70"><a href="#cb848-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tidybayes</span>() <span class="do">## I'll b trying out various themes as well. Why? For fun!</span></span>
<span id="cb848-71"><a href="#cb848-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-72"><a href="#cb848-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-73"><a href="#cb848-73" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; using careful notation, write out the model</span></span>
<span id="cb848-74"><a href="#cb848-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-75"><a href="#cb848-75" aria-hidden="true" tabindex="-1"></a>I might write the model like this: </span>
<span id="cb848-76"><a href="#cb848-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-77"><a href="#cb848-77" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-78"><a href="#cb848-78" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb848-79"><a href="#cb848-79" aria-hidden="true" tabindex="-1"></a>\text{Reaction}_{i} &amp; \sim \mathrm{Normal}(\mu, \sigma) <span class="sc">\\</span></span>
<span id="cb848-80"><a href="#cb848-80" aria-hidden="true" tabindex="-1"></a>\mu_i &amp; = \alpha + \beta \times\text{Days}_i<span class="sc">\\</span></span>
<span id="cb848-81"><a href="#cb848-81" aria-hidden="true" tabindex="-1"></a>\alpha &amp; \sim \mathrm{Normal}(245. 50)<span class="sc">\\</span></span>
<span id="cb848-82"><a href="#cb848-82" aria-hidden="true" tabindex="-1"></a>b_1 &amp; \sim \mathrm{Normal}(20,50)<span class="sc">\\</span></span>
<span id="cb848-83"><a href="#cb848-83" aria-hidden="true" tabindex="-1"></a>\sigma &amp;\sim \mathrm{Normal}(20,50)<span class="sc">\\</span></span>
<span id="cb848-84"><a href="#cb848-84" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb848-85"><a href="#cb848-85" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-86"><a href="#cb848-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-87"><a href="#cb848-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-88"><a href="#cb848-88" aria-hidden="true" tabindex="-1"></a><span class="fu">### 15.6</span></span>
<span id="cb848-89"><a href="#cb848-89" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; A. Suppose instead that we (incorrectly) took a no pooling approach in our sleep study analysis.To explore the no pooled behavior of the data points, construct and discuss separate scatterplots of Reaction by Days for each Subject, including subject-specific trend lines.</span></span>
<span id="cb848-90"><a href="#cb848-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-91"><a href="#cb848-91" aria-hidden="true" tabindex="-1"></a>Again, I'm able to do all that the question asks within ggplot by calling stan_glm and using <span class="in">`facet_wrap()`</span> to the same operation for each subjct separately. This works fine, but we might be a little skeptical of for example subject 335, who got faster as the days go by. A partial pooling approach would probably adjust their scores a little.</span>
<span id="cb848-92"><a href="#cb848-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-93"><a href="#cb848-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 15.6.1, message=FALSE}</span></span>
<span id="cb848-94"><a href="#cb848-94" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(s, <span class="fu">aes</span>(<span class="at">x =</span> Days, <span class="at">y =</span> Reaction, <span class="at">color =</span>Subject)) <span class="sc">+</span></span>
<span id="cb848-95"><a href="#cb848-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb848-96"><a href="#cb848-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Subject))<span class="sc">+</span></span>
<span id="cb848-97"><a href="#cb848-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> glm, <span class="at">level =</span> <span class="fl">0.90</span>, <span class="fu">aes</span>(<span class="at">fill =</span> Subject)) <span class="sc">+</span></span>
<span id="cb848-98"><a href="#cb848-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb848-99"><a href="#cb848-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-100"><a href="#cb848-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-101"><a href="#cb848-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-102"><a href="#cb848-102" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;C. I think the question was to write the model out in notation.</span></span>
<span id="cb848-103"><a href="#cb848-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-104"><a href="#cb848-104" aria-hidden="true" tabindex="-1"></a>If we write this out into a nice model notation, what does it look like? Something like this.</span>
<span id="cb848-105"><a href="#cb848-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-106"><a href="#cb848-106" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-107"><a href="#cb848-107" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb848-108"><a href="#cb848-108" aria-hidden="true" tabindex="-1"></a>\text{Reaction}_{i} &amp; \sim \mathrm{Normal}(\mu, \sigma) <span class="sc">\\</span></span>
<span id="cb848-109"><a href="#cb848-109" aria-hidden="true" tabindex="-1"></a>\mu_i &amp; = \alpha + \alpha_\text{subject} + \beta\text{Days}_i<span class="sc">\\</span></span>
<span id="cb848-110"><a href="#cb848-110" aria-hidden="true" tabindex="-1"></a>\alpha &amp; \sim \mathrm{Normal}(245. 50)<span class="sc">\\</span></span>
<span id="cb848-111"><a href="#cb848-111" aria-hidden="true" tabindex="-1"></a>\alpha_\text{subject} &amp; \sim \mathrm{Normal}(0, 30)  &amp; \text{for j = 1, 2, 3...18}<span class="sc">\\</span></span>
<span id="cb848-112"><a href="#cb848-112" aria-hidden="true" tabindex="-1"></a>\beta &amp; \sim \mathrm{Normal}(20,50)<span class="sc">\\</span></span>
<span id="cb848-113"><a href="#cb848-113" aria-hidden="true" tabindex="-1"></a>\sigma &amp;\sim \mathrm{Normal}(20,50)<span class="sc">\\</span></span>
<span id="cb848-114"><a href="#cb848-114" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb848-115"><a href="#cb848-115" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-116"><a href="#cb848-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-117"><a href="#cb848-117" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb848-118"><a href="#cb848-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-119"><a href="#cb848-119" aria-hidden="true" tabindex="-1"></a><span class="fu">## MN1</span></span>
<span id="cb848-120"><a href="#cb848-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-121"><a href="#cb848-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-122"><a href="#cb848-122" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;MN1: Do the tadpole simulation from the book (section 13.2), but for another scenario (other true parameters of your choice),and display result as Fig.13.1 andFig 13.3. Briefly compare results if your McElreath’s simulation.</span></span>
<span id="cb848-123"><a href="#cb848-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-124"><a href="#cb848-124" aria-hidden="true" tabindex="-1"></a>I'm going to start in the same order as MN, and repeat McElreath's model</span>
<span id="cb848-125"><a href="#cb848-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-126"><a href="#cb848-126" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-127"><a href="#cb848-127" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb848-128"><a href="#cb848-128" aria-hidden="true" tabindex="-1"></a>S_i &amp;\sim \mathrm{Binomial}(N_i, p_i)<span class="sc">\\</span></span>
<span id="cb848-129"><a href="#cb848-129" aria-hidden="true" tabindex="-1"></a>logit_p &amp;= \alpha_{\text{POND<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}}<span class="sc">\\</span></span>
<span id="cb848-130"><a href="#cb848-130" aria-hidden="true" tabindex="-1"></a>\alpha_j &amp;\sim \mathrm{Normal(\bar{\alpha}, \sigma)}<span class="sc">\\</span></span>
<span id="cb848-131"><a href="#cb848-131" aria-hidden="true" tabindex="-1"></a>\bar{\alpha} &amp;\sim \mathrm{Normal}(0,1.5)<span class="sc">\\</span></span>
<span id="cb848-132"><a href="#cb848-132" aria-hidden="true" tabindex="-1"></a>\sigma &amp;\sim \mathrm{Exponential}(1)</span>
<span id="cb848-133"><a href="#cb848-133" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb848-134"><a href="#cb848-134" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-135"><a href="#cb848-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-136"><a href="#cb848-136" aria-hidden="true" tabindex="-1"></a>I'll be using McElreath's code to make the simulations, but turning it into a function to be able to carry it out many times and compare the effects of using many different parameters. The code chunk below </span>
<span id="cb848-137"><a href="#cb848-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-138"><a href="#cb848-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MMN1.1, results = "hide"}</span></span>
<span id="cb848-139"><a href="#cb848-139" aria-hidden="true" tabindex="-1"></a>sim_tads <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">a_bar =</span><span class="dv">2</span>, <span class="at">sigma =</span> <span class="fl">0.1</span>, <span class="at">nponds =</span> <span class="dv">60</span>, <span class="at">nclusters =</span> <span class="dv">60</span>, <span class="at">title =</span> <span class="st">"opps, forgot to add a title"</span>){</span>
<span id="cb848-140"><a href="#cb848-140" aria-hidden="true" tabindex="-1"></a>  a_bar <span class="ot">&lt;-</span> a_bar</span>
<span id="cb848-141"><a href="#cb848-141" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> sigma</span>
<span id="cb848-142"><a href="#cb848-142" aria-hidden="true" tabindex="-1"></a>nclusters <span class="ot">&lt;-</span> nclusters</span>
<span id="cb848-143"><a href="#cb848-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-144"><a href="#cb848-144" aria-hidden="true" tabindex="-1"></a>ni <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">35</span>), <span class="at">each =</span> <span class="dv">15</span>))</span>
<span id="cb848-145"><a href="#cb848-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-146"><a href="#cb848-146" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5005</span>)</span>
<span id="cb848-147"><a href="#cb848-147" aria-hidden="true" tabindex="-1"></a><span class="co">#true params</span></span>
<span id="cb848-148"><a href="#cb848-148" aria-hidden="true" tabindex="-1"></a>true_a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(nponds, <span class="at">mean =</span> a_bar, <span class="at">sd =</span> sigma)</span>
<span id="cb848-149"><a href="#cb848-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-150"><a href="#cb848-150" aria-hidden="true" tabindex="-1"></a>dsim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pond =</span> <span class="dv">1</span><span class="sc">:</span>nponds, <span class="at">ni =</span> ni, <span class="at">true_a =</span> true_a)</span>
<span id="cb848-151"><a href="#cb848-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-152"><a href="#cb848-152" aria-hidden="true" tabindex="-1"></a>dsim<span class="sc">$</span>true_p <span class="ot">&lt;-</span> <span class="fu">plogis</span>(dsim<span class="sc">$</span>true_a)</span>
<span id="cb848-153"><a href="#cb848-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-154"><a href="#cb848-154" aria-hidden="true" tabindex="-1"></a>dsim<span class="sc">$</span>si <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(nponds, <span class="at">size =</span> dsim<span class="sc">$</span>ni, <span class="at">prob =</span> dsim<span class="sc">$</span>true_p)</span>
<span id="cb848-155"><a href="#cb848-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-156"><a href="#cb848-156" aria-hidden="true" tabindex="-1"></a><span class="co">#make a dataframe</span></span>
<span id="cb848-157"><a href="#cb848-157" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">si =</span> dsim<span class="sc">$</span>si, <span class="at">ni =</span> dsim<span class="sc">$</span>ni, <span class="at">pond =</span> dsim<span class="sc">$</span>pond)</span>
<span id="cb848-158"><a href="#cb848-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-159"><a href="#cb848-159" aria-hidden="true" tabindex="-1"></a><span class="co">#fit a model, do the pooling</span></span>
<span id="cb848-160"><a href="#cb848-160" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-161"><a href="#cb848-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-162"><a href="#cb848-162" aria-hidden="true" tabindex="-1"></a>    si <span class="sc">~</span> <span class="fu">dbinom</span>(ni, p),</span>
<span id="cb848-163"><a href="#cb848-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a_pond[pond],</span>
<span id="cb848-164"><a href="#cb848-164" aria-hidden="true" tabindex="-1"></a>    a_pond[pond] <span class="sc">~</span> <span class="fu">dnorm</span>(a_bar, sigma),</span>
<span id="cb848-165"><a href="#cb848-165" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb848-166"><a href="#cb848-166" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb848-167"><a href="#cb848-167" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb848-168"><a href="#cb848-168" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb848-169"><a href="#cb848-169" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb848-170"><a href="#cb848-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-171"><a href="#cb848-171" aria-hidden="true" tabindex="-1"></a>dsim<span class="sc">$</span>p_nopol <span class="ot">&lt;-</span> dsim<span class="sc">$</span>si<span class="sc">/</span>dsim<span class="sc">$</span>ni</span>
<span id="cb848-172"><a href="#cb848-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-173"><a href="#cb848-173" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(fit)</span>
<span id="cb848-174"><a href="#cb848-174" aria-hidden="true" tabindex="-1"></a>dsim<span class="sc">$</span>p_partpool <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">plogis</span>(post<span class="sc">$</span>a_pond), <span class="dv">2</span>, median)</span>
<span id="cb848-175"><a href="#cb848-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-176"><a href="#cb848-176" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate errors</span></span>
<span id="cb848-177"><a href="#cb848-177" aria-hidden="true" tabindex="-1"></a>nopool_error <span class="ot">&lt;-</span> <span class="fu">abs</span>(dsim<span class="sc">$</span>p_nopol<span class="sc">-</span>dsim<span class="sc">$</span>true_p)</span>
<span id="cb848-178"><a href="#cb848-178" aria-hidden="true" tabindex="-1"></a>partpool_error <span class="ot">&lt;-</span> <span class="fu">abs</span>(dsim<span class="sc">$</span>p_partpool<span class="sc">-</span>dsim<span class="sc">$</span>true_p)</span>
<span id="cb848-179"><a href="#cb848-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-180"><a href="#cb848-180" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dsim<span class="sc">$</span>pond, dsim<span class="sc">$</span>p_nopol, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"blue"</span>, <span class="at">xlab =</span> <span class="st">"Pond ID"</span>, </span>
<span id="cb848-181"><a href="#cb848-181" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Estimated Survival Probability"</span>, <span class="at">main =</span> title)</span>
<span id="cb848-182"><a href="#cb848-182" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dsim<span class="sc">$</span>pond, dsim<span class="sc">$</span>p_partpool, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb848-183"><a href="#cb848-183" aria-hidden="true" tabindex="-1"></a><span class="co"># points(dsim$pond, dsim$true_p, pch = "X")</span></span>
<span id="cb848-184"><a href="#cb848-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-185"><a href="#cb848-185" aria-hidden="true" tabindex="-1"></a>pbar <span class="ot">&lt;-</span> <span class="fu">plogis</span>(<span class="fu">median</span>(post<span class="sc">$</span>a_bar))</span>
<span id="cb848-186"><a href="#cb848-186" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">61</span>), <span class="fu">c</span>(pbar, pbar), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb848-187"><a href="#cb848-187" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">15.5</span>, <span class="fl">15.5</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb848-188"><a href="#cb848-188" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">30.5</span>, <span class="fl">30.5</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb848-189"><a href="#cb848-189" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">45.5</span>, <span class="fl">45.5</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb848-190"><a href="#cb848-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-191"><a href="#cb848-191" aria-hidden="true" tabindex="-1"></a><span class="co"># Average error per pond-size</span></span>
<span id="cb848-192"><a href="#cb848-192" aria-hidden="true" tabindex="-1"></a>error_avg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">list</span>(<span class="at">nopool_error =</span> nopool_error), </span>
<span id="cb848-193"><a href="#cb848-193" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">list</span>(<span class="at">pondsize =</span> dsim<span class="sc">$</span>ni), mean)</span>
<span id="cb848-194"><a href="#cb848-194" aria-hidden="true" tabindex="-1"></a>error_avg<span class="sc">$</span>partpool_error <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(partpool_error, <span class="fu">list</span>(dsim<span class="sc">$</span>ni), mean)[, <span class="dv">2</span>]</span>
<span id="cb848-195"><a href="#cb848-195" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(error_avg, <span class="dv">2</span>)</span>
<span id="cb848-196"><a href="#cb848-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-197"><a href="#cb848-197" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dsim<span class="sc">$</span>pond, nopool_error, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"blue"</span>, <span class="at">xlab =</span> <span class="st">"Pond ID"</span>, </span>
<span id="cb848-198"><a href="#cb848-198" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Absolute error"</span>, <span class="at">main =</span> title)</span>
<span id="cb848-199"><a href="#cb848-199" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dsim<span class="sc">$</span>pond, partpool_error, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb848-200"><a href="#cb848-200" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">61</span>), <span class="fu">c</span>(pbar, pbar), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb848-201"><a href="#cb848-201" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">15.5</span>, <span class="fl">15.5</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb848-202"><a href="#cb848-202" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">30.5</span>, <span class="fl">30.5</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb848-203"><a href="#cb848-203" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="fl">45.5</span>, <span class="fl">45.5</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb848-204"><a href="#cb848-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-205"><a href="#cb848-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-206"><a href="#cb848-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lines for average error</span></span>
<span id="cb848-207"><a href="#cb848-207" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb848-208"><a href="#cb848-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">15</span><span class="sc">*</span>j, <span class="dv">14</span> <span class="sc">+</span> <span class="dv">15</span><span class="sc">*</span>j), <span class="fu">c</span>(error_avg[j<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2</span>], error_avg[j<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2</span>]), <span class="at">col =</span> <span class="st">"blue"</span> )</span>
<span id="cb848-209"><a href="#cb848-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">15</span><span class="sc">*</span>j, <span class="dv">14</span> <span class="sc">+</span> <span class="dv">15</span><span class="sc">*</span>j), <span class="fu">c</span>(error_avg[j<span class="sc">+</span><span class="dv">1</span>, <span class="dv">3</span>], error_avg[j<span class="sc">+</span><span class="dv">1</span>, <span class="dv">3</span>]), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb848-210"><a href="#cb848-210" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb848-211"><a href="#cb848-211" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb848-212"><a href="#cb848-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-213"><a href="#cb848-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-214"><a href="#cb848-214" aria-hidden="true" tabindex="-1"></a>And now let's put that function to use and try out some variations of different parameters</span>
<span id="cb848-215"><a href="#cb848-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-216"><a href="#cb848-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MMN1.2, message=FALSE, results = "hide", fig.keep='all'}</span></span>
<span id="cb848-217"><a href="#cb848-217" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_tads</span>(<span class="at">title =</span> <span class="st">"A bar = 2, Sigma = 0.1"</span>) <span class="do">## McElreaths' baseline</span></span>
<span id="cb848-218"><a href="#cb848-218" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_tads</span>(<span class="at">a_bar =</span> <span class="fl">0.8</span>, <span class="at">title =</span> <span class="st">"A_bar = 0.8, Sigma = 0.1"</span>) <span class="co"># low a bar</span></span>
<span id="cb848-219"><a href="#cb848-219" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_tads</span>(<span class="at">sigma =</span> <span class="fl">0.5</span>, <span class="at">title =</span> <span class="st">"A bar = 10, Sigma = 5"</span>) <span class="co">#Large sigma</span></span>
<span id="cb848-220"><a href="#cb848-220" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_tads</span>(<span class="at">a_bar =</span> <span class="dv">10</span>, <span class="at">title =</span> <span class="st">"A bar = 10, Sigma = 0.1"</span>) <span class="co">#High a bar</span></span>
<span id="cb848-221"><a href="#cb848-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-222"><a href="#cb848-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-223"><a href="#cb848-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-224"><a href="#cb848-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-225"><a href="#cb848-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-226"><a href="#cb848-226" aria-hidden="true" tabindex="-1"></a>Seenms like a few things happend here. First, when the survival rate was esentially, 100%, increasing clusters did not have any effect on the error rate. In all cases, there was more pooling with fewer smaller clusters, as we would expect.</span>
<span id="cb848-227"><a href="#cb848-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-228"><a href="#cb848-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-229"><a href="#cb848-229" aria-hidden="true" tabindex="-1"></a><span class="fu"># SR 13</span></span>
<span id="cb848-230"><a href="#cb848-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-231"><a href="#cb848-231" aria-hidden="true" tabindex="-1"></a>My answers to the medium questions in chapter 13.</span>
<span id="cb848-232"><a href="#cb848-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-233"><a href="#cb848-233" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb848-234"><a href="#cb848-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-235"><a href="#cb848-235" aria-hidden="true" tabindex="-1"></a><span class="fu">### M1 </span></span>
<span id="cb848-236"><a href="#cb848-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-237"><a href="#cb848-237" aria-hidden="true" tabindex="-1"></a>The question says:</span>
<span id="cb848-238"><a href="#cb848-238" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb848-239"><a href="#cb848-239" aria-hidden="true" tabindex="-1"></a> <span class="at">&gt; “Revisit the Reed frog survival data, data(reedfrogs), and add the predation and size treatment variables to the varying intercepts model. Consider models with either main effect alone, both main effects, as well as a model including both and their interaction. Instead of focusing on inferences about these two predictor variables, focus on the inferred variation across tanks. Explain why it changes as it does across models.”</span></span>
<span id="cb848-240"><a href="#cb848-240" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb848-241"><a href="#cb848-241" aria-hidden="true" tabindex="-1"></a>We'll start with a null model (M~0~), that includes unique intercepts for tank. </span>
<span id="cb848-242"><a href="#cb848-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-243"><a href="#cb848-243" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-244"><a href="#cb848-244" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb848-245"><a href="#cb848-245" aria-hidden="true" tabindex="-1"></a>S_i &amp;\sim \mathrm{Binomial}(N_i, p_i)<span class="sc">\\</span></span>
<span id="cb848-246"><a href="#cb848-246" aria-hidden="true" tabindex="-1"></a>logit_p &amp;= \alpha_{\text{TANK<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}}<span class="sc">\\</span></span>
<span id="cb848-247"><a href="#cb848-247" aria-hidden="true" tabindex="-1"></a>\alpha_j &amp;\sim \mathrm{Normal(\bar{\alpha}, \sigma)}<span class="sc">\\</span></span>
<span id="cb848-248"><a href="#cb848-248" aria-hidden="true" tabindex="-1"></a>\bar{\alpha} &amp;\sim \mathrm{Normal}(0,1.5)<span class="sc">\\</span></span>
<span id="cb848-249"><a href="#cb848-249" aria-hidden="true" tabindex="-1"></a>\sigma &amp;\sim \mathrm{Exponential}(1)</span>
<span id="cb848-250"><a href="#cb848-250" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb848-251"><a href="#cb848-251" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-252"><a href="#cb848-252" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb848-253"><a href="#cb848-253" aria-hidden="true" tabindex="-1"></a> And of course, specify it using rethinking code.</span>
<span id="cb848-254"><a href="#cb848-254" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb848-255"><a href="#cb848-255" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR13-M1.1, results= "hide", message = FALSE}</span></span>
<span id="cb848-256"><a href="#cb848-256" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(reedfrogs)</span>
<span id="cb848-257"><a href="#cb848-257" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> reedfrogs <span class="sc">%&gt;%</span> </span>
<span id="cb848-258"><a href="#cb848-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tank =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">48</span>)</span>
<span id="cb848-259"><a href="#cb848-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-260"><a href="#cb848-260" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb848-261"><a href="#cb848-261" aria-hidden="true" tabindex="-1"></a>  <span class="at">S =</span> d<span class="sc">$</span>surv,</span>
<span id="cb848-262"><a href="#cb848-262" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> d<span class="sc">$</span>density,</span>
<span id="cb848-263"><a href="#cb848-263" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> d<span class="sc">$</span>size,</span>
<span id="cb848-264"><a href="#cb848-264" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred =</span> d<span class="sc">$</span>pred,</span>
<span id="cb848-265"><a href="#cb848-265" aria-hidden="true" tabindex="-1"></a>  <span class="at">tank =</span> d<span class="sc">$</span>tank,</span>
<span id="cb848-266"><a href="#cb848-266" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb848-267"><a href="#cb848-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-268"><a href="#cb848-268" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-269"><a href="#cb848-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-270"><a href="#cb848-270" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb848-271"><a href="#cb848-271" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank],</span>
<span id="cb848-272"><a href="#cb848-272" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(a_bar, sigma),</span>
<span id="cb848-273"><a href="#cb848-273" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb848-274"><a href="#cb848-274" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb848-275"><a href="#cb848-275" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb848-276"><a href="#cb848-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-277"><a href="#cb848-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-278"><a href="#cb848-278" aria-hidden="true" tabindex="-1"></a>Now, we do a more complicated model with main effects of both size and predation.</span>
<span id="cb848-279"><a href="#cb848-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-280"><a href="#cb848-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-281"><a href="#cb848-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR13-M1.2, results = "hide", message=FALSE}</span></span>
<span id="cb848-282"><a href="#cb848-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-283"><a href="#cb848-283" aria-hidden="true" tabindex="-1"></a>m_size <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-284"><a href="#cb848-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-285"><a href="#cb848-285" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb848-286"><a href="#cb848-286" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank] <span class="sc">+</span> size,</span>
<span id="cb848-287"><a href="#cb848-287" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(a_bar, sigma),</span>
<span id="cb848-288"><a href="#cb848-288" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb848-289"><a href="#cb848-289" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ),</span>
<span id="cb848-290"><a href="#cb848-290" aria-hidden="true" tabindex="-1"></a>    size <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb848-291"><a href="#cb848-291" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb848-292"><a href="#cb848-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-293"><a href="#cb848-293" aria-hidden="true" tabindex="-1"></a>post_size <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_size)</span>
<span id="cb848-294"><a href="#cb848-294" aria-hidden="true" tabindex="-1"></a>sigma_size <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">median</span>(post_size<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_size<span class="sc">$</span>sigma))</span>
<span id="cb848-295"><a href="#cb848-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-296"><a href="#cb848-296" aria-hidden="true" tabindex="-1"></a>m_pred <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-297"><a href="#cb848-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-298"><a href="#cb848-298" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb848-299"><a href="#cb848-299" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank] <span class="sc">+</span> bpred<span class="sc">*</span>pred,</span>
<span id="cb848-300"><a href="#cb848-300" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(a_bar, sigma),</span>
<span id="cb848-301"><a href="#cb848-301" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb848-302"><a href="#cb848-302" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ),</span>
<span id="cb848-303"><a href="#cb848-303" aria-hidden="true" tabindex="-1"></a>    bpred <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb848-304"><a href="#cb848-304" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb848-305"><a href="#cb848-305" aria-hidden="true" tabindex="-1"></a>post_pred <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_pred)</span>
<span id="cb848-306"><a href="#cb848-306" aria-hidden="true" tabindex="-1"></a>sigma_pred <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">median</span>(post_pred<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_pred<span class="sc">$</span>sigma))</span>
<span id="cb848-307"><a href="#cb848-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-308"><a href="#cb848-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-309"><a href="#cb848-309" aria-hidden="true" tabindex="-1"></a>m_mfx <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-310"><a href="#cb848-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-311"><a href="#cb848-311" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb848-312"><a href="#cb848-312" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank] <span class="sc">+</span> bsize<span class="sc">*</span>size <span class="sc">+</span> bpred<span class="sc">*</span>pred,</span>
<span id="cb848-313"><a href="#cb848-313" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(a_bar, sigma),</span>
<span id="cb848-314"><a href="#cb848-314" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb848-315"><a href="#cb848-315" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ),</span>
<span id="cb848-316"><a href="#cb848-316" aria-hidden="true" tabindex="-1"></a>    bsize <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb848-317"><a href="#cb848-317" aria-hidden="true" tabindex="-1"></a>    bpred <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb848-318"><a href="#cb848-318" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb848-319"><a href="#cb848-319" aria-hidden="true" tabindex="-1"></a>post_mfx <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_mfx)</span>
<span id="cb848-320"><a href="#cb848-320" aria-hidden="true" tabindex="-1"></a>sigma_mfx <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">median</span>(post_mfx<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_mfx<span class="sc">$</span>sigma))</span>
<span id="cb848-321"><a href="#cb848-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-322"><a href="#cb848-322" aria-hidden="true" tabindex="-1"></a>m_int <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-323"><a href="#cb848-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-324"><a href="#cb848-324" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb848-325"><a href="#cb848-325" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank] <span class="sc">+</span> apred[pred] <span class="sc">+</span> bsize[pred] <span class="sc">*</span> size ,</span>
<span id="cb848-326"><a href="#cb848-326" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(a_bar, sigma),</span>
<span id="cb848-327"><a href="#cb848-327" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb848-328"><a href="#cb848-328" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ),</span>
<span id="cb848-329"><a href="#cb848-329" aria-hidden="true" tabindex="-1"></a>    apred[pred] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb848-330"><a href="#cb848-330" aria-hidden="true" tabindex="-1"></a>    bsize[pred] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb848-331"><a href="#cb848-331" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb848-332"><a href="#cb848-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-333"><a href="#cb848-333" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample from the posterior and calculate highest posterior density intercals</span></span>
<span id="cb848-334"><a href="#cb848-334" aria-hidden="true" tabindex="-1"></a>post_int <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_int)</span>
<span id="cb848-335"><a href="#cb848-335" aria-hidden="true" tabindex="-1"></a>sigma_int <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">median</span>(post_int<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_int<span class="sc">$</span>sigma))</span>
<span id="cb848-336"><a href="#cb848-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-337"><a href="#cb848-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-338"><a href="#cb848-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-339"><a href="#cb848-339" aria-hidden="true" tabindex="-1"></a>We did this in class, so I'm going to highlight the important part, that we saw changes in sigma, but nothing else</span>
<span id="cb848-340"><a href="#cb848-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-341"><a href="#cb848-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, SR13-M1.3}</span></span>
<span id="cb848-342"><a href="#cb848-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-343"><a href="#cb848-343" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(sigma_size, sigma_pred, sigma_mfx, sigma_int)</span>
<span id="cb848-344"><a href="#cb848-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-345"><a href="#cb848-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-346"><a href="#cb848-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-347"><a href="#cb848-347" aria-hidden="true" tabindex="-1"></a>Seems like including predator reduces sigma, but that's it!</span>
<span id="cb848-348"><a href="#cb848-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-349"><a href="#cb848-349" aria-hidden="true" tabindex="-1"></a><span class="fu">### M2</span></span>
<span id="cb848-350"><a href="#cb848-350" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; “Compare the models you fit just above, using WAIC. Can you reconcile the differences in WAIC with the posterior distributions of the models?”</span></span>
<span id="cb848-351"><a href="#cb848-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-352"><a href="#cb848-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR13-M2.1}</span></span>
<span id="cb848-353"><a href="#cb848-353" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(m_mfx, m_size, m_int, m_pred)</span>
<span id="cb848-354"><a href="#cb848-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-355"><a href="#cb848-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-356"><a href="#cb848-356" aria-hidden="true" tabindex="-1"></a>The waic values are pretty similar. Maybe that's because our ability to predict the data didn't change much. </span>
<span id="cb848-357"><a href="#cb848-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-358"><a href="#cb848-358" aria-hidden="true" tabindex="-1"></a><span class="fu">### M3</span></span>
<span id="cb848-359"><a href="#cb848-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-360"><a href="#cb848-360" aria-hidden="true" tabindex="-1"></a> <span class="at">&gt; Re-estimate the basic Reed frog varying intercept model, but now using a Cauchy distribution in place of the Gaussian distribution for the varying intercepts.”</span></span>
<span id="cb848-361"><a href="#cb848-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-362"><a href="#cb848-362" aria-hidden="true" tabindex="-1"></a> <span class="at">&gt; Compare the posterior means of the intercepts, tank, to the posterior means produced in the chapter, using the customary Gaussian prior. Can you explain the pattern of differences? Take note of any change in the mean α as well.”</span></span>
<span id="cb848-363"><a href="#cb848-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-364"><a href="#cb848-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-365"><a href="#cb848-365" aria-hidden="true" tabindex="-1"></a>I start by fitting Gaussian and Cauchy models, like the question asks. </span>
<span id="cb848-366"><a href="#cb848-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-367"><a href="#cb848-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR13-M3.1, message = FALSE, results = "hide"}</span></span>
<span id="cb848-368"><a href="#cb848-368" aria-hidden="true" tabindex="-1"></a>m_cauchy <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-369"><a href="#cb848-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-370"><a href="#cb848-370" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb848-371"><a href="#cb848-371" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank],</span>
<span id="cb848-372"><a href="#cb848-372" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dcauchy</span>(a_bar, sigma),</span>
<span id="cb848-373"><a href="#cb848-373" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb848-374"><a href="#cb848-374" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb848-375"><a href="#cb848-375" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb848-376"><a href="#cb848-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-377"><a href="#cb848-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-378"><a href="#cb848-378" aria-hidden="true" tabindex="-1"></a>m_gaussian <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-379"><a href="#cb848-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-380"><a href="#cb848-380" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb848-381"><a href="#cb848-381" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank],</span>
<span id="cb848-382"><a href="#cb848-382" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">normal</span>(a_bar, sigma),</span>
<span id="cb848-383"><a href="#cb848-383" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb848-384"><a href="#cb848-384" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb848-385"><a href="#cb848-385" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb848-386"><a href="#cb848-386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-387"><a href="#cb848-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-388"><a href="#cb848-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-389"><a href="#cb848-389" aria-hidden="true" tabindex="-1"></a>Okay, first, we are going to sample from the posterior distrbutions</span>
<span id="cb848-390"><a href="#cb848-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-391"><a href="#cb848-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR13-M3.2}</span></span>
<span id="cb848-392"><a href="#cb848-392" aria-hidden="true" tabindex="-1"></a>post_cauchy <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_cauchy) </span>
<span id="cb848-393"><a href="#cb848-393" aria-hidden="true" tabindex="-1"></a>post_gaussian <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_gaussian)</span>
<span id="cb848-394"><a href="#cb848-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-395"><a href="#cb848-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-396"><a href="#cb848-396" aria-hidden="true" tabindex="-1"></a>And then compare the values that we get from that </span>
<span id="cb848-397"><a href="#cb848-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-398"><a href="#cb848-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR13-MR.3}</span></span>
<span id="cb848-399"><a href="#cb848-399" aria-hidden="true" tabindex="-1"></a><span class="co"># Yes, using this unweieldy code</span></span>
<span id="cb848-400"><a href="#cb848-400" aria-hidden="true" tabindex="-1"></a>cauchy_abar <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">median</span>(post_cauchy<span class="sc">$</span>a_bar), <span class="fu">HPDI</span>(post_cauchy<span class="sc">$</span>a_bar))</span>
<span id="cb848-401"><a href="#cb848-401" aria-hidden="true" tabindex="-1"></a>cauchy_sigma <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">median</span>(post_cauchy<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_cauchy<span class="sc">$</span>sigma))</span>
<span id="cb848-402"><a href="#cb848-402" aria-hidden="true" tabindex="-1"></a>gaussian_abar <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">median</span>(post_gaussian<span class="sc">$</span>a_bar), <span class="fu">HPDI</span>(post_gaussian<span class="sc">$</span>a_bar))</span>
<span id="cb848-403"><a href="#cb848-403" aria-hidden="true" tabindex="-1"></a>gaussian_sigma <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">median</span>(post_gaussian<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_gaussian<span class="sc">$</span>sigma))</span>
<span id="cb848-404"><a href="#cb848-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-405"><a href="#cb848-405" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(cauchy_abar, gaussian_abar, cauchy_sigma, gaussian_sigma)</span>
<span id="cb848-406"><a href="#cb848-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-407"><a href="#cb848-407" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-408"><a href="#cb848-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-409"><a href="#cb848-409" aria-hidden="true" tabindex="-1"></a>And doing this, it seems that cauchy leads to wider posteriors for abar and lower estimates of sigma.</span>
<span id="cb848-410"><a href="#cb848-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-411"><a href="#cb848-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-412"><a href="#cb848-412" aria-hidden="true" tabindex="-1"></a><span class="fu">### M4</span></span>
<span id="cb848-413"><a href="#cb848-413" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;“Now use a Student-t distribution with ν=2 for the intercepts:</span></span>
<span id="cb848-414"><a href="#cb848-414" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;αTANK~Student(2,α,σ)</span></span>
<span id="cb848-415"><a href="#cb848-415" aria-hidden="true" tabindex="-1"></a><span class="at">Refer back to the Student-t example in Chapter 7 (page 234), if necessary. Compare the resulting posterior to both the original model and the Cauchy model in 13M3. Can you explain the differences and similarities in shrinkage in terms of the properties of these distributions?</span></span>
<span id="cb848-416"><a href="#cb848-416" aria-hidden="true" tabindex="-1"></a><span class="at">”</span></span>
<span id="cb848-417"><a href="#cb848-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-418"><a href="#cb848-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR13-M4.1, message = FALSE, results = "hide"}</span></span>
<span id="cb848-419"><a href="#cb848-419" aria-hidden="true" tabindex="-1"></a>m_student <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-420"><a href="#cb848-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-421"><a href="#cb848-421" aria-hidden="true" tabindex="-1"></a>    S <span class="sc">~</span> <span class="fu">dbinom</span>(N, p),</span>
<span id="cb848-422"><a href="#cb848-422" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[tank],</span>
<span id="cb848-423"><a href="#cb848-423" aria-hidden="true" tabindex="-1"></a>    a[tank] <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="at">nu =</span> <span class="dv">2</span>, a_bar, sigma),</span>
<span id="cb848-424"><a href="#cb848-424" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="at">nu =</span> <span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb848-425"><a href="#cb848-425" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb848-426"><a href="#cb848-426" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb848-427"><a href="#cb848-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-428"><a href="#cb848-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-429"><a href="#cb848-429" aria-hidden="true" tabindex="-1"></a>Doing the same as in m3:</span>
<span id="cb848-430"><a href="#cb848-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-431"><a href="#cb848-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR13-M4.2}</span></span>
<span id="cb848-432"><a href="#cb848-432" aria-hidden="true" tabindex="-1"></a>post_student <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_student)</span>
<span id="cb848-433"><a href="#cb848-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-434"><a href="#cb848-434" aria-hidden="true" tabindex="-1"></a>student_abar <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">median</span>(post_student<span class="sc">$</span>a_bar), <span class="fu">HPDI</span>(post_student<span class="sc">$</span>a_bar))</span>
<span id="cb848-435"><a href="#cb848-435" aria-hidden="true" tabindex="-1"></a>student_sigma <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">median</span>(post_student<span class="sc">$</span>sigma), <span class="fu">HPDI</span>(post_student<span class="sc">$</span>sigma))</span>
<span id="cb848-436"><a href="#cb848-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-437"><a href="#cb848-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-438"><a href="#cb848-438" aria-hidden="true" tabindex="-1"></a>And then putting it all together again</span>
<span id="cb848-439"><a href="#cb848-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-440"><a href="#cb848-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR13-M4.3}</span></span>
<span id="cb848-441"><a href="#cb848-441" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(cauchy_abar, gaussian_abar, student_abar, cauchy_sigma, gaussian_sigma, student_sigma)</span>
<span id="cb848-442"><a href="#cb848-442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-443"><a href="#cb848-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-444"><a href="#cb848-444" aria-hidden="true" tabindex="-1"></a>It seems like student's distribution is somewhere between gaussian and cauchy</span>
<span id="cb848-445"><a href="#cb848-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-446"><a href="#cb848-446" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb848-447"><a href="#cb848-447" aria-hidden="true" tabindex="-1"></a><span class="fu"># MN2</span></span>
<span id="cb848-448"><a href="#cb848-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-449"><a href="#cb848-449" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;MN2: (a) Fit a varying intercept model to the running data, using rethinking::ulam or rstanarm::stan_glmer (or both). Visualize the results. (b) Do the same for the sleepstudy data.</span></span>
<span id="cb848-450"><a href="#cb848-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-451"><a href="#cb848-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-452"><a href="#cb848-452" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb848-453"><a href="#cb848-453" aria-hidden="true" tabindex="-1"></a><span class="fu">### a</span></span>
<span id="cb848-454"><a href="#cb848-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-455"><a href="#cb848-455" aria-hidden="true" tabindex="-1"></a>First, load the data and wrangle it lightly. The running data shows the effect of aging on running speeds. </span>
<span id="cb848-456"><a href="#cb848-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-457"><a href="#cb848-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MMN2.1}</span></span>
<span id="cb848-458"><a href="#cb848-458" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"cherry_blossom_sample"</span>)</span>
<span id="cb848-459"><a href="#cb848-459" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> cherry_blossom_sample <span class="sc">%&gt;%</span> </span>
<span id="cb848-460"><a href="#cb848-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_c =</span> age <span class="sc">-</span> <span class="dv">55</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb848-461"><a href="#cb848-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb848-462"><a href="#cb848-462" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb848-463"><a href="#cb848-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-464"><a href="#cb848-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-465"><a href="#cb848-465" aria-hidden="true" tabindex="-1"></a>Fit a simple varying intercepts model</span>
<span id="cb848-466"><a href="#cb848-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-467"><a href="#cb848-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MMN2.2, message = FALSE, results = "hide"}</span></span>
<span id="cb848-468"><a href="#cb848-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-469"><a href="#cb848-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-470"><a href="#cb848-470" aria-hidden="true" tabindex="-1"></a>m_runner <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-471"><a href="#cb848-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-472"><a href="#cb848-472" aria-hidden="true" tabindex="-1"></a>    net <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb848-473"><a href="#cb848-473" aria-hidden="true" tabindex="-1"></a>    mu<span class="ot">&lt;-</span> a[runner] <span class="sc">+</span> bage<span class="sc">*</span>age_c,</span>
<span id="cb848-474"><a href="#cb848-474" aria-hidden="true" tabindex="-1"></a>    a[runner] <span class="sc">~</span> <span class="fu">normal</span>( a_bar, sigma_a),</span>
<span id="cb848-475"><a href="#cb848-475" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb848-476"><a href="#cb848-476" aria-hidden="true" tabindex="-1"></a>    bage <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb848-477"><a href="#cb848-477" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>),</span>
<span id="cb848-478"><a href="#cb848-478" aria-hidden="true" tabindex="-1"></a>    sigma_a <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.11</span>)</span>
<span id="cb848-479"><a href="#cb848-479" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat , <span class="at">chains =</span> <span class="dv">4</span> , <span class="at">log_lik =</span> <span class="cn">TRUE</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb848-480"><a href="#cb848-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-481"><a href="#cb848-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-482"><a href="#cb848-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-483"><a href="#cb848-483" aria-hidden="true" tabindex="-1"></a>How to visualize this? Maybe an overall plot with all the data and then a few plots for the individual runners to show that this is not good enough. The first plot shows the overall relationship between age and time. This is the unpooled data. Next, the data for individual runners is shown. The black line represents the complete pooling and the blue line shows partial pooling using the intercepts only model. </span>
<span id="cb848-484"><a href="#cb848-484" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb848-485"><a href="#cb848-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MMN2.3, message = FALSE, warning=FALSE, }</span></span>
<span id="cb848-486"><a href="#cb848-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-487"><a href="#cb848-487" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_runner)<span class="sc">$</span>a <span class="sc">%&gt;%</span> <span class="co"># get the intercepts for each runner in a dataframe</span></span>
<span id="cb848-488"><a href="#cb848-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb848-489"><a href="#cb848-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"runner"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb848-490"><a href="#cb848-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(runner) <span class="sc">%&gt;%</span> </span>
<span id="cb848-491"><a href="#cb848-491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">intercept =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb848-492"><a href="#cb848-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">runner =</span> <span class="fu">gsub</span>(<span class="st">"V"</span>, <span class="st">""</span>, runner) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb848-493"><a href="#cb848-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(runner)</span>
<span id="cb848-494"><a href="#cb848-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-495"><a href="#cb848-495" aria-hidden="true" tabindex="-1"></a>dat_combined <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="co">#add the intercepts to our original runner dataset</span></span>
<span id="cb848-496"><a href="#cb848-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post, <span class="at">by =</span> <span class="st">"runner"</span>) </span>
<span id="cb848-497"><a href="#cb848-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-498"><a href="#cb848-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-499"><a href="#cb848-499" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_c, <span class="at">y =</span> net)) <span class="sc">+</span> <span class="co">#plot the complete pooling data</span></span>
<span id="cb848-500"><a href="#cb848-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb848-501"><a href="#cb848-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">90.70</span>, <span class="at">slope =</span>  <span class="fl">1.23</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb848-502"><a href="#cb848-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb848-503"><a href="#cb848-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-504"><a href="#cb848-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-505"><a href="#cb848-505" aria-hidden="true" tabindex="-1"></a>dat_combined <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_c, <span class="at">y =</span> net)) <span class="sc">+</span> <span class="co"># again, fill in with numbers from m_runner</span></span>
<span id="cb848-506"><a href="#cb848-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb848-507"><a href="#cb848-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="st">"runner"</span>) <span class="sc">+</span></span>
<span id="cb848-508"><a href="#cb848-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span>  <span class="fl">1.23</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb848-509"><a href="#cb848-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fl">90.70</span>, <span class="at">slope =</span>  <span class="fl">1.23</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb848-510"><a href="#cb848-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb848-511"><a href="#cb848-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-512"><a href="#cb848-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-513"><a href="#cb848-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-514"><a href="#cb848-514" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb848-515"><a href="#cb848-515" aria-hidden="true" tabindex="-1"></a><span class="fu">### b</span></span>
<span id="cb848-516"><a href="#cb848-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-517"><a href="#cb848-517" aria-hidden="true" tabindex="-1"></a>For this model, we want to predict Reaction time as a function of days and subject.</span>
<span id="cb848-518"><a href="#cb848-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-519"><a href="#cb848-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MMN2.4, message = FALSE}</span></span>
<span id="cb848-520"><a href="#cb848-520" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> sleepstudy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Days<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Days_bl =</span> Days<span class="dv">-2</span>)</span>
<span id="cb848-521"><a href="#cb848-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-522"><a href="#cb848-522" aria-hidden="true" tabindex="-1"></a>m_sleep <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-523"><a href="#cb848-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-524"><a href="#cb848-524" aria-hidden="true" tabindex="-1"></a>    Reaction <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb848-525"><a href="#cb848-525" aria-hidden="true" tabindex="-1"></a>    mu<span class="ot">&lt;-</span> a[Subject] <span class="sc">+</span> b_days<span class="sc">*</span>Days_bl,</span>
<span id="cb848-526"><a href="#cb848-526" aria-hidden="true" tabindex="-1"></a>    a[Subject] <span class="sc">~</span> <span class="fu">normal</span>( a_bar, sigma_a),</span>
<span id="cb848-527"><a href="#cb848-527" aria-hidden="true" tabindex="-1"></a>    a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">250</span>, <span class="dv">200</span>),</span>
<span id="cb848-528"><a href="#cb848-528" aria-hidden="true" tabindex="-1"></a>    b_days <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">100</span>),</span>
<span id="cb848-529"><a href="#cb848-529" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>),</span>
<span id="cb848-530"><a href="#cb848-530" aria-hidden="true" tabindex="-1"></a>    sigma_a <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>)</span>
<span id="cb848-531"><a href="#cb848-531" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> d , <span class="at">chains =</span> <span class="dv">4</span> ,  <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb848-532"><a href="#cb848-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-533"><a href="#cb848-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-534"><a href="#cb848-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-535"><a href="#cb848-535" aria-hidden="true" tabindex="-1"></a>I'm going to come back to this, but here is the code to visualize the data. The first plot shows the overall relationship between age and time. This is the unpooled data. Next, the data for individual runners is shown. The black line represents the complete pooling. </span>
<span id="cb848-536"><a href="#cb848-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-539"><a href="#cb848-539" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb848-540"><a href="#cb848-540" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_sleep)<span class="sc">$</span>a <span class="sc">%&gt;%</span> </span>
<span id="cb848-541"><a href="#cb848-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb848-542"><a href="#cb848-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Subject"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb848-543"><a href="#cb848-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Subject) <span class="sc">%&gt;%</span> </span>
<span id="cb848-544"><a href="#cb848-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">intercept =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb848-545"><a href="#cb848-545" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject =</span> <span class="fu">gsub</span>(<span class="st">"V"</span>, <span class="st">""</span>, Subject) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb848-546"><a href="#cb848-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Subject)</span>
<span id="cb848-547"><a href="#cb848-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-548"><a href="#cb848-548" aria-hidden="true" tabindex="-1"></a>d_combined <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="co"># add each person's intercept, useful for making the figure</span></span>
<span id="cb848-549"><a href="#cb848-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(Subject))) <span class="sc">%&gt;%</span> </span>
<span id="cb848-550"><a href="#cb848-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post, <span class="at">by =</span> <span class="st">"Subject"</span>) </span>
<span id="cb848-551"><a href="#cb848-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-552"><a href="#cb848-552" aria-hidden="true" tabindex="-1"></a>d_combined <span class="ot">&lt;-</span> d_combined <span class="sc">%&gt;%</span> <span class="co">#calculate the unpooled median for each subject</span></span>
<span id="cb848-553"><a href="#cb848-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Subject) <span class="sc">%&gt;%</span> </span>
<span id="cb848-554"><a href="#cb848-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unpooled =</span> <span class="fu">median</span>(Reaction)) <span class="sc">%&gt;%</span> </span>
<span id="cb848-555"><a href="#cb848-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb848-556"><a href="#cb848-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-557"><a href="#cb848-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-558"><a href="#cb848-558" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Days_bl, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb848-559"><a href="#cb848-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb848-560"><a href="#cb848-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">267.72</span>, <span class="at">slope =</span>  <span class="fl">11.47</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="co"># fill in with numbers from m_sleep</span></span>
<span id="cb848-561"><a href="#cb848-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb848-562"><a href="#cb848-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-563"><a href="#cb848-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-564"><a href="#cb848-564" aria-hidden="true" tabindex="-1"></a>d_combined <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Days_bl, <span class="at">y =</span> Reaction)) <span class="sc">+</span> <span class="co"># again, fill in with numbers from m_sleep</span></span>
<span id="cb848-565"><a href="#cb848-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb848-566"><a href="#cb848-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="st">"Subject"</span>) <span class="sc">+</span></span>
<span id="cb848-567"><a href="#cb848-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span>  <span class="fl">11.47</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb848-568"><a href="#cb848-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fl">267.72</span>, <span class="at">slope =</span>  <span class="fl">11.47</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb848-569"><a href="#cb848-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb848-570"><a href="#cb848-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-571"><a href="#cb848-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-572"><a href="#cb848-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-573"><a href="#cb848-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-574"><a href="#cb848-574" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb848-575"><a href="#cb848-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-576"><a href="#cb848-576" aria-hidden="true" tabindex="-1"></a><span class="fu"># SR 14</span></span>
<span id="cb848-577"><a href="#cb848-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-578"><a href="#cb848-578" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb848-579"><a href="#cb848-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-580"><a href="#cb848-580" aria-hidden="true" tabindex="-1"></a><span class="fu">### M1</span></span>
<span id="cb848-581"><a href="#cb848-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-582"><a href="#cb848-582" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; “Repeat the café robot simulation from the beginning of the chapter. This time, set rho to zero, so that there is no correlation between intercepts and slopes. How does the posterior distribution of the correlation reflect this change in the underlying simulation?”</span></span>
<span id="cb848-583"><a href="#cb848-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-584"><a href="#cb848-584" aria-hidden="true" tabindex="-1"></a>To answer this questions, I've made a function using McElreath's code - <span class="in">`sim_mvn()`</span>.</span>
<span id="cb848-585"><a href="#cb848-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-586"><a href="#cb848-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR14-M1.1} </span></span>
<span id="cb848-587"><a href="#cb848-587" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS) <span class="co"># had to load this, seems some other package was overwriting the mvrnorm function</span></span>
<span id="cb848-588"><a href="#cb848-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-589"><a href="#cb848-589" aria-hidden="true" tabindex="-1"></a>sim_mvn <span class="ot">&lt;-</span> <span class="cf">function</span>(rho){</span>
<span id="cb848-590"><a href="#cb848-590" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fl">3.5</span> <span class="co"># average morning wait time</span></span>
<span id="cb848-591"><a href="#cb848-591" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span>) <span class="co"># average differene afternon wait time</span></span>
<span id="cb848-592"><a href="#cb848-592" aria-hidden="true" tabindex="-1"></a>  sigma_a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#std dev in intercepts</span></span>
<span id="cb848-593"><a href="#cb848-593" aria-hidden="true" tabindex="-1"></a>  sigma_b <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co">#sd in slopes</span></span>
<span id="cb848-594"><a href="#cb848-594" aria-hidden="true" tabindex="-1"></a>  rho <span class="ot">&lt;-</span> rho <span class="co"># no correlation</span></span>
<span id="cb848-595"><a href="#cb848-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-596"><a href="#cb848-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-597"><a href="#cb848-597" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)</span>
<span id="cb848-598"><a href="#cb848-598" aria-hidden="true" tabindex="-1"></a>  sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma_a, sigma_b) <span class="co">#standard deviations</span></span>
<span id="cb848-599"><a href="#cb848-599" aria-hidden="true" tabindex="-1"></a>  Rho <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>) <span class="co">#correlation matrix</span></span>
<span id="cb848-600"><a href="#cb848-600" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigmas) <span class="sc">%*%</span> Rho <span class="sc">%*%</span> <span class="fu">diag</span>(sigmas)</span>
<span id="cb848-601"><a href="#cb848-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-602"><a href="#cb848-602" aria-hidden="true" tabindex="-1"></a>  n_cafes <span class="ot">=</span> <span class="dv">20</span> <span class="co">#the number of cafes</span></span>
<span id="cb848-603"><a href="#cb848-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mvrnorm</span>(n_cafes, mu, sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb848-604"><a href="#cb848-604" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb848-605"><a href="#cb848-605" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">"Intercepts"</span> <span class="ot">=</span> V1,</span>
<span id="cb848-606"><a href="#cb848-606" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Slopes"</span> <span class="ot">=</span> V2) <span class="sc">%&gt;%</span> </span>
<span id="cb848-607"><a href="#cb848-607" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Intercepts, <span class="at">y =</span> Slopes))<span class="sc">+</span></span>
<span id="cb848-608"><a href="#cb848-608" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb848-609"><a href="#cb848-609" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="dv">4</span>) <span class="sc">+</span>  <span class="co">#This code feels a little sloppy, but I couldn't figure out a better way</span></span>
<span id="cb848-610"><a href="#cb848-610" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb848-611"><a href="#cb848-611" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb848-612"><a href="#cb848-612" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb848-613"><a href="#cb848-613" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.1</span>, <span class="at">color =</span> <span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb848-614"><a href="#cb848-614" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span>
<span id="cb848-615"><a href="#cb848-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-616"><a href="#cb848-616" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb848-617"><a href="#cb848-617" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-618"><a href="#cb848-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-619"><a href="#cb848-619" aria-hidden="true" tabindex="-1"></a>And now I carry out this function over <span class="in">`rho`</span> of 0.1, 0.5, and 0.7.</span>
<span id="cb848-620"><a href="#cb848-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-621"><a href="#cb848-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR14-M1.2, results= "hide", fig.keep= 'all'} </span></span>
<span id="cb848-622"><a href="#cb848-622" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_mvn</span>(<span class="at">rho =</span> <span class="fl">0.1</span>)</span>
<span id="cb848-623"><a href="#cb848-623" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_mvn</span>(<span class="at">rho =</span> <span class="fl">0.5</span>)</span>
<span id="cb848-624"><a href="#cb848-624" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_mvn</span>(<span class="at">rho =</span> <span class="fl">0.7</span>)</span>
<span id="cb848-625"><a href="#cb848-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-626"><a href="#cb848-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-627"><a href="#cb848-627" aria-hidden="true" tabindex="-1"></a>The question was, how does the posterior distribution refelct this change. And it seems like, well, the two values are not as correlated. Also the ellipses are way less round. Seems like this doesn't actually answer the question, but the graphs look neat, so I'm going to keep them!</span>
<span id="cb848-628"><a href="#cb848-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-629"><a href="#cb848-629" aria-hidden="true" tabindex="-1"></a>Instead, I'm going to keep going and carry out the cafe simulations using McElreath's code.</span>
<span id="cb848-630"><a href="#cb848-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-631"><a href="#cb848-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR14-M1.3}</span></span>
<span id="cb848-632"><a href="#cb848-632" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">3.5</span> <span class="co"># average morning wait time</span></span>
<span id="cb848-633"><a href="#cb848-633" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span>) <span class="co"># average differene afternon wait time</span></span>
<span id="cb848-634"><a href="#cb848-634" aria-hidden="true" tabindex="-1"></a>sigma_a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#std dev in intercepts</span></span>
<span id="cb848-635"><a href="#cb848-635" aria-hidden="true" tabindex="-1"></a>sigma_b <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co">#sd in slopes</span></span>
<span id="cb848-636"><a href="#cb848-636" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># no correlation</span></span>
<span id="cb848-637"><a href="#cb848-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-638"><a href="#cb848-638" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)</span>
<span id="cb848-639"><a href="#cb848-639" aria-hidden="true" tabindex="-1"></a>sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma_a, sigma_b) <span class="co">#standard deviations</span></span>
<span id="cb848-640"><a href="#cb848-640" aria-hidden="true" tabindex="-1"></a>Rho <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>) <span class="co">#correlation matrix</span></span>
<span id="cb848-641"><a href="#cb848-641" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigmas) <span class="sc">%*%</span> Rho <span class="sc">%*%</span> <span class="fu">diag</span>(sigmas)</span>
<span id="cb848-642"><a href="#cb848-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-643"><a href="#cb848-643" aria-hidden="true" tabindex="-1"></a>n_cafes <span class="ot">=</span> <span class="dv">20</span> <span class="co">#the number of cafes</span></span>
<span id="cb848-644"><a href="#cb848-644" aria-hidden="true" tabindex="-1"></a>vary_effects <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_cafes, mu, sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb848-645"><a href="#cb848-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb848-646"><a href="#cb848-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Intercepts"</span> <span class="ot">=</span> V1,</span>
<span id="cb848-647"><a href="#cb848-647" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Slopes"</span> <span class="ot">=</span> V2)</span>
<span id="cb848-648"><a href="#cb848-648" aria-hidden="true" tabindex="-1"></a>a_cafe <span class="ot">=</span>vary_effects<span class="sc">$</span>Intercepts</span>
<span id="cb848-649"><a href="#cb848-649" aria-hidden="true" tabindex="-1"></a>b_cafe <span class="ot">=</span> vary_effects<span class="sc">$</span>Slopes</span>
<span id="cb848-650"><a href="#cb848-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-651"><a href="#cb848-651" aria-hidden="true" tabindex="-1"></a>n_visits <span class="ot">=</span> <span class="dv">20</span> <span class="co"># how many visits?</span></span>
<span id="cb848-652"><a href="#cb848-652" aria-hidden="true" tabindex="-1"></a>afternoon <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, n_visits <span class="sc">*</span> n_cafes<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb848-653"><a href="#cb848-653" aria-hidden="true" tabindex="-1"></a>cafe_id <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span> n_cafes, <span class="at">each =</span> n_visits)</span>
<span id="cb848-654"><a href="#cb848-654" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">=</span> a_cafe[cafe_id]<span class="sc">*</span>b_cafe[cafe_id]<span class="sc">*</span>afternoon</span>
<span id="cb848-655"><a href="#cb848-655" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb848-656"><a href="#cb848-656" aria-hidden="true" tabindex="-1"></a>wait <span class="ot">=</span> <span class="fu">rnorm</span>(n_visits<span class="sc">*</span>n_cafes, mu, sigma)</span>
<span id="cb848-657"><a href="#cb848-657" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">cafe =</span> cafe_id, <span class="at">afternoon =</span> afternoon, <span class="at">wait =</span> wait)</span>
<span id="cb848-658"><a href="#cb848-658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-659"><a href="#cb848-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-660"><a href="#cb848-660" aria-hidden="true" tabindex="-1"></a>Having simulated data, let's fit a model. The question is, when rho is zero how do our posteriors differ from our priors?</span>
<span id="cb848-661"><a href="#cb848-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-662"><a href="#cb848-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR14-M1.4, results = "hide", warning=FALSE, message=FALSE, fig.keep='all'}</span></span>
<span id="cb848-663"><a href="#cb848-663" aria-hidden="true" tabindex="-1"></a>m_cafesim <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-664"><a href="#cb848-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>( </span>
<span id="cb848-665"><a href="#cb848-665" aria-hidden="true" tabindex="-1"></a>    wait <span class="sc">~</span> <span class="fu">normal</span>(mu, sigma),</span>
<span id="cb848-666"><a href="#cb848-666" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span>  a_cafe[cafe] <span class="sc">+</span> b_cafe[cafe]<span class="sc">*</span>afternoon,</span>
<span id="cb848-667"><a href="#cb848-667" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(a_cafe, b_cafe)[cafe] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(a,b), rho, sigma_cafe),</span>
<span id="cb848-668"><a href="#cb848-668" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">5</span>,<span class="dv">2</span>),</span>
<span id="cb848-669"><a href="#cb848-669" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb848-670"><a href="#cb848-670" aria-hidden="true" tabindex="-1"></a>    sigma_cafe <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb848-671"><a href="#cb848-671" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb848-672"><a href="#cb848-672" aria-hidden="true" tabindex="-1"></a>    rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>)),</span>
<span id="cb848-673"><a href="#cb848-673" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb848-674"><a href="#cb848-674" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb848-675"><a href="#cb848-675" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb848-676"><a href="#cb848-676" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb848-677"><a href="#cb848-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-678"><a href="#cb848-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-679"><a href="#cb848-679" aria-hidden="true" tabindex="-1"></a>Having fit the model, let's plot the posterior against the prior. What do we get?</span>
<span id="cb848-680"><a href="#cb848-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-681"><a href="#cb848-681" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR14-M1.5, ouput = FALSE}</span></span>
<span id="cb848-682"><a href="#cb848-682" aria-hidden="true" tabindex="-1"></a>post <span class="ot">=</span> <span class="fu">extract.samples</span>(m_cafesim)</span>
<span id="cb848-683"><a href="#cb848-683" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>( post<span class="sc">$</span>rho[,<span class="dv">1</span>,<span class="dv">2</span>] , <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) )</span>
<span id="cb848-684"><a href="#cb848-684" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">rlkjcorr</span>( <span class="fl">1e4</span> , <span class="at">K=</span><span class="dv">2</span> , <span class="at">eta=</span><span class="dv">2</span> )<span class="co"># prior</span></span>
<span id="cb848-685"><a href="#cb848-685" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>( R[,<span class="dv">1</span>,<span class="dv">2</span>] , <span class="at">add=</span><span class="cn">TRUE</span> , <span class="at">lty=</span><span class="dv">2</span> )</span>
<span id="cb848-686"><a href="#cb848-686" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-687"><a href="#cb848-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-688"><a href="#cb848-688" aria-hidden="true" tabindex="-1"></a>Ah. It seems the takeaway is that the posterior is almost exactly the same as the prior. </span>
<span id="cb848-689"><a href="#cb848-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-690"><a href="#cb848-690" aria-hidden="true" tabindex="-1"></a><span class="fu">### M2</span></span>
<span id="cb848-691"><a href="#cb848-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-692"><a href="#cb848-692" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;“Fit this multilevel model to the simulated café data:</span></span>
<span id="cb848-693"><a href="#cb848-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-694"><a href="#cb848-694" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-695"><a href="#cb848-695" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb848-696"><a href="#cb848-696" aria-hidden="true" tabindex="-1"></a>\text{Wait}_{i} &amp; \sim \mathrm{Normal}(\mu_{i}, \sigma) <span class="sc">\\</span></span>
<span id="cb848-697"><a href="#cb848-697" aria-hidden="true" tabindex="-1"></a>\mu_i &amp; = \alpha_{\text{CAFE}<span class="co">[</span><span class="ot">i</span><span class="co">]</span>} +\beta_{\text{CAFE}<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}\text{A}_i<span class="sc">\\</span></span>
<span id="cb848-698"><a href="#cb848-698" aria-hidden="true" tabindex="-1"></a>\alpha_{\text{CAFE}<span class="co">[</span><span class="ot">i</span><span class="co">]</span>} &amp; \sim \mathrm{Normal}(\alpha, \sigma_{\alpha})<span class="sc">\\</span></span>
<span id="cb848-699"><a href="#cb848-699" aria-hidden="true" tabindex="-1"></a>\beta_{\text{CAFE}<span class="co">[</span><span class="ot">i</span><span class="co">]</span>} &amp; \sim \mathrm{Normal}(\beta,  \sigma_{\beta})<span class="sc">\\</span></span>
<span id="cb848-700"><a href="#cb848-700" aria-hidden="true" tabindex="-1"></a>\alpha &amp; \sim \mathrm{Normal}(0,10)<span class="sc">\\</span></span>
<span id="cb848-701"><a href="#cb848-701" aria-hidden="true" tabindex="-1"></a>\beta &amp; \sim \mathrm{Normal}(0,3)<span class="sc">\\</span></span>
<span id="cb848-702"><a href="#cb848-702" aria-hidden="true" tabindex="-1"></a>\sigma, \sigma_{\alpha}, \sigma_{\beta} &amp;\sim \mathrm{Exponential}(1)<span class="sc">\\</span></span>
<span id="cb848-703"><a href="#cb848-703" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb848-704"><a href="#cb848-704" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-705"><a href="#cb848-705" aria-hidden="true" tabindex="-1"></a>I think McElreath forgot to add something here, maybe an extra $\beta$ somewhere. So I stuck one in there, with what seemed like a vaguely reasonable prior.</span>
<span id="cb848-706"><a href="#cb848-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-707"><a href="#cb848-707" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;Use WAIC to compare this model to the model from the chapter, the one that uses a multi-variate Gaussian prior. Explain the result.”</span></span>
<span id="cb848-708"><a href="#cb848-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-709"><a href="#cb848-709" aria-hidden="true" tabindex="-1"></a>McElreath is a little bit unclear here, but I assume he means that we should use his original simulation, not the one we did just now, so that's what I'm going to do. </span>
<span id="cb848-710"><a href="#cb848-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-711"><a href="#cb848-711" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, SR14-M2.1, results = "hide"}</span></span>
<span id="cb848-712"><a href="#cb848-712" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb848-713"><a href="#cb848-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-714"><a href="#cb848-714" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">3.5</span> <span class="co"># average morning wait time</span></span>
<span id="cb848-715"><a href="#cb848-715" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span>) <span class="co"># average differene afternon wait time</span></span>
<span id="cb848-716"><a href="#cb848-716" aria-hidden="true" tabindex="-1"></a>sigma_a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#std dev in intercepts</span></span>
<span id="cb848-717"><a href="#cb848-717" aria-hidden="true" tabindex="-1"></a>sigma_b <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co">#sd in slopes</span></span>
<span id="cb848-718"><a href="#cb848-718" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.7</span> <span class="co"># no correlation</span></span>
<span id="cb848-719"><a href="#cb848-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-720"><a href="#cb848-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-721"><a href="#cb848-721" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)</span>
<span id="cb848-722"><a href="#cb848-722" aria-hidden="true" tabindex="-1"></a>sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma_a, sigma_b) <span class="co">#standard deviations</span></span>
<span id="cb848-723"><a href="#cb848-723" aria-hidden="true" tabindex="-1"></a>Rho <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>) <span class="co">#correlation matrix</span></span>
<span id="cb848-724"><a href="#cb848-724" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigmas) <span class="sc">%*%</span> Rho <span class="sc">%*%</span> <span class="fu">diag</span>(sigmas)</span>
<span id="cb848-725"><a href="#cb848-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-726"><a href="#cb848-726" aria-hidden="true" tabindex="-1"></a>n_cafes <span class="ot">=</span> <span class="dv">20</span> <span class="co">#the number of cafes</span></span>
<span id="cb848-727"><a href="#cb848-727" aria-hidden="true" tabindex="-1"></a>vary_effects <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_cafes, mu, sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb848-728"><a href="#cb848-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb848-729"><a href="#cb848-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Intercepts"</span> <span class="ot">=</span> V1,</span>
<span id="cb848-730"><a href="#cb848-730" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Slopes"</span> <span class="ot">=</span> V2)</span>
<span id="cb848-731"><a href="#cb848-731" aria-hidden="true" tabindex="-1"></a>a_cafe <span class="ot">=</span>vary_effects<span class="sc">$</span>Intercepts</span>
<span id="cb848-732"><a href="#cb848-732" aria-hidden="true" tabindex="-1"></a>b_cafe <span class="ot">=</span> vary_effects<span class="sc">$</span>Slopes</span>
<span id="cb848-733"><a href="#cb848-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-734"><a href="#cb848-734" aria-hidden="true" tabindex="-1"></a>n_visits <span class="ot">=</span> <span class="dv">20</span> <span class="co"># how many visits?</span></span>
<span id="cb848-735"><a href="#cb848-735" aria-hidden="true" tabindex="-1"></a>afternoon <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, n_visits <span class="sc">*</span> n_cafes<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb848-736"><a href="#cb848-736" aria-hidden="true" tabindex="-1"></a>cafe_id <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span> n_cafes, <span class="at">each =</span> n_visits)</span>
<span id="cb848-737"><a href="#cb848-737" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">=</span> a_cafe[cafe_id]<span class="sc">+</span>b_cafe[cafe_id]<span class="sc">*</span>afternoon</span>
<span id="cb848-738"><a href="#cb848-738" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb848-739"><a href="#cb848-739" aria-hidden="true" tabindex="-1"></a>wait <span class="ot">=</span> <span class="fu">rnorm</span>(n_visits<span class="sc">*</span>n_cafes, mu, sigma)</span>
<span id="cb848-740"><a href="#cb848-740" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">cafe =</span> cafe_id, <span class="at">afternoon =</span> afternoon, <span class="at">wait =</span> wait)</span>
<span id="cb848-741"><a href="#cb848-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-742"><a href="#cb848-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-743"><a href="#cb848-743" aria-hidden="true" tabindex="-1"></a>having simulated the data, let's fit two models, one with covarying slopes and intercepts and one just varying slopes &amp; intercepts.</span>
<span id="cb848-744"><a href="#cb848-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-745"><a href="#cb848-745" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SR14-M2.2, ouput = FALSE}</span></span>
<span id="cb848-746"><a href="#cb848-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-747"><a href="#cb848-747" aria-hidden="true" tabindex="-1"></a><span class="co">#no covariation</span></span>
<span id="cb848-748"><a href="#cb848-748" aria-hidden="true" tabindex="-1"></a>m_novariation <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-749"><a href="#cb848-749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>( </span>
<span id="cb848-750"><a href="#cb848-750" aria-hidden="true" tabindex="-1"></a>    wait <span class="sc">~</span> <span class="fu">normal</span>(mu, sigma),</span>
<span id="cb848-751"><a href="#cb848-751" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span>  a[cafe] <span class="sc">+</span> b[cafe]<span class="sc">*</span>afternoon,</span>
<span id="cb848-752"><a href="#cb848-752" aria-hidden="true" tabindex="-1"></a>    a[cafe] <span class="sc">~</span> <span class="fu">normal</span>(a, sigma_a),</span>
<span id="cb848-753"><a href="#cb848-753" aria-hidden="true" tabindex="-1"></a>    b[cafe] <span class="sc">~</span> <span class="fu">normal</span>(b, sigma_b),</span>
<span id="cb848-754"><a href="#cb848-754" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>),</span>
<span id="cb848-755"><a href="#cb848-755" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">3</span>),</span>
<span id="cb848-756"><a href="#cb848-756" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb848-757"><a href="#cb848-757" aria-hidden="true" tabindex="-1"></a>    sigma_a <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb848-758"><a href="#cb848-758" aria-hidden="true" tabindex="-1"></a>    sigma_b <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb848-759"><a href="#cb848-759" aria-hidden="true" tabindex="-1"></a>    rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>)),</span>
<span id="cb848-760"><a href="#cb848-760" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb848-761"><a href="#cb848-761" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb848-762"><a href="#cb848-762" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb848-763"><a href="#cb848-763" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb848-764"><a href="#cb848-764" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb848-765"><a href="#cb848-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-766"><a href="#cb848-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-767"><a href="#cb848-767" aria-hidden="true" tabindex="-1"></a><span class="co">#covarying slopes &amp; intercepts</span></span>
<span id="cb848-768"><a href="#cb848-768" aria-hidden="true" tabindex="-1"></a>m_covarying <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-769"><a href="#cb848-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>( </span>
<span id="cb848-770"><a href="#cb848-770" aria-hidden="true" tabindex="-1"></a>    wait <span class="sc">~</span> <span class="fu">normal</span>(mu, sigma),</span>
<span id="cb848-771"><a href="#cb848-771" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span>  a_cafe[cafe] <span class="sc">+</span> b_cafe[cafe]<span class="sc">*</span>afternoon,</span>
<span id="cb848-772"><a href="#cb848-772" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(a_cafe, b_cafe)[cafe] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(a,b), rho, sigma_cafe),</span>
<span id="cb848-773"><a href="#cb848-773" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">5</span>,<span class="dv">2</span>),</span>
<span id="cb848-774"><a href="#cb848-774" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb848-775"><a href="#cb848-775" aria-hidden="true" tabindex="-1"></a>    sigma_cafe <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb848-776"><a href="#cb848-776" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb848-777"><a href="#cb848-777" aria-hidden="true" tabindex="-1"></a>    rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>)),</span>
<span id="cb848-778"><a href="#cb848-778" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb848-779"><a href="#cb848-779" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb848-780"><a href="#cb848-780" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb848-781"><a href="#cb848-781" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb848-782"><a href="#cb848-782" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb848-783"><a href="#cb848-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-784"><a href="#cb848-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-785"><a href="#cb848-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-786"><a href="#cb848-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-787"><a href="#cb848-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-788"><a href="#cb848-788" aria-hidden="true" tabindex="-1"></a>When we compare them, they look pretty similar? I wonder if I did something wrong or if there is a deeper point here...</span>
<span id="cb848-789"><a href="#cb848-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-792"><a href="#cb848-792" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb848-793"><a href="#cb848-793" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(m_covarying, m_novariation)</span>
<span id="cb848-794"><a href="#cb848-794" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-795"><a href="#cb848-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-796"><a href="#cb848-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-797"><a href="#cb848-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-798"><a href="#cb848-798" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb848-799"><a href="#cb848-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-800"><a href="#cb848-800" aria-hidden="true" tabindex="-1"></a><span class="fu"># MN3</span></span>
<span id="cb848-801"><a href="#cb848-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-802"><a href="#cb848-802" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Repeat the café simulation from the book (section 14.1), but for scenarios with less and more visits to each café (N_visits = 10 in the book), display result for each simulation in way that visualizes the difference (shrinking) in MLM compared to a no-pooling model. At what sample size (N_visits) do partial and no pooling lead to the same results?</span></span>
<span id="cb848-803"><a href="#cb848-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-804"><a href="#cb848-804" aria-hidden="true" tabindex="-1"></a>Here's how I feel about the café data.</span>
<span id="cb848-805"><a href="#cb848-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-806"><a href="#cb848-806" aria-hidden="true" tabindex="-1"></a>{{&lt; video https://www.youtube.com/watch?v=UPw-3e_pzqU &gt;}}</span>
<span id="cb848-807"><a href="#cb848-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-808"><a href="#cb848-808" aria-hidden="true" tabindex="-1"></a>Anyway, since the question involves carrying out the same operation multiple times with different parameters, I'm going to start by making a function of the whole thing, again, basically taking a version o McElreath's code. </span>
<span id="cb848-809"><a href="#cb848-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-810"><a href="#cb848-810" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MN3.1}</span></span>
<span id="cb848-811"><a href="#cb848-811" aria-hidden="true" tabindex="-1"></a>simulate_cafe <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">visits =</span> visits){</span>
<span id="cb848-812"><a href="#cb848-812" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fl">3.5</span> <span class="co"># average morning wait time</span></span>
<span id="cb848-813"><a href="#cb848-813" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span>) <span class="co"># average differene afternon wait time</span></span>
<span id="cb848-814"><a href="#cb848-814" aria-hidden="true" tabindex="-1"></a>  sigma_a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#std dev in intercepts</span></span>
<span id="cb848-815"><a href="#cb848-815" aria-hidden="true" tabindex="-1"></a>  sigma_b <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co">#sd in slopes</span></span>
<span id="cb848-816"><a href="#cb848-816" aria-hidden="true" tabindex="-1"></a>  rho <span class="ot">&lt;-</span> <span class="fl">0.7</span> <span class="co"># no correlation</span></span>
<span id="cb848-817"><a href="#cb848-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-818"><a href="#cb848-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-819"><a href="#cb848-819" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)</span>
<span id="cb848-820"><a href="#cb848-820" aria-hidden="true" tabindex="-1"></a>  sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma_a, sigma_b) <span class="co">#standard deviations</span></span>
<span id="cb848-821"><a href="#cb848-821" aria-hidden="true" tabindex="-1"></a>  Rho <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>) <span class="co">#correlation matrix</span></span>
<span id="cb848-822"><a href="#cb848-822" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigmas) <span class="sc">%*%</span> Rho <span class="sc">%*%</span> <span class="fu">diag</span>(sigmas)</span>
<span id="cb848-823"><a href="#cb848-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-824"><a href="#cb848-824" aria-hidden="true" tabindex="-1"></a>  n_cafes <span class="ot">=</span> <span class="dv">20</span> <span class="co">#the number of cafes</span></span>
<span id="cb848-825"><a href="#cb848-825" aria-hidden="true" tabindex="-1"></a>  vary_effects <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_cafes, mu, sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb848-826"><a href="#cb848-826" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb848-827"><a href="#cb848-827" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">"Intercepts"</span> <span class="ot">=</span> V1,</span>
<span id="cb848-828"><a href="#cb848-828" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Slopes"</span> <span class="ot">=</span> V2)</span>
<span id="cb848-829"><a href="#cb848-829" aria-hidden="true" tabindex="-1"></a>  a_cafe <span class="ot">=</span>vary_effects<span class="sc">$</span>Intercepts</span>
<span id="cb848-830"><a href="#cb848-830" aria-hidden="true" tabindex="-1"></a>  b_cafe <span class="ot">=</span> vary_effects<span class="sc">$</span>Slopes</span>
<span id="cb848-831"><a href="#cb848-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-832"><a href="#cb848-832" aria-hidden="true" tabindex="-1"></a>   <span class="co"># how many visits?</span></span>
<span id="cb848-833"><a href="#cb848-833" aria-hidden="true" tabindex="-1"></a>  afternoon <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, visits <span class="sc">*</span> n_cafes<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb848-834"><a href="#cb848-834" aria-hidden="true" tabindex="-1"></a>  cafe_id <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span> n_cafes, <span class="at">each =</span> visits)</span>
<span id="cb848-835"><a href="#cb848-835" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">=</span> a_cafe[cafe_id]<span class="sc">+</span>b_cafe[cafe_id]<span class="sc">*</span>afternoon</span>
<span id="cb848-836"><a href="#cb848-836" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb848-837"><a href="#cb848-837" aria-hidden="true" tabindex="-1"></a>  wait <span class="ot">=</span> <span class="fu">rnorm</span>(visits<span class="sc">*</span>n_cafes, mu, sigma)</span>
<span id="cb848-838"><a href="#cb848-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">cafe =</span> cafe_id, <span class="at">afternoon =</span> afternoon, <span class="at">wait =</span> wait))</span>
<span id="cb848-839"><a href="#cb848-839" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb848-840"><a href="#cb848-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-841"><a href="#cb848-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-842"><a href="#cb848-842" aria-hidden="true" tabindex="-1"></a>And then I run the simulations with varying numbers of visits. </span>
<span id="cb848-843"><a href="#cb848-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-844"><a href="#cb848-844" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MN3.2}</span></span>
<span id="cb848-845"><a href="#cb848-845" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">simulate_cafe</span>(<span class="at">visits =</span> <span class="dv">2</span>)</span>
<span id="cb848-846"><a href="#cb848-846" aria-hidden="true" tabindex="-1"></a>d5 <span class="ot">&lt;-</span> <span class="fu">simulate_cafe</span>(<span class="at">visits =</span> <span class="dv">5</span>)</span>
<span id="cb848-847"><a href="#cb848-847" aria-hidden="true" tabindex="-1"></a>d10 <span class="ot">&lt;-</span> <span class="fu">simulate_cafe</span>(<span class="at">visits =</span> <span class="dv">10</span>)</span>
<span id="cb848-848"><a href="#cb848-848" aria-hidden="true" tabindex="-1"></a>d20 <span class="ot">&lt;-</span> <span class="fu">simulate_cafe</span>(<span class="at">visits =</span> <span class="dv">20</span>)</span>
<span id="cb848-849"><a href="#cb848-849" aria-hidden="true" tabindex="-1"></a>d50 <span class="ot">&lt;-</span> <span class="fu">simulate_cafe</span>(<span class="at">visits =</span> <span class="dv">50</span>)</span>
<span id="cb848-850"><a href="#cb848-850" aria-hidden="true" tabindex="-1"></a>d100 <span class="ot">&lt;-</span> <span class="fu">simulate_cafe</span>(<span class="at">visits =</span> <span class="dv">100</span>)</span>
<span id="cb848-851"><a href="#cb848-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-852"><a href="#cb848-852" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-853"><a href="#cb848-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-854"><a href="#cb848-854" aria-hidden="true" tabindex="-1"></a>I thought about being fancy and doing the comparisons of pooling and no pooling with some tidyverse style, but it's too much work, so I'm just going to hack into McElerath's code again.</span>
<span id="cb848-855"><a href="#cb848-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-856"><a href="#cb848-856" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MN3.3}</span></span>
<span id="cb848-857"><a href="#cb848-857" aria-hidden="true" tabindex="-1"></a>fit_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> d2){</span>
<span id="cb848-858"><a href="#cb848-858" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-859"><a href="#cb848-859" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>( </span>
<span id="cb848-860"><a href="#cb848-860" aria-hidden="true" tabindex="-1"></a>    wait <span class="sc">~</span> <span class="fu">normal</span>(mu, sigma),</span>
<span id="cb848-861"><a href="#cb848-861" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span>  a_cafe[cafe] <span class="sc">+</span> b_cafe[cafe]<span class="sc">*</span>afternoon,</span>
<span id="cb848-862"><a href="#cb848-862" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(a_cafe, b_cafe)[cafe] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(a,b), rho, sigma_cafe),</span>
<span id="cb848-863"><a href="#cb848-863" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">5</span>,<span class="dv">2</span>),</span>
<span id="cb848-864"><a href="#cb848-864" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb848-865"><a href="#cb848-865" aria-hidden="true" tabindex="-1"></a>    sigma_cafe <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb848-866"><a href="#cb848-866" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb848-867"><a href="#cb848-867" aria-hidden="true" tabindex="-1"></a>    rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>)),</span>
<span id="cb848-868"><a href="#cb848-868" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb848-869"><a href="#cb848-869" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb848-870"><a href="#cb848-870" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb848-871"><a href="#cb848-871" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb848-872"><a href="#cb848-872" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb848-873"><a href="#cb848-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-874"><a href="#cb848-874" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> data</span>
<span id="cb848-875"><a href="#cb848-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-876"><a href="#cb848-876" aria-hidden="true" tabindex="-1"></a><span class="co">#grabbbing the unpooled estimates from the data</span></span>
<span id="cb848-877"><a href="#cb848-877" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span> n_cafes, <span class="cf">function</span>(i) <span class="fu">mean</span>(dat<span class="sc">$</span>wait[dat<span class="sc">$</span>cafe <span class="sc">==</span> i <span class="sc">&amp;</span> dat<span class="sc">$</span>afternoon <span class="sc">==</span> <span class="dv">0</span>]))</span>
<span id="cb848-878"><a href="#cb848-878" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span> n_cafes, <span class="cf">function</span>(i) <span class="fu">mean</span>(dat<span class="sc">$</span>wait[dat<span class="sc">$</span>cafe <span class="sc">==</span> i <span class="sc">&amp;</span> dat<span class="sc">$</span>afternoon <span class="sc">==</span> <span class="dv">1</span>]))<span class="sc">-</span>a1</span>
<span id="cb848-879"><a href="#cb848-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-880"><a href="#cb848-880" aria-hidden="true" tabindex="-1"></a><span class="co"># extract posterior means of partially pooled estimates</span></span>
<span id="cb848-881"><a href="#cb848-881" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(fit)</span>
<span id="cb848-882"><a href="#cb848-882" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fu">apply</span>( post<span class="sc">$</span>a_cafe , <span class="dv">2</span> , mean )</span>
<span id="cb848-883"><a href="#cb848-883" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fu">apply</span>( post<span class="sc">$</span>b_cafe , <span class="dv">2</span> , mean )</span>
<span id="cb848-884"><a href="#cb848-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-885"><a href="#cb848-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-886"><a href="#cb848-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-887"><a href="#cb848-887" aria-hidden="true" tabindex="-1"></a><span class="co">#plot both and connect with lines</span></span>
<span id="cb848-888"><a href="#cb848-888" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a1, b1, <span class="at">xlab =</span> <span class="st">"intercept"</span>, <span class="at">ylab =</span> <span class="st">"slope"</span>, </span>
<span id="cb848-889"><a href="#cb848-889" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"blue"</span>,</span>
<span id="cb848-890"><a href="#cb848-890" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb848-891"><a href="#cb848-891" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span><span class="fu">c</span>(<span class="fu">min</span>(b1)<span class="sc">-</span> <span class="fl">0.1</span>, <span class="fu">max</span>(b1) <span class="sc">+</span> <span class="fl">0.1</span>), </span>
<span id="cb848-892"><a href="#cb848-892" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span><span class="fu">c</span>(<span class="fu">min</span>(a1)<span class="sc">-</span> <span class="fl">0.1</span>, <span class="fu">max</span>(a1) <span class="sc">+</span> <span class="fl">0.1</span>))</span>
<span id="cb848-893"><a href="#cb848-893" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(a2, b2, <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb848-894"><a href="#cb848-894" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_cafes) <span class="fu">lines</span>(<span class="fu">c</span>(a1[i],a2[i]) , <span class="fu">c</span>(b1[i],b2[i]))</span>
<span id="cb848-895"><a href="#cb848-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-896"><a href="#cb848-896" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(fit)</span>
<span id="cb848-897"><a href="#cb848-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-898"><a href="#cb848-898" aria-hidden="true" tabindex="-1"></a><span class="co">#compute posterior mean bivariate gaussian</span></span>
<span id="cb848-899"><a href="#cb848-899" aria-hidden="true" tabindex="-1"></a>Mu_est <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(post<span class="sc">$</span>a) , <span class="fu">mean</span>(post<span class="sc">$</span>b) )</span>
<span id="cb848-900"><a href="#cb848-900" aria-hidden="true" tabindex="-1"></a>rho_est <span class="ot">&lt;-</span> <span class="fu">mean</span>( post<span class="sc">$</span>rho[,<span class="dv">1</span>,<span class="dv">2</span>] )</span>
<span id="cb848-901"><a href="#cb848-901" aria-hidden="true" tabindex="-1"></a>sa_est <span class="ot">&lt;-</span> <span class="fu">mean</span>( post<span class="sc">$</span>sigma_cafe[,<span class="dv">1</span>] )</span>
<span id="cb848-902"><a href="#cb848-902" aria-hidden="true" tabindex="-1"></a>sb_est <span class="ot">&lt;-</span> <span class="fu">mean</span>( post<span class="sc">$</span>sigma_cafe[,<span class="dv">2</span>] )</span>
<span id="cb848-903"><a href="#cb848-903" aria-hidden="true" tabindex="-1"></a>cov_ab <span class="ot">&lt;-</span> sa_est<span class="sc">*</span>sb_est<span class="sc">*</span>rho_est</span>
<span id="cb848-904"><a href="#cb848-904" aria-hidden="true" tabindex="-1"></a>Sigma_est <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="fu">c</span>(sa_est<span class="sc">^</span><span class="dv">2</span>,cov_ab,cov_ab,sb_est<span class="sc">^</span><span class="dv">2</span>) , <span class="at">ncol=</span><span class="dv">2</span> )</span>
<span id="cb848-905"><a href="#cb848-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-906"><a href="#cb848-906" aria-hidden="true" tabindex="-1"></a><span class="co"># draw contours</span></span>
<span id="cb848-907"><a href="#cb848-907" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ellipse)</span>
<span id="cb848-908"><a href="#cb848-908" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( l <span class="cf">in</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">0.99</span>) )</span>
<span id="cb848-909"><a href="#cb848-909" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">ellipse</span>(Sigma_est,<span class="at">centre=</span>Mu_est,<span class="at">level=</span>l),</span>
<span id="cb848-910"><a href="#cb848-910" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">"black"</span>,<span class="fl">0.2</span>))</span>
<span id="cb848-911"><a href="#cb848-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-912"><a href="#cb848-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-913"><a href="#cb848-913" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb848-914"><a href="#cb848-914" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb848-915"><a href="#cb848-915" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-916"><a href="#cb848-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-917"><a href="#cb848-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-918"><a href="#cb848-918" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MN3.4, warning=FALSE}</span></span>
<span id="cb848-919"><a href="#cb848-919" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(d2)</span>
<span id="cb848-920"><a href="#cb848-920" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(d10)</span>
<span id="cb848-921"><a href="#cb848-921" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(d20)</span>
<span id="cb848-922"><a href="#cb848-922" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(d50)</span>
<span id="cb848-923"><a href="#cb848-923" aria-hidden="true" tabindex="-1"></a><span class="fu">fit_plot</span>(d100)</span>
<span id="cb848-924"><a href="#cb848-924" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-925"><a href="#cb848-925" aria-hidden="true" tabindex="-1"></a>Clearly, the larger the clusters are, the less pooling you get. Makes sense.</span>
<span id="cb848-926"><a href="#cb848-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-927"><a href="#cb848-927" aria-hidden="true" tabindex="-1"></a><span class="fu"># MN4: </span></span>
<span id="cb848-928"><a href="#cb848-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-929"><a href="#cb848-929" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb848-930"><a href="#cb848-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-931"><a href="#cb848-931" aria-hidden="true" tabindex="-1"></a><span class="fu">### a </span></span>
<span id="cb848-932"><a href="#cb848-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-933"><a href="#cb848-933" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;Fit a varying intercept &amp; slope model to the running data, using rethinking::ulam or rstanarm::stan_glmer (or both).Visualize the results and briefly compare to results from MN 2. </span></span>
<span id="cb848-934"><a href="#cb848-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-935"><a href="#cb848-935" aria-hidden="true" tabindex="-1"></a>Start by loading the data.</span>
<span id="cb848-936"><a href="#cb848-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-937"><a href="#cb848-937" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MN4A.1}</span></span>
<span id="cb848-938"><a href="#cb848-938" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb848-939"><a href="#cb848-939" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"cherry_blossom_sample"</span>)</span>
<span id="cb848-940"><a href="#cb848-940" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> cherry_blossom_sample <span class="sc">%&gt;%</span> </span>
<span id="cb848-941"><a href="#cb848-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_c =</span> age <span class="sc">-</span> <span class="dv">55</span>) </span>
<span id="cb848-942"><a href="#cb848-942" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb848-943"><a href="#cb848-943" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb848-944"><a href="#cb848-944" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-945"><a href="#cb848-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-946"><a href="#cb848-946" aria-hidden="true" tabindex="-1"></a>Fit the slopes model</span>
<span id="cb848-947"><a href="#cb848-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-948"><a href="#cb848-948" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MN4A.2, message=FALSE, warning=FALSE}</span></span>
<span id="cb848-949"><a href="#cb848-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-950"><a href="#cb848-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-951"><a href="#cb848-951" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> g <span class="sc">%&gt;%</span></span>
<span id="cb848-952"><a href="#cb848-952" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb848-953"><a href="#cb848-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-954"><a href="#cb848-954" aria-hidden="true" tabindex="-1"></a>m_runner_slopes <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-955"><a href="#cb848-955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-956"><a href="#cb848-956" aria-hidden="true" tabindex="-1"></a>    net <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb848-957"><a href="#cb848-957" aria-hidden="true" tabindex="-1"></a>    mu<span class="ot">&lt;-</span> a_runner[runner] <span class="sc">+</span> b_runner[runner]<span class="sc">*</span>age_c,</span>
<span id="cb848-958"><a href="#cb848-958" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(a_runner,b_runner)[runner] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(a,b), rho, sigma_runner),</span>
<span id="cb848-959"><a href="#cb848-959" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb848-960"><a href="#cb848-960" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb848-961"><a href="#cb848-961" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="fl">0.5</span>),</span>
<span id="cb848-962"><a href="#cb848-962" aria-hidden="true" tabindex="-1"></a>    sigma_runner <span class="sc">~</span> <span class="fu">exponential</span>(<span class="fl">0.5</span>),</span>
<span id="cb848-963"><a href="#cb848-963" aria-hidden="true" tabindex="-1"></a>    rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">1</span>) ),</span>
<span id="cb848-964"><a href="#cb848-964" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat ,</span>
<span id="cb848-965"><a href="#cb848-965" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span> ,</span>
<span id="cb848-966"><a href="#cb848-966" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span>, </span>
<span id="cb848-967"><a href="#cb848-967" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb848-968"><a href="#cb848-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-969"><a href="#cb848-969" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-970"><a href="#cb848-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-971"><a href="#cb848-971" aria-hidden="true" tabindex="-1"></a>This recapitulates what we did in MN2, but now with slopes. So I'm going to build on that code.</span>
<span id="cb848-972"><a href="#cb848-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-973"><a href="#cb848-973" aria-hidden="true" tabindex="-1"></a>First, let's just compare the outputs of both models.</span>
<span id="cb848-974"><a href="#cb848-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-975"><a href="#cb848-975" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MN4A.3}</span></span>
<span id="cb848-976"><a href="#cb848-976" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m_runner)</span>
<span id="cb848-977"><a href="#cb848-977" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m_runner_slopes)</span>
<span id="cb848-978"><a href="#cb848-978" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-979"><a href="#cb848-979" aria-hidden="true" tabindex="-1"></a>These estimates are fairly similar. I would have expected the posteriors of the beta and alpha estimates to be wider for the slopes model and the sigma estimates to be narrower, but this seem to not exactly be the case. Interesting...</span>
<span id="cb848-980"><a href="#cb848-980" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb848-981"><a href="#cb848-981" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MN4A.4}</span></span>
<span id="cb848-982"><a href="#cb848-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-983"><a href="#cb848-983" aria-hidden="true" tabindex="-1"></a>post_a <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_runner_slopes)<span class="sc">$</span>a_runner <span class="sc">%&gt;%</span>  <span class="co"># get the individuals interceps</span></span>
<span id="cb848-984"><a href="#cb848-984" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb848-985"><a href="#cb848-985" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"runner"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb848-986"><a href="#cb848-986" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(runner) <span class="sc">%&gt;%</span> </span>
<span id="cb848-987"><a href="#cb848-987" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">intercept =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb848-988"><a href="#cb848-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">runner =</span> <span class="fu">gsub</span>(<span class="st">"V"</span>, <span class="st">""</span>, runner) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb848-989"><a href="#cb848-989" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(runner)</span>
<span id="cb848-990"><a href="#cb848-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-991"><a href="#cb848-991" aria-hidden="true" tabindex="-1"></a>post_b <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_runner_slopes)<span class="sc">$</span>b_runner <span class="sc">%&gt;%</span>  <span class="co"># get the individual slopes</span></span>
<span id="cb848-992"><a href="#cb848-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb848-993"><a href="#cb848-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"runner"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb848-994"><a href="#cb848-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(runner) <span class="sc">%&gt;%</span> </span>
<span id="cb848-995"><a href="#cb848-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">slope =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb848-996"><a href="#cb848-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">runner =</span> <span class="fu">gsub</span>(<span class="st">"V"</span>, <span class="st">""</span>, runner) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb848-997"><a href="#cb848-997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(runner)</span>
<span id="cb848-998"><a href="#cb848-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-999"><a href="#cb848-999" aria-hidden="true" tabindex="-1"></a>dat_combined <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span>  <span class="co">#add the slopes and intercepts to the dataframe</span></span>
<span id="cb848-1000"><a href="#cb848-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post_a, <span class="at">by =</span> <span class="st">"runner"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1001"><a href="#cb848-1001" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post_b, <span class="at">by =</span> <span class="st">"runner"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1002"><a href="#cb848-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unpooled =</span> <span class="fu">mean</span>(net)) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1003"><a href="#cb848-1003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb848-1004"><a href="#cb848-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1005"><a href="#cb848-1005" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_c, <span class="at">y =</span> net)) <span class="sc">+</span></span>
<span id="cb848-1006"><a href="#cb848-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb848-1007"><a href="#cb848-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">90.70</span>, <span class="at">slope =</span>  <span class="fl">1.23</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb848-1008"><a href="#cb848-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb848-1009"><a href="#cb848-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1010"><a href="#cb848-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1011"><a href="#cb848-1011" aria-hidden="true" tabindex="-1"></a>dat_combined <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_c, <span class="at">y =</span> net)) <span class="sc">+</span> <span class="co"># again, fill in with numbers from m_sleep</span></span>
<span id="cb848-1012"><a href="#cb848-1012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb848-1013"><a href="#cb848-1013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="st">"runner"</span>) <span class="sc">+</span></span>
<span id="cb848-1014"><a href="#cb848-1014" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_abline(aes(intercept = unpooled, slope =  1.23), linetype = "dashed", color = "red")+</span></span>
<span id="cb848-1015"><a href="#cb848-1015" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span>  slope), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb848-1016"><a href="#cb848-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fl">90.70</span>, <span class="at">slope =</span>  <span class="fl">1.23</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb848-1017"><a href="#cb848-1017" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb848-1018"><a href="#cb848-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1019"><a href="#cb848-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1020"><a href="#cb848-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1021"><a href="#cb848-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1022"><a href="#cb848-1022" aria-hidden="true" tabindex="-1"></a>Unsurprisingly, the plots suggest that the slopes models are better at capturing individual variation. </span>
<span id="cb848-1023"><a href="#cb848-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1024"><a href="#cb848-1024" aria-hidden="true" tabindex="-1"></a><span class="fu">### b</span></span>
<span id="cb848-1025"><a href="#cb848-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1026"><a href="#cb848-1026" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Do the same for the sleepstudy data</span></span>
<span id="cb848-1027"><a href="#cb848-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1028"><a href="#cb848-1028" aria-hidden="true" tabindex="-1"></a>Once again, load the data and fit the model.</span>
<span id="cb848-1029"><a href="#cb848-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1030"><a href="#cb848-1030" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MNB.1, output = FALSE}</span></span>
<span id="cb848-1031"><a href="#cb848-1031" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> sleepstudy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Days<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Days_bl =</span> Days<span class="dv">-2</span>)</span>
<span id="cb848-1032"><a href="#cb848-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1033"><a href="#cb848-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1034"><a href="#cb848-1034" aria-hidden="true" tabindex="-1"></a>m_sleep_slopes <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb848-1035"><a href="#cb848-1035" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb848-1036"><a href="#cb848-1036" aria-hidden="true" tabindex="-1"></a>    Reaction <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb848-1037"><a href="#cb848-1037" aria-hidden="true" tabindex="-1"></a>    mu<span class="ot">&lt;-</span> a_subject[Subject] <span class="sc">+</span> b_subject[Subject]<span class="sc">*</span>Days_bl,</span>
<span id="cb848-1038"><a href="#cb848-1038" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(a_subject,b_subject)[Subject] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(a,b), rho, sigma_subject),</span>
<span id="cb848-1039"><a href="#cb848-1039" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">250</span>, <span class="dv">200</span>),</span>
<span id="cb848-1040"><a href="#cb848-1040" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb848-1041"><a href="#cb848-1041" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="fl">0.1</span>),</span>
<span id="cb848-1042"><a href="#cb848-1042" aria-hidden="true" tabindex="-1"></a>    sigma_subject <span class="sc">~</span> <span class="fu">exponential</span>(<span class="fl">0.1</span>),</span>
<span id="cb848-1043"><a href="#cb848-1043" aria-hidden="true" tabindex="-1"></a>    rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">1</span>) ),</span>
<span id="cb848-1044"><a href="#cb848-1044" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d ,</span>
<span id="cb848-1045"><a href="#cb848-1045" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span> ,</span>
<span id="cb848-1046"><a href="#cb848-1046" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span>, </span>
<span id="cb848-1047"><a href="#cb848-1047" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb848-1048"><a href="#cb848-1048" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1049"><a href="#cb848-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1050"><a href="#cb848-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1053"><a href="#cb848-1053" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb848-1054"><a href="#cb848-1054" aria-hidden="true" tabindex="-1"></a>post_intercept <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_sleep_slopes)<span class="sc">$</span>a_subject <span class="sc">%&gt;%</span> </span>
<span id="cb848-1055"><a href="#cb848-1055" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb848-1056"><a href="#cb848-1056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Subject"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1057"><a href="#cb848-1057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Subject) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1058"><a href="#cb848-1058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">intercept =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1059"><a href="#cb848-1059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject =</span> <span class="fu">gsub</span>(<span class="st">"V"</span>, <span class="st">""</span>, Subject) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1060"><a href="#cb848-1060" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Subject)</span>
<span id="cb848-1061"><a href="#cb848-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1062"><a href="#cb848-1062" aria-hidden="true" tabindex="-1"></a>post_slopes <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m_sleep_slopes)<span class="sc">$</span>b_subject <span class="sc">%&gt;%</span> </span>
<span id="cb848-1063"><a href="#cb848-1063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb848-1064"><a href="#cb848-1064" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Subject"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1065"><a href="#cb848-1065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Subject) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1066"><a href="#cb848-1066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">slope =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1067"><a href="#cb848-1067" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject =</span> <span class="fu">gsub</span>(<span class="st">"V"</span>, <span class="st">""</span>, Subject) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1068"><a href="#cb848-1068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Subject)</span>
<span id="cb848-1069"><a href="#cb848-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1070"><a href="#cb848-1070" aria-hidden="true" tabindex="-1"></a>d_combined <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="co"># add each person's intercept, useful for making the figure</span></span>
<span id="cb848-1071"><a href="#cb848-1071" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(Subject))) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1072"><a href="#cb848-1072" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post_intercept, <span class="at">by =</span> <span class="st">"Subject"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb848-1073"><a href="#cb848-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post_slopes, <span class="at">by =</span> <span class="st">"Subject"</span>) </span>
<span id="cb848-1074"><a href="#cb848-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1075"><a href="#cb848-1075" aria-hidden="true" tabindex="-1"></a>d_combined <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Days_bl, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb848-1076"><a href="#cb848-1076" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb848-1077"><a href="#cb848-1077" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">267.72</span>, <span class="at">slope =</span>  <span class="fl">11.47</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> <span class="co"># fill in with numbers from m_sleep</span></span>
<span id="cb848-1078"><a href="#cb848-1078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb848-1079"><a href="#cb848-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1080"><a href="#cb848-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1081"><a href="#cb848-1081" aria-hidden="true" tabindex="-1"></a>d_combined <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Days_bl, <span class="at">y =</span> Reaction)) <span class="sc">+</span> <span class="co"># again, fill in with numbers from m_sleep</span></span>
<span id="cb848-1082"><a href="#cb848-1082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb848-1083"><a href="#cb848-1083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="st">"Subject"</span>) <span class="sc">+</span></span>
<span id="cb848-1084"><a href="#cb848-1084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span>  slope), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb848-1085"><a href="#cb848-1085" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fl">267.72</span>, <span class="at">slope =</span>  <span class="fl">11.47</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb848-1086"><a href="#cb848-1086" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb848-1087"><a href="#cb848-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1088"><a href="#cb848-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1089"><a href="#cb848-1089" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1092"><a href="#cb848-1092" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb848-1093"><a href="#cb848-1093" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m_sleep)</span>
<span id="cb848-1094"><a href="#cb848-1094" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m_sleep_slopes)</span>
<span id="cb848-1095"><a href="#cb848-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1096"><a href="#cb848-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1097"><a href="#cb848-1097" aria-hidden="true" tabindex="-1"></a>Again, the precision of the estimates is better for the slopes model, especially for the sigmas, and the individual-level data shows that the indidivual estimates are better too.</span>
<span id="cb848-1098"><a href="#cb848-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1099"><a href="#cb848-1099" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb848-1100"><a href="#cb848-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1101"><a href="#cb848-1101" aria-hidden="true" tabindex="-1"></a><span class="fu"># STV</span></span>
<span id="cb848-1102"><a href="#cb848-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1103"><a href="#cb848-1103" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;Import data used in STV and run the four models discussed in the paper using Rstan (see Stan code in the paper). Run the same models using rstanarm::stan_glmer. Discuss any differences between results from the two programs? </span></span>
<span id="cb848-1104"><a href="#cb848-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1105"><a href="#cb848-1105" aria-hidden="true" tabindex="-1"></a>Maybe this is cheating (if it is, I'll happily do a *"completering"*) but for the STV models, I've basically copy-pasted what they did. I had a look in the stan-files, but I can't really pretend that I understand them. </span>
<span id="cb848-1106"><a href="#cb848-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1107"><a href="#cb848-1107" aria-hidden="true" tabindex="-1"></a>::: {tabset}</span>
<span id="cb848-1108"><a href="#cb848-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1109"><a href="#cb848-1109" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setup</span></span>
<span id="cb848-1110"><a href="#cb848-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1111"><a href="#cb848-1111" aria-hidden="true" tabindex="-1"></a>The following code is taken directly from Shtrivasan et al.</span>
<span id="cb848-1112"><a href="#cb848-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1113"><a href="#cb848-1113" aria-hidden="true" tabindex="-1"></a>First, I read in the Gibson and Wu data and subset head noun:</span>
<span id="cb848-1114"><a href="#cb848-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1115"><a href="#cb848-1115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loadgibsonwudata}</span></span>
<span id="cb848-1116"><a href="#cb848-1116" aria-hidden="true" tabindex="-1"></a>rDat<span class="ot">&lt;-</span><span class="fu">read.table</span>(<span class="st">"data/gibsonwu2012data.txt"</span>,<span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb848-1117"><a href="#cb848-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1118"><a href="#cb848-1118" aria-hidden="true" tabindex="-1"></a>rDat<span class="ot">&lt;-</span><span class="fu">subset</span>(rDat,region<span class="sc">==</span><span class="st">"headnoun"</span>)</span>
<span id="cb848-1119"><a href="#cb848-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1120"><a href="#cb848-1120" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert subject and item to factors:</span></span>
<span id="cb848-1121"><a href="#cb848-1121" aria-hidden="true" tabindex="-1"></a>rDat<span class="sc">$</span>region<span class="ot">&lt;-</span><span class="fu">factor</span>(rDat<span class="sc">$</span>region)</span>
<span id="cb848-1122"><a href="#cb848-1122" aria-hidden="true" tabindex="-1"></a>rDat<span class="sc">$</span>subj <span class="ot">&lt;-</span> <span class="fu">factor</span>(rDat<span class="sc">$</span>subj)</span>
<span id="cb848-1123"><a href="#cb848-1123" aria-hidden="true" tabindex="-1"></a>rDat<span class="sc">$</span>item <span class="ot">&lt;-</span> <span class="fu">factor</span>(rDat<span class="sc">$</span>item)</span>
<span id="cb848-1124"><a href="#cb848-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1125"><a href="#cb848-1125" aria-hidden="true" tabindex="-1"></a><span class="co"># Contrast coding</span></span>
<span id="cb848-1126"><a href="#cb848-1126" aria-hidden="true" tabindex="-1"></a>rDat<span class="sc">$</span>so <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(rDat<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"subj-ext"</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb848-1127"><a href="#cb848-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1128"><a href="#cb848-1128" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up data for Stan:</span></span>
<span id="cb848-1129"><a href="#cb848-1129" aria-hidden="true" tabindex="-1"></a>stanDat<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">rt =</span> rDat<span class="sc">$</span>rt,</span>
<span id="cb848-1130"><a href="#cb848-1130" aria-hidden="true" tabindex="-1"></a>              <span class="at">so =</span> rDat<span class="sc">$</span>so,</span>
<span id="cb848-1131"><a href="#cb848-1131" aria-hidden="true" tabindex="-1"></a>              <span class="at">N =</span> <span class="fu">nrow</span>(rDat))</span>
<span id="cb848-1132"><a href="#cb848-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1133"><a href="#cb848-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1134"><a href="#cb848-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1135"><a href="#cb848-1135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1136"><a href="#cb848-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1137"><a href="#cb848-1137" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model 1: Fixed effects only</span></span>
<span id="cb848-1138"><a href="#cb848-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1139"><a href="#cb848-1139" aria-hidden="true" tabindex="-1"></a>Now we start getting the model. Their first model is just a fixed effects model. Writing it out in McElreath's style o notation, it might look something like this:</span>
<span id="cb848-1140"><a href="#cb848-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1141"><a href="#cb848-1141" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1142"><a href="#cb848-1142" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb848-1143"><a href="#cb848-1143" aria-hidden="true" tabindex="-1"></a>\text{Log(RT)}_{i} &amp; \sim \mathrm{Normal}(\mu, \sigma) <span class="sc">\\</span></span>
<span id="cb848-1144"><a href="#cb848-1144" aria-hidden="true" tabindex="-1"></a>\mu_i &amp; = b_0 + b_{SO}\text{SO}_i<span class="sc">\\</span></span>
<span id="cb848-1145"><a href="#cb848-1145" aria-hidden="true" tabindex="-1"></a>b_0 &amp; \sim \mathrm{Uniform}(-\infty, \infty)<span class="sc">\\</span></span>
<span id="cb848-1146"><a href="#cb848-1146" aria-hidden="true" tabindex="-1"></a>b_1 &amp; \sim \mathrm{Uniform}(-\infty,\infty)<span class="sc">\\</span></span>
<span id="cb848-1147"><a href="#cb848-1147" aria-hidden="true" tabindex="-1"></a>\sigma_i &amp;\sim \mathrm{Uniform}(0,\infty)<span class="sc">\\</span></span>
<span id="cb848-1148"><a href="#cb848-1148" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb848-1149"><a href="#cb848-1149" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1150"><a href="#cb848-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1151"><a href="#cb848-1151" aria-hidden="true" tabindex="-1"></a>I'm basing these priors on what Sorensen et al. write:</span>
<span id="cb848-1152"><a href="#cb848-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1153"><a href="#cb848-1153" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The prior distributions on the parameters beta and sigma e would ordinarily be declared in the model block. If we don’t declare any prior, it is assumed that they have a uniform prior distribution.</span></span>
<span id="cb848-1154"><a href="#cb848-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1155"><a href="#cb848-1155" aria-hidden="true" tabindex="-1"></a>I suppose part of this exercise is comparing the stan default priors against the stanarm default priors, so I'm not going to do much to those either. </span>
<span id="cb848-1156"><a href="#cb848-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1157"><a href="#cb848-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1158"><a href="#cb848-1158" aria-hidden="true" tabindex="-1"></a>With all that said, I'll run the data pure stan style, using Sorensen's code</span>
<span id="cb848-1159"><a href="#cb848-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1160"><a href="#cb848-1160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning=FALSE, output=FALSE}</span></span>
<span id="cb848-1161"><a href="#cb848-1161" aria-hidden="true" tabindex="-1"></a>fixEf_stan <span class="ot">&lt;-</span> <span class="fu">stan</span>(<span class="at">file =</span> <span class="st">"fixEf.stan"</span>, </span>
<span id="cb848-1162"><a href="#cb848-1162" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> stanDat, </span>
<span id="cb848-1163"><a href="#cb848-1163" aria-hidden="true" tabindex="-1"></a>                 <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>)</span>
<span id="cb848-1164"><a href="#cb848-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1165"><a href="#cb848-1165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1166"><a href="#cb848-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1167"><a href="#cb848-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1168"><a href="#cb848-1168" aria-hidden="true" tabindex="-1"></a>Now to run the same model in stanarm.</span>
<span id="cb848-1169"><a href="#cb848-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1170"><a href="#cb848-1170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb848-1171"><a href="#cb848-1171" aria-hidden="true" tabindex="-1"></a>fixEf_arm <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(<span class="fu">log</span>(rt) <span class="sc">~</span> so, <span class="at">data =</span> rDat, <span class="at">chains =</span> <span class="dv">4</span>)</span>
<span id="cb848-1172"><a href="#cb848-1172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1173"><a href="#cb848-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1174"><a href="#cb848-1174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summarizeresultsmodel1}</span></span>
<span id="cb848-1175"><a href="#cb848-1175" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fixEf_stan, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"beta"</span>,<span class="st">"sigma_e"</span>), <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span>
<span id="cb848-1176"><a href="#cb848-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1177"><a href="#cb848-1177" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(fixEf_arm) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb848-1178"><a href="#cb848-1178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1179"><a href="#cb848-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1180"><a href="#cb848-1180" aria-hidden="true" tabindex="-1"></a>It seems like for the fixed effects only model, the stan and stanarm produce identical results. This, of course, is a bad model. Let's see how the packages do with more advanced models. </span>
<span id="cb848-1181"><a href="#cb848-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1182"><a href="#cb848-1182" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model 2, random intercepts for subjects:</span></span>
<span id="cb848-1183"><a href="#cb848-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1184"><a href="#cb848-1184" aria-hidden="true" tabindex="-1"></a>Okay, here is my take on Sorenson et al's model 2, written out in McElreath style. Again, it's crazy to see these uniform priors going to infinity-</span>
<span id="cb848-1185"><a href="#cb848-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1186"><a href="#cb848-1186" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1187"><a href="#cb848-1187" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb848-1188"><a href="#cb848-1188" aria-hidden="true" tabindex="-1"></a>\text{Log(RT)}_i &amp;\sim \mathrm{Normal}(\mu_i, \sigma_i)<span class="sc">\\</span></span>
<span id="cb848-1189"><a href="#cb848-1189" aria-hidden="true" tabindex="-1"></a>\mu &amp;= \alpha + \alpha_{\text{Subjec<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}}+\alpha_{\text{Item<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}} + \beta_{so}\times\text{SO}<span class="sc">\\</span></span>
<span id="cb848-1190"><a href="#cb848-1190" aria-hidden="true" tabindex="-1"></a>\alpha &amp; \sim \mathrm{Uniform(-\infty, \infty)}<span class="sc">\\</span> </span>
<span id="cb848-1191"><a href="#cb848-1191" aria-hidden="true" tabindex="-1"></a>\alpha_{\text{Subject}} &amp;\sim \mathrm{Normal}(0, \sigma_{\text{Subject}}) <span class="sc">\\</span></span>
<span id="cb848-1192"><a href="#cb848-1192" aria-hidden="true" tabindex="-1"></a>\alpha_{\text{Item}} &amp;\sim \mathrm{Normal}(0, \sigma_{\text{Item}}) <span class="sc">\\</span></span>
<span id="cb848-1193"><a href="#cb848-1193" aria-hidden="true" tabindex="-1"></a>\sigma_{\text{Subject}}&amp;\sim \mathrm{Uniform}(0, \infty)<span class="sc">\\</span></span>
<span id="cb848-1194"><a href="#cb848-1194" aria-hidden="true" tabindex="-1"></a>\sigma_{\text{item}}&amp;\sim \mathrm{Uniform}(0, \infty)<span class="sc">\\</span></span>
<span id="cb848-1195"><a href="#cb848-1195" aria-hidden="true" tabindex="-1"></a>\beta &amp; \sim \mathrm{Uniform(-\infty, \infty)}<span class="sc">\\</span> </span>
<span id="cb848-1196"><a href="#cb848-1196" aria-hidden="true" tabindex="-1"></a>\sigma &amp;\sim \mathrm{Uniform}(0, \infty)</span>
<span id="cb848-1197"><a href="#cb848-1197" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb848-1198"><a href="#cb848-1198" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1199"><a href="#cb848-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1200"><a href="#cb848-1200" aria-hidden="true" tabindex="-1"></a>Now I run that model, using Sorensen et al's code.</span>
<span id="cb848-1201"><a href="#cb848-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1202"><a href="#cb848-1202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setupdatadatamodel2}</span></span>
<span id="cb848-1203"><a href="#cb848-1203" aria-hidden="true" tabindex="-1"></a>stanDat<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">subj =</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(rDat<span class="sc">$</span>subj)),</span>
<span id="cb848-1204"><a href="#cb848-1204" aria-hidden="true" tabindex="-1"></a>              <span class="at">item =</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(rDat<span class="sc">$</span>item)),</span>
<span id="cb848-1205"><a href="#cb848-1205" aria-hidden="true" tabindex="-1"></a>              <span class="at">rt =</span> rDat<span class="sc">$</span>rt,</span>
<span id="cb848-1206"><a href="#cb848-1206" aria-hidden="true" tabindex="-1"></a>              <span class="at">so =</span> rDat<span class="sc">$</span>so,</span>
<span id="cb848-1207"><a href="#cb848-1207" aria-hidden="true" tabindex="-1"></a>              <span class="at">N =</span> <span class="fu">nrow</span>(rDat),</span>
<span id="cb848-1208"><a href="#cb848-1208" aria-hidden="true" tabindex="-1"></a>              <span class="at">J =</span> <span class="fu">length</span>(<span class="fu">unique</span>(rDat<span class="sc">$</span>subj)),</span>
<span id="cb848-1209"><a href="#cb848-1209" aria-hidden="true" tabindex="-1"></a>              <span class="at">K =</span> <span class="fu">length</span>(<span class="fu">unique</span>(rDat<span class="sc">$</span>item)))</span>
<span id="cb848-1210"><a href="#cb848-1210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1211"><a href="#cb848-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1212"><a href="#cb848-1212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r compileandfitmodel, output=FALSE}</span></span>
<span id="cb848-1213"><a href="#cb848-1213" aria-hidden="true" tabindex="-1"></a>ranInt_stan <span class="ot">&lt;-</span> <span class="fu">stan</span>(<span class="at">file =</span> <span class="st">"ranInt.stan"</span>, <span class="at">data =</span> stanDat, </span>
<span id="cb848-1214"><a href="#cb848-1214" aria-hidden="true" tabindex="-1"></a>                  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>)</span>
<span id="cb848-1215"><a href="#cb848-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1216"><a href="#cb848-1216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1217"><a href="#cb848-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1218"><a href="#cb848-1218" aria-hidden="true" tabindex="-1"></a>And now we do the same thing, but in stanarm. Again, i used <span class="in">`prior_summary()`</span> to learn my default prior. I think you can quibble with the exponential priors for the sigmas, but overalll, these default priors actually seem pretty sensible to me.</span>
<span id="cb848-1219"><a href="#cb848-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1220"><a href="#cb848-1220" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1221"><a href="#cb848-1221" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb848-1222"><a href="#cb848-1222" aria-hidden="true" tabindex="-1"></a>\text{Log(RT)}_i &amp;\sim \mathrm{Normal}(\mu_i, \sigma_i)<span class="sc">\\</span></span>
<span id="cb848-1223"><a href="#cb848-1223" aria-hidden="true" tabindex="-1"></a>\mu &amp;= \alpha + \alpha_{\text{Subjec<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}}+\alpha_{\text{Item<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}} + \beta_{so}\text{SO}<span class="sc">\\</span></span>
<span id="cb848-1224"><a href="#cb848-1224" aria-hidden="true" tabindex="-1"></a>\alpha &amp; \sim \mathrm{Normal(6.1, 1.5)}<span class="sc">\\</span> </span>
<span id="cb848-1225"><a href="#cb848-1225" aria-hidden="true" tabindex="-1"></a>\alpha_{\text{Subject}} &amp;\sim \mathrm{Normal}(0, \sigma_{\text{Subject}}) <span class="sc">\\</span></span>
<span id="cb848-1226"><a href="#cb848-1226" aria-hidden="true" tabindex="-1"></a>\alpha_{\text{Item}} &amp;\sim \mathrm{Normal}(0, \sigma_{\text{Item}}) <span class="sc">\\</span></span>
<span id="cb848-1227"><a href="#cb848-1227" aria-hidden="true" tabindex="-1"></a>\sigma_{\text{Subject}}&amp;\sim \mathrm{Exponential}(1.7)<span class="sc">\\</span></span>
<span id="cb848-1228"><a href="#cb848-1228" aria-hidden="true" tabindex="-1"></a>\sigma_{\text{item}}&amp;\sim \mathrm{Exponential}(1.7)<span class="sc">\\</span></span>
<span id="cb848-1229"><a href="#cb848-1229" aria-hidden="true" tabindex="-1"></a>\beta_{so} &amp; \sim \mathrm{Normal(0, 1.5)}<span class="sc">\\</span> </span>
<span id="cb848-1230"><a href="#cb848-1230" aria-hidden="true" tabindex="-1"></a>\sigma &amp;\sim \mathrm{Exponential}(1.7)</span>
<span id="cb848-1231"><a href="#cb848-1231" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb848-1232"><a href="#cb848-1232" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1233"><a href="#cb848-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1234"><a href="#cb848-1234" aria-hidden="true" tabindex="-1"></a>The code for running the model is also much easier to write!</span>
<span id="cb848-1235"><a href="#cb848-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1236"><a href="#cb848-1236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb848-1237"><a href="#cb848-1237" aria-hidden="true" tabindex="-1"></a>ranINT_arm <span class="ot">&lt;-</span> <span class="fu">stan_lmer</span>(<span class="fu">log</span>(rt) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span>  (<span class="dv">1</span><span class="sc">|</span>subj) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>item) <span class="sc">+</span> so, <span class="at">data =</span> rDat, <span class="at">chains =</span> <span class="dv">4</span>)</span>
<span id="cb848-1238"><a href="#cb848-1238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1239"><a href="#cb848-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1240"><a href="#cb848-1240" aria-hidden="true" tabindex="-1"></a>And if we look at the outputs of the two models side by side, what does it look like?</span>
<span id="cb848-1241"><a href="#cb848-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1244"><a href="#cb848-1244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb848-1245"><a href="#cb848-1245" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ranInt_stan, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"beta"</span>, <span class="st">"sigma_e"</span>, <span class="st">"sigma_u"</span>, <span class="st">"sigma_w"</span>),</span>
<span id="cb848-1246"><a href="#cb848-1246" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span>
<span id="cb848-1247"><a href="#cb848-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1248"><a href="#cb848-1248" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ranINT_arm, </span>
<span id="cb848-1249"><a href="#cb848-1249" aria-hidden="true" tabindex="-1"></a>      <span class="at">pars =</span><span class="fu">c</span>(<span class="st">"(Intercept)"</span>,<span class="st">"so"</span>, <span class="st">"sigma"</span>, <span class="st">"Sigma[subj:(Intercept),(Intercept)]"</span>, <span class="st">"Sigma[item:(Intercept),(Intercept)]"</span> ), </span>
<span id="cb848-1250"><a href="#cb848-1250" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>), </span>
<span id="cb848-1251"><a href="#cb848-1251" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb848-1252"><a href="#cb848-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1253"><a href="#cb848-1253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1254"><a href="#cb848-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1255"><a href="#cb848-1255" aria-hidden="true" tabindex="-1"></a>Well, despite the differences, the estimates seem quite similar to me. The main thing I notice is that the  \sigma  estimates are higher in the stan model, unsurprising given the priors &amp; it seems like setting some sensible priors would be an easy fix. </span>
<span id="cb848-1256"><a href="#cb848-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1257"><a href="#cb848-1257" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model 3: Varying intercepts &amp; varying slopes, no covariation</span></span>
<span id="cb848-1258"><a href="#cb848-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1259"><a href="#cb848-1259" aria-hidden="true" tabindex="-1"></a>Okay, now we have this half-way thing. They actually don't mention it in their paper, or at least the version that I have, but digging into their markdown file, I was able to get a hold of their code. This is the code they use:</span>
<span id="cb848-1260"><a href="#cb848-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1261"><a href="#cb848-1261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb848-1262"><a href="#cb848-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1263"><a href="#cb848-1263" aria-hidden="true" tabindex="-1"></a>ranIntSlpNoCorFit <span class="ot">&lt;-</span> <span class="fu">stan</span>(<span class="at">file =</span> <span class="st">"ranIntSlpNoCor.stan"</span>, <span class="at">data =</span> stanDat, </span>
<span id="cb848-1264"><a href="#cb848-1264" aria-hidden="true" tabindex="-1"></a>                     <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>)</span>
<span id="cb848-1265"><a href="#cb848-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1266"><a href="#cb848-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1267"><a href="#cb848-1267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1268"><a href="#cb848-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1269"><a href="#cb848-1269" aria-hidden="true" tabindex="-1"></a>Again, if we write that using McElreath's style of notation, it might look something like this. Because this model isn't in the version of the paper, I'm not 100% sure about the priors, but this is my buest guess. Also, something nice about McElreath's notation is that makes it clear that a varying slopes model like this is just a special case of an interaction, but with hyperpriors on the slopes. Nice. </span>
<span id="cb848-1270"><a href="#cb848-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1271"><a href="#cb848-1271" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1272"><a href="#cb848-1272" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb848-1273"><a href="#cb848-1273" aria-hidden="true" tabindex="-1"></a>\text{Log(RT)}_i &amp;\sim \mathrm{Normal}(\mu_i, \sigma_i)<span class="sc">\\</span></span>
<span id="cb848-1274"><a href="#cb848-1274" aria-hidden="true" tabindex="-1"></a>\mu &amp;= \alpha + \alpha_{\text{Subjec<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}}+\alpha_{\text{Item<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}} + \beta_{so}\times\text{SO} + \beta_{\text{Item<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}}\times\text{SO} + \beta_{\text{Subject<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}}\times\text{SO}<span class="sc">\\</span></span>
<span id="cb848-1275"><a href="#cb848-1275" aria-hidden="true" tabindex="-1"></a>\alpha_{\text{Subject}} &amp;\sim \mathrm{Normal}(0, \sigma_{\alpha<span class="co">[</span><span class="ot">\text{Subject}</span><span class="co">]</span>}) <span class="sc">\\</span></span>
<span id="cb848-1276"><a href="#cb848-1276" aria-hidden="true" tabindex="-1"></a>\alpha_{\text{Item}} &amp;\sim \mathrm{Normal}(0, \sigma_{\alpha<span class="co">[</span><span class="ot">\text{Item}</span><span class="co">]</span>}) <span class="sc">\\</span></span>
<span id="cb848-1277"><a href="#cb848-1277" aria-hidden="true" tabindex="-1"></a>\sigma_{\text{Subject}}&amp;\sim \mathrm{Uniform}(0, \infty)<span class="sc">\\</span></span>
<span id="cb848-1278"><a href="#cb848-1278" aria-hidden="true" tabindex="-1"></a>\beta_{so} &amp; \sim \mathrm{Uniform(-\infty, \infty)}<span class="sc">\\</span> </span>
<span id="cb848-1279"><a href="#cb848-1279" aria-hidden="true" tabindex="-1"></a>\beta_{\text{Subject}} &amp;\sim \mathrm{Normal}(0, \sigma_{\beta<span class="co">[</span><span class="ot">\text{Subject}</span><span class="co">]</span>}) <span class="sc">\\</span></span>
<span id="cb848-1280"><a href="#cb848-1280" aria-hidden="true" tabindex="-1"></a>\beta_{\text{Item}} &amp;\sim \mathrm{Normal}(0, \sigma_{\beta<span class="co">[</span><span class="ot">\text{Item}</span><span class="co">]</span>}) <span class="sc">\\</span></span>
<span id="cb848-1281"><a href="#cb848-1281" aria-hidden="true" tabindex="-1"></a>\sigma,\sigma_{\alpha<span class="co">[</span><span class="ot">\text{Subject}[</span><span class="co">]</span>}, \sigma_{\alpha<span class="co">[</span><span class="ot">\text{Item}[</span><span class="co">]</span>}, \sigma_{\beta<span class="co">[</span><span class="ot">\text{Subject}[</span><span class="co">]</span>}, \sigma_{\beta<span class="co">[</span><span class="ot">\text{Item}[</span><span class="co">]</span>}  &amp;\sim \mathrm{Uniform}(0, \infty)</span>
<span id="cb848-1282"><a href="#cb848-1282" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb848-1283"><a href="#cb848-1283" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1284"><a href="#cb848-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1285"><a href="#cb848-1285" aria-hidden="true" tabindex="-1"></a>As for stanarm... I'm not entirely sure how to even write a model like that. The following solution is the closest I can come up with. I *think* it works, because so only has two levels. So, in practice, what I'm doing is calculating unique intercepts for each combination of subject and so. Well, I feel very uncertain that this is actually doing the same thing as Sorensen et al, but this illustrates that stanarm isn't well set up to do this wrong thing. I suppose that's good!</span>
<span id="cb848-1286"><a href="#cb848-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1287"><a href="#cb848-1287" aria-hidden="true" tabindex="-1"></a>Anyway, this is how I would write it out using McElreath style notation.</span>
<span id="cb848-1288"><a href="#cb848-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1289"><a href="#cb848-1289" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1290"><a href="#cb848-1290" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb848-1291"><a href="#cb848-1291" aria-hidden="true" tabindex="-1"></a>\text{Log(RT)}_i &amp;\sim \mathrm{Normal}(\mu_i, \sigma_i)<span class="sc">\\</span></span>
<span id="cb848-1292"><a href="#cb848-1292" aria-hidden="true" tabindex="-1"></a>\mu &amp;= \alpha + \alpha_{\text{Subject:so<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}}+\alpha_{\text{Item:so<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}} + \beta_{so}\text{SO}<span class="sc">\\</span></span>
<span id="cb848-1293"><a href="#cb848-1293" aria-hidden="true" tabindex="-1"></a>\alpha &amp; \sim \mathrm{Normal(6.1, 1.5)}<span class="sc">\\</span> </span>
<span id="cb848-1294"><a href="#cb848-1294" aria-hidden="true" tabindex="-1"></a>\alpha_{\text{Subject}} &amp;\sim \mathrm{Normal}(0, \sigma_{\text{Subject}}) <span class="sc">\\</span></span>
<span id="cb848-1295"><a href="#cb848-1295" aria-hidden="true" tabindex="-1"></a>\alpha_{\text{Item}} &amp;\sim \mathrm{Normal}(0, \sigma_{\text{Item}}) <span class="sc">\\</span></span>
<span id="cb848-1296"><a href="#cb848-1296" aria-hidden="true" tabindex="-1"></a>\sigma_{\text{Subject:so}}&amp;\sim \mathrm{Exponential}(1.7)<span class="sc">\\</span></span>
<span id="cb848-1297"><a href="#cb848-1297" aria-hidden="true" tabindex="-1"></a>\sigma_{\text{item:so}}&amp;\sim \mathrm{Exponential}(1.7)<span class="sc">\\</span></span>
<span id="cb848-1298"><a href="#cb848-1298" aria-hidden="true" tabindex="-1"></a>\beta_{so} &amp; \sim \mathrm{Normal(0, 1.5)}<span class="sc">\\</span> </span>
<span id="cb848-1299"><a href="#cb848-1299" aria-hidden="true" tabindex="-1"></a>\sigma &amp;\sim \mathrm{Exponential}(1.7)</span>
<span id="cb848-1300"><a href="#cb848-1300" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb848-1301"><a href="#cb848-1301" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1302"><a href="#cb848-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1303"><a href="#cb848-1303" aria-hidden="true" tabindex="-1"></a>And this is in r code. </span>
<span id="cb848-1304"><a href="#cb848-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1305"><a href="#cb848-1305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r output=FALSE}</span></span>
<span id="cb848-1306"><a href="#cb848-1306" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> rDat <span class="sc">%&gt;%</span> </span>
<span id="cb848-1307"><a href="#cb848-1307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">so =</span> <span class="fu">as.factor</span>(so))</span>
<span id="cb848-1308"><a href="#cb848-1308" aria-hidden="true" tabindex="-1"></a>ranINT_nocor_arm <span class="ot">&lt;-</span> <span class="fu">stan_lmer</span>(<span class="fu">log</span>(rt) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span>  (<span class="dv">1</span><span class="sc">|</span>subj<span class="sc">:</span>so) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>item<span class="sc">:</span>so) <span class="sc">+</span> so, <span class="at">data =</span> tmp, <span class="at">chains =</span> <span class="dv">4</span>)</span>
<span id="cb848-1309"><a href="#cb848-1309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1310"><a href="#cb848-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1311"><a href="#cb848-1311" aria-hidden="true" tabindex="-1"></a>Well, the model certainly runs at least. Let's look at the summary outputs.</span>
<span id="cb848-1312"><a href="#cb848-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1315"><a href="#cb848-1315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb848-1316"><a href="#cb848-1316" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ranIntSlpNoCorFit, </span>
<span id="cb848-1317"><a href="#cb848-1317" aria-hidden="true" tabindex="-1"></a>      <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"beta"</span>, <span class="st">"sigma_e"</span>, <span class="st">"sigma_u"</span>, <span class="st">"sigma_w"</span>),</span>
<span id="cb848-1318"><a href="#cb848-1318" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span>
<span id="cb848-1319"><a href="#cb848-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1320"><a href="#cb848-1320" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">summary</span>(ranINT_nocor_arm, </span>
<span id="cb848-1321"><a href="#cb848-1321" aria-hidden="true" tabindex="-1"></a>      <span class="at">pars =</span><span class="fu">c</span>(<span class="st">"(Intercept)"</span>,<span class="st">"so1"</span>, <span class="st">"sigma"</span>, <span class="st">"Sigma[subj:so:(Intercept),(Intercept)]"</span>, <span class="st">"Sigma[item:so:(Intercept),(Intercept)]"</span> ), </span>
<span id="cb848-1322"><a href="#cb848-1322" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>), </span>
<span id="cb848-1323"><a href="#cb848-1323" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb848-1324"><a href="#cb848-1324" aria-hidden="true" tabindex="-1"></a>      )[,],<span class="dv">2</span>)</span>
<span id="cb848-1325"><a href="#cb848-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1326"><a href="#cb848-1326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1327"><a href="#cb848-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1328"><a href="#cb848-1328" aria-hidden="true" tabindex="-1"></a>Interestingly, the effect of so is stronger in the stanarm model. Also an effect of the priors or something else? Could also be that I didn't quite manage to specify the same models.</span>
<span id="cb848-1329"><a href="#cb848-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1330"><a href="#cb848-1330" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model 4: Covarying slopese and intercepts</span></span>
<span id="cb848-1331"><a href="#cb848-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1332"><a href="#cb848-1332" aria-hidden="true" tabindex="-1"></a>Now this is the main model, of course. This one has both varying intercepts and varying slopes and they covary. I've set myself up for a challenge, writing all these out in McElreath code, but here goes.</span>
<span id="cb848-1333"><a href="#cb848-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1334"><a href="#cb848-1334" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1335"><a href="#cb848-1335" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb848-1336"><a href="#cb848-1336" aria-hidden="true" tabindex="-1"></a>\text{Log(RT)}_i &amp;\sim \mathrm{Normal}(\mu_i, \sigma_i)<span class="sc">\\</span></span>
<span id="cb848-1337"><a href="#cb848-1337" aria-hidden="true" tabindex="-1"></a>\mu &amp;= \alpha_i + \alpha_{\text{Subjec<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}}+\alpha_{\text{Item<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}} + \beta_{so,i}\times\text{SO} + \beta_{\text{Item<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}}\times\text{SO} + \beta_{\text{Subject<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}}\times\text{SO}<span class="sc">\\</span></span>
<span id="cb848-1338"><a href="#cb848-1338" aria-hidden="true" tabindex="-1"></a>\alpha &amp;\sim \mathrm{Uniform}(-\infty, \infty)<span class="sc">\\</span></span>
<span id="cb848-1339"><a href="#cb848-1339" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix} \alpha_{subject} <span class="sc">\\</span> \beta_{subject} \end{bmatrix}</span>
<span id="cb848-1340"><a href="#cb848-1340" aria-hidden="true" tabindex="-1"></a>&amp;\sim \mathrm{MVNormal} </span>
<span id="cb848-1341"><a href="#cb848-1341" aria-hidden="true" tabindex="-1"></a>\bigg( \begin{bmatrix}0<span class="sc">\\</span> 0\end{bmatrix}, \Sigma_{subject}\bigg) <span class="sc">\\</span> </span>
<span id="cb848-1342"><a href="#cb848-1342" aria-hidden="true" tabindex="-1"></a>\Sigma_{subject}&amp; = \begin{bmatrix}</span>
<span id="cb848-1343"><a href="#cb848-1343" aria-hidden="true" tabindex="-1"></a>\sigma_ {\alpha<span class="co">[</span><span class="ot">s</span><span class="co">]</span>} &amp;  0<span class="sc">\\</span>  0 &amp;\sigma_{\beta<span class="co">[</span><span class="ot">s</span><span class="co">]</span>} \end{bmatrix}</span>
<span id="cb848-1344"><a href="#cb848-1344" aria-hidden="true" tabindex="-1"></a>\textbf{R}  \begin{bmatrix}</span>
<span id="cb848-1345"><a href="#cb848-1345" aria-hidden="true" tabindex="-1"></a>\sigma_ {\alpha<span class="co">[</span><span class="ot">s</span><span class="co">]</span> }&amp;  0<span class="sc">\\</span>  0 &amp;\sigma_{\beta<span class="co">[</span><span class="ot">s</span><span class="co">]</span>} \end{bmatrix}<span class="sc">\\</span></span>
<span id="cb848-1346"><a href="#cb848-1346" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix} \alpha_{item} <span class="sc">\\</span> \beta_{item} \end{bmatrix} &amp;\sim \mathrm{MVNormal} \bigg( </span>
<span id="cb848-1347"><a href="#cb848-1347" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}0<span class="sc">\\</span> 0\end{bmatrix}, </span>
<span id="cb848-1348"><a href="#cb848-1348" aria-hidden="true" tabindex="-1"></a>\Sigma_{item}\bigg) <span class="sc">\\</span> </span>
<span id="cb848-1349"><a href="#cb848-1349" aria-hidden="true" tabindex="-1"></a>\Sigma_{item}&amp; =</span>
<span id="cb848-1350"><a href="#cb848-1350" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}\sigma_ {\alpha<span class="co">[</span><span class="ot">it</span><span class="co">]</span>} &amp;  0<span class="sc">\\</span>  0 &amp;\sigma_{\beta<span class="co">[</span><span class="ot">it</span><span class="co">]</span>} \end{bmatrix}</span>
<span id="cb848-1351"><a href="#cb848-1351" aria-hidden="true" tabindex="-1"></a>\textbf{R}  </span>
<span id="cb848-1352"><a href="#cb848-1352" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}\sigma_ {\alpha<span class="co">[</span><span class="ot">it</span><span class="co">]</span>} &amp;  0<span class="sc">\\</span>  0 &amp;\sigma_{\beta<span class="co">[</span><span class="ot">it</span><span class="co">]</span> }\end{bmatrix}<span class="sc">\\</span></span>
<span id="cb848-1353"><a href="#cb848-1353" aria-hidden="true" tabindex="-1"></a>\beta_{so} &amp; \sim \mathrm{Uniform(-\infty, \infty)}<span class="sc">\\</span> </span>
<span id="cb848-1354"><a href="#cb848-1354" aria-hidden="true" tabindex="-1"></a>\sigma,\sigma_{\alpha<span class="co">[</span><span class="ot">\text{s}[</span><span class="co">]</span>}, \sigma_{\alpha<span class="co">[</span><span class="ot">\text{it}[</span><span class="co">]</span>}, \sigma_{\beta<span class="co">[</span><span class="ot">\text{s}[</span><span class="co">]</span>}, \sigma_{\beta<span class="co">[</span><span class="ot">\text{it}[</span><span class="co">]</span>}  &amp;\sim \mathrm{Uniform}(0, \infty)<span class="sc">\\</span></span>
<span id="cb848-1355"><a href="#cb848-1355" aria-hidden="true" tabindex="-1"></a>\textbf{R}&amp; \sim \mathrm{LKJcorr}(?) </span>
<span id="cb848-1356"><a href="#cb848-1356" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb848-1357"><a href="#cb848-1357" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1358"><a href="#cb848-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1359"><a href="#cb848-1359" aria-hidden="true" tabindex="-1"></a>Okay, that was not easy to do. Anyway, to fit this model, I once again use Sorensens code to run this model. </span>
<span id="cb848-1360"><a href="#cb848-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1361"><a href="#cb848-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1362"><a href="#cb848-1362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=TRUE, warning=TRUE, output=FALSE}</span></span>
<span id="cb848-1363"><a href="#cb848-1363" aria-hidden="true" tabindex="-1"></a>ranIntSlpFit <span class="ot">&lt;-</span> <span class="fu">stan</span>(<span class="at">file =</span> <span class="st">"ranIntSlp.stan"</span>, <span class="at">data =</span> stanDat, </span>
<span id="cb848-1364"><a href="#cb848-1364" aria-hidden="true" tabindex="-1"></a>                     <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>)</span>
<span id="cb848-1365"><a href="#cb848-1365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1366"><a href="#cb848-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1367"><a href="#cb848-1367" aria-hidden="true" tabindex="-1"></a>And then I do the same in stanarm. Stanarm automatically uses the following priors: </span>
<span id="cb848-1368"><a href="#cb848-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1369"><a href="#cb848-1369" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1370"><a href="#cb848-1370" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb848-1371"><a href="#cb848-1371" aria-hidden="true" tabindex="-1"></a>\text{Log(RT)}_i &amp;\sim \mathrm{Normal}(\mu_i, \sigma_i)<span class="sc">\\</span></span>
<span id="cb848-1372"><a href="#cb848-1372" aria-hidden="true" tabindex="-1"></a>\mu &amp;= \alpha + \alpha_{\text{Subjec<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}}+\alpha_{\text{Item<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}} + (\beta_{so} + \beta_{\text{Item<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}} + \beta_{\text{Subject<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}})\times\text{SO}_i<span class="sc">\\</span></span>
<span id="cb848-1373"><a href="#cb848-1373" aria-hidden="true" tabindex="-1"></a>\alpha &amp;\sim \mathrm{Normal}(6.1, 1.5)<span class="sc">\\</span></span>
<span id="cb848-1374"><a href="#cb848-1374" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix} \alpha_{subject} <span class="sc">\\</span> \beta_{subject} \end{bmatrix}</span>
<span id="cb848-1375"><a href="#cb848-1375" aria-hidden="true" tabindex="-1"></a>&amp;\sim \mathrm{MVNormal} </span>
<span id="cb848-1376"><a href="#cb848-1376" aria-hidden="true" tabindex="-1"></a>\bigg( \begin{bmatrix}0<span class="sc">\\</span> 0\end{bmatrix}, \Sigma_{subject}\bigg) <span class="sc">\\</span> </span>
<span id="cb848-1377"><a href="#cb848-1377" aria-hidden="true" tabindex="-1"></a>\Sigma_{subject}&amp; = \begin{bmatrix}</span>
<span id="cb848-1378"><a href="#cb848-1378" aria-hidden="true" tabindex="-1"></a>\sigma_ {\alpha<span class="co">[</span><span class="ot">s</span><span class="co">]</span>} &amp;  0<span class="sc">\\</span>  0 &amp;\sigma_{\beta<span class="co">[</span><span class="ot">s</span><span class="co">]</span>} \end{bmatrix}</span>
<span id="cb848-1379"><a href="#cb848-1379" aria-hidden="true" tabindex="-1"></a>\textbf{R}  \begin{bmatrix}</span>
<span id="cb848-1380"><a href="#cb848-1380" aria-hidden="true" tabindex="-1"></a>\sigma_ {\alpha<span class="co">[</span><span class="ot">s</span><span class="co">]</span> }&amp;  0<span class="sc">\\</span>  0 &amp;\sigma_{\beta<span class="co">[</span><span class="ot">s</span><span class="co">]</span>} \end{bmatrix}<span class="sc">\\</span></span>
<span id="cb848-1381"><a href="#cb848-1381" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix} \alpha_{item} <span class="sc">\\</span> \beta_{item} \end{bmatrix} &amp;\sim \mathrm{MVNormal} \bigg( </span>
<span id="cb848-1382"><a href="#cb848-1382" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}0<span class="sc">\\</span> 0\end{bmatrix}, </span>
<span id="cb848-1383"><a href="#cb848-1383" aria-hidden="true" tabindex="-1"></a>\Sigma_{item}\bigg) <span class="sc">\\</span> </span>
<span id="cb848-1384"><a href="#cb848-1384" aria-hidden="true" tabindex="-1"></a>\Sigma_{item}&amp; =</span>
<span id="cb848-1385"><a href="#cb848-1385" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}\sigma_ {\alpha<span class="co">[</span><span class="ot">it</span><span class="co">]</span>} &amp;  0<span class="sc">\\</span>  0 &amp;\sigma_{\beta<span class="co">[</span><span class="ot">it</span><span class="co">]</span>} \end{bmatrix}</span>
<span id="cb848-1386"><a href="#cb848-1386" aria-hidden="true" tabindex="-1"></a>\textbf{R}  </span>
<span id="cb848-1387"><a href="#cb848-1387" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}\sigma_ {\alpha<span class="co">[</span><span class="ot">it</span><span class="co">]</span>} &amp;  0<span class="sc">\\</span>  0 &amp;\sigma_{\beta<span class="co">[</span><span class="ot">it</span><span class="co">]</span> }\end{bmatrix}<span class="sc">\\</span></span>
<span id="cb848-1388"><a href="#cb848-1388" aria-hidden="true" tabindex="-1"></a>\beta_{so} &amp; \sim \mathrm{Uniform(0, 3)}<span class="sc">\\</span> </span>
<span id="cb848-1389"><a href="#cb848-1389" aria-hidden="true" tabindex="-1"></a>\sigma,\sigma_{\alpha<span class="co">[</span><span class="ot">\text{s}[</span><span class="co">]</span>}, \sigma_{\alpha<span class="co">[</span><span class="ot">\text{it}[</span><span class="co">]</span>}, \sigma_{\beta<span class="co">[</span><span class="ot">\text{s}[</span><span class="co">]</span>}, \sigma_{\beta<span class="co">[</span><span class="ot">\text{it}[</span><span class="co">]</span>}  &amp;\sim \mathrm{Exponential}(1.7)<span class="sc">\\</span></span>
<span id="cb848-1390"><a href="#cb848-1390" aria-hidden="true" tabindex="-1"></a>\textbf{R}&amp; \sim \mathrm{LKJcorr}(1) </span>
<span id="cb848-1391"><a href="#cb848-1391" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb848-1392"><a href="#cb848-1392" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb848-1393"><a href="#cb848-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1396"><a href="#cb848-1396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb848-1397"><a href="#cb848-1397" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> rDat <span class="sc">%&gt;%</span> </span>
<span id="cb848-1398"><a href="#cb848-1398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">so =</span> <span class="fu">as.factor</span>(so))</span>
<span id="cb848-1399"><a href="#cb848-1399" aria-hidden="true" tabindex="-1"></a>ranINT_cor_arm <span class="ot">&lt;-</span> <span class="fu">stan_lmer</span>(<span class="fu">log</span>(rt) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span>  (<span class="dv">1</span> <span class="sc">+</span> so<span class="sc">|</span>subj) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>so<span class="sc">|</span>item) <span class="sc">+</span> so, <span class="at">data =</span> tmp, <span class="at">chains =</span> <span class="dv">4</span>)</span>
<span id="cb848-1400"><a href="#cb848-1400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1401"><a href="#cb848-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1402"><a href="#cb848-1402" aria-hidden="true" tabindex="-1"></a>The first thing I notice, is that the stanarm version was the slowest to run. But let's compare the model outputs!</span>
<span id="cb848-1403"><a href="#cb848-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1406"><a href="#cb848-1406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb848-1407"><a href="#cb848-1407" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ranIntSlpFit, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"beta"</span>, <span class="st">"sigma_e"</span>, <span class="st">"sigma_u"</span>, <span class="st">"sigma_w"</span>),</span>
<span id="cb848-1408"><a href="#cb848-1408" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span>
<span id="cb848-1409"><a href="#cb848-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1410"><a href="#cb848-1410" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">summary</span>(ranINT_cor_arm, </span>
<span id="cb848-1411"><a href="#cb848-1411" aria-hidden="true" tabindex="-1"></a>      <span class="at">pars =</span><span class="fu">c</span>(<span class="st">"(Intercept)"</span>,<span class="st">"so1"</span>, <span class="st">"sigma"</span>, <span class="st">"Sigma[subj:(Intercept),(Intercept)]"</span>, <span class="st">"Sigma[item:(Intercept),(Intercept)]"</span>, <span class="st">"Sigma[subj:so1,(Intercept)]"</span>,<span class="st">"Sigma[subj:so1,so1]"</span>, <span class="st">"Sigma[item:so1,(Intercept)]"</span>,<span class="st">"Sigma[item:so1,so1]"</span>     ), </span>
<span id="cb848-1412"><a href="#cb848-1412" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span>  <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>)</span>
<span id="cb848-1413"><a href="#cb848-1413" aria-hidden="true" tabindex="-1"></a>      )[,],<span class="dv">2</span>)</span>
<span id="cb848-1414"><a href="#cb848-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1415"><a href="#cb848-1415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb848-1416"><a href="#cb848-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-1417"><a href="#cb848-1417" aria-hidden="true" tabindex="-1"></a>The outputs are again pretty similar. But again, Stanarm gives slightly larger estimates for the effect os so, but also slightly larger posteriors. Why this happens is a little bit beyond be, but if I were to guess, it might be differences in the underlying MCMC machinery, or in the priors, doing something where the </span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>